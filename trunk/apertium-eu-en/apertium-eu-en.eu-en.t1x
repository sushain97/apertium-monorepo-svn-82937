<?xml version="1.0" encoding="UTF-8"?> <!-- -*- nxml -*- -->
<transfer default="chunk">
  <section-def-cats>

    <def-cat n="ari_izan">
      <cat-item lemma="ari izan" tags="vbper.*"/>
    </def-cat>

    <def-cat n="nahi">
      <cat-item lemma="nahi" tags="n"/>
    </def-cat>

    <def-cat n="urte">
      <cat-item lemma="urte" tags="n"/>
    </def-cat>

    <def-cat n="guio">
      <cat-item lemma="-" tags="guio"/>
    </def-cat>

    <def-cat n="nom">
      <cat-item tags="n"/>
    </def-cat>

    <def-cat n="ant">
      <cat-item tags="np.ant"/>
      <cat-item tags="np.ant.*"/>
    </def-cat>

    <def-cat n="nom_np">
      <cat-item tags="n"/>
      <cat-item tags="np.*"/>
      <cat-item tags="n.acr"/>
    </def-cat>

    <def-cat n="month">
      <cat-item lemma="urtarril" tags="n"/>
      <cat-item lemma="otsail" tags="n"/>
      <cat-item lemma="martxo" tags="n"/> 
      <cat-item lemma="apiril" tags="n"/> 
      <cat-item lemma="maiatz" tags="n"/> 
      <cat-item lemma="ekain" tags="n"/>
      <cat-item lemma="uztail" tags="n"/> 
      <cat-item lemma="abuztu" tags="n"/>
      <cat-item lemma="irail" tags="n"/>
      <cat-item lemma="urri" tags="n"/>
      <cat-item lemma="azaro" tags="n"/>
      <cat-item lemma="abendu" tags="n"/>
    </def-cat>

    <def-cat n="nom_adv">
      <cat-item tags="n"/>
      <cat-item tags="np.*"/>
      <cat-item tags="n.acr"/>
      <cat-item tags="adv"/>
      <cat-item tags="adv.gen"/>
    </def-cat>

    <def-cat n="adv">
      <cat-item tags="adv"/>
      <cat-item tags="adv.gen"/>
    </def-cat>

    <def-cat n="adj">
      <cat-item tags="adj.*"/>
      <cat-item tags="vblex.pp"/>
    </def-cat>

    <def-cat n="adjizl">
      <cat-item tags="adj.izl"/>
      <cat-item tags="adj.izl.rom"/>
      <cat-item tags="num.ord"/>
    </def-cat>

    <def-cat n="adjnopp">
      <cat-item tags="adj.*"/>
    </def-cat>

    <def-cat n="det">
      <cat-item tags="det.art.*"/>
      <cat-item tags="det.ind.*"/>
      <cat-item tags="det.dem.*"/>
      <cat-item lemma="bat" tags="num.sg"/>
    </def-cat>

    <def-cat n="detindizl"><!--determinantes indefinidos e interrogativos, que van generalmente delante del nombre -->
      <cat-item tags="det.indizl.*"/>
      <cat-item tags="det.itg.*"/>
      <cat-item lemma="zenbat" tags="adv.itg"/>
    </def-cat>

    <def-cat n="detart">
      <cat-item tags="det.art.*"/>
    </def-cat>

    <def-cat n="k">
      <cat-item lemma="k" tags="post"/>
    </def-cat>

    <def-cat n="z">
      <cat-item lemma="z" tags="post"/>
    </def-cat>
    <def-cat n="beteta">
      <cat-item lemma="bete" tags="vblex.padv"/>
      <cat-item lemma="bete" tags="vblex.pp"/>
    </def-cat>

    <def-cat n="post">
      <cat-item tags="post"/>
      <cat-item tags="post.*"/>
    </def-cat>

    <def-cat n="spost">
      <cat-item tags="spost"/>
    </def-cat>

    <def-cat n="part">
      <cat-item lemma="ik" tags="post"/>
    </def-cat>

    <def-cat n="num">
      <cat-item tags="num.pl"/>
      <cat-item tags="num"/>
      <cat-item tags="num.percent"/>
      <cat-item lemma="mila" tags="n"/>
    </def-cat>

    <def-cat n="bi">
      <cat-item lemma="bi" tags="num.pl"/>
    </def-cat>

    <def-cat n="milioi">
      <cat-item lemma="milioi" tags="n"/>
    </def-cat>
    <def-cat n="bat">
      <cat-item lemma="bat" tags="num.sg"/>
    </def-cat>

    <def-cat n="vbsint_aux">
      <cat-item lemma="ukan" tags="vbsint.*"/>
      <cat-item lemma="izan" tags="vbsint.*"/>
    </def-cat>
    <def-cat n="vbsint">
      <cat-item tags="vbsint.*"/>
    </def-cat>

    <def-cat n="lakoan">
      <cat-item lemma="lakoan" tags="cnjadv"/>
    </def-cat>
    <def-cat n="egon">
      <cat-item lemma="egon" tags="vbsint.*"/>
    </def-cat>

    <def-cat n="vbper">
      <cat-item tags="vbper.*"/>
    </def-cat>

    <def-cat n="pp">
      <cat-item tags="vblex.pp"/>
      <cat-item tags="vbper.pp"/>
    </def-cat>
    <!--
        <def-cat n="perpp">
        <cat-item tags="vbper.pp"/>
        </def-cat> -->

    <def-cat n="lexpp">
      <cat-item tags="vblex.pp"/>
    </def-cat>
    <def-cat n="egin_izanpp">
      <cat-item lemma="egin" tags="vblex.pp"/>
      <cat-item lemma="egin" tags="vblex.inf"/>
      <cat-item lemma="izan" tags="vblex.pp"/>
      <cat-item lemma="izan" tags="vblex.inf"/>
    </def-cat>
    <def-cat n="izanpp">
      <cat-item lemma="izan" tags="vblex.pp"/>
      <cat-item lemma="izan" tags="vblex.inf"/>
    </def-cat>


    <def-cat n="inf">
      <cat-item tags="vblex.inf"/>
      <cat-item tags="vbper.inf"/>
    </def-cat>


    <def-cat n="padv">
      <cat-item tags="vblex.padv"/>
    </def-cat>

    <def-cat n="pp_adv">
      <cat-item tags="vblex.padv"/>
      <cat-item tags="vblex.pp"/>
    </def-cat>

    <def-cat n="ger">
      <cat-item tags="vblex.ger"/>
      <cat-item tags="vbper.ger"/>
    </def-cat>

    <!-- <def-cat n="perger">
         <cat-item tags="vbper.ger"/>
         </def-cat> -->

    <def-cat n="lexger">
      <cat-item tags="vblex.ger"/>
    </def-cat>
    <def-cat n="eginger">
      <cat-item lemma="egin"  tags="vblex.ger"/>
    </def-cat>


    <def-cat n="pfut">
      <cat-item tags="vblex.pfut"/>
      <cat-item tags="vbper.pfut"/>
    </def-cat>

    <!--<def-cat n="perpfut">
        <cat-item tags="vbper.pfut"/>
        </def-cat> -->

    <def-cat n="lexpfut">
      <cat-item tags="vblex.pfut"/>
    </def-cat>

    <def-cat n="eginpfut">
      <cat-item lemma="egin" tags="vblex.pfut"/>
    </def-cat>


    <def-cat n="vbizen">
      <cat-item tags="vblex.izen"/>
      <cat-item tags="vbper.izen"/>
    </def-cat>

    <def-cat n="ezinda">
      <cat-item lemma="ezinda" tags="vblex.inf"/>
      <cat-item lemma="ezinik" tags="vblex.inf"/>
    </def-cat>


    <def-cat n="aux_potencial">
      <cat-item lemma="ezan" tags="vbsint.potpr.*"/>
      <cat-item lemma="edin" tags="vbsint.potpr.*"/>
      <cat-item lemma="ezan" tags="vbsint.potps.*"/>
      <cat-item lemma="edin" tags="vbsint.potps.*"/>
      <cat-item lemma="ezan" tags="vbsint.poth.*"/>
      <cat-item lemma="edin" tags="vbsint.poth.*"/>
    </def-cat>

    <def-cat n="aux_subjuntivo">
      <cat-item lemma="ezan" tags="vbsint.prs.*"/>
      <cat-item lemma="edin" tags="vbsint.prs.*"/>
      <cat-item lemma="ezan" tags="vbsint.pis.*"/>
      <cat-item lemma="edin" tags="vbsint.pis.*"/>
      <cat-item lemma="ezan" tags="vbsint.hs.*"/>
      <cat-item lemma="edin" tags="vbsint.hs.*"/>
    </def-cat>

 <def-cat n="aux_imperativo">
      <cat-item lemma="edin" tags="vbsint.imp.*"/>
      <cat-item lemma="ezan" tags="vbsint.imp.*"/>
 </def-cat>

    <def-cat n="prnpers"><!--aquests pronoms es poden transformar en possessius en castellà -->
      <cat-item tags="prn.pers.*"/>
      <cat-item lemma="hura" tags="det.dem.*"/>
    </def-cat>


    <def-cat n="prnind">
      <cat-item tags="prn.ind.*"/>
    </def-cat> 


    <def-cat n="prnrec">
      <cat-item tags="prn.rec"/>
    </def-cat>
    <def-cat n="prn">
      <cat-item tags="prn.*"/>
    </def-cat>

    <def-cat n="prep">
      <cat-item tags="pr"/>
    </def-cat>

    <def-cat n="en">
      <cat-item lemma="en" tags="post"/>
    </def-cat>

    <def-cat n="ko">
      <cat-item lemma="ko" tags="post"/>
    </def-cat>

    <def-cat n="ko_en">
      <cat-item lemma="ko" tags="post"/>
      <cat-item lemma="en" tags="post"/>
    </def-cat>

    <def-cat n="tik">
      <cat-item lemma="tik" tags="post"/>
    </def-cat>
    <def-cat n="gra">
      <cat-item tags="gra.*"/>
    </def-cat>

    <def-cat n="sup">
      <cat-item lemma="en" tags="gra.sup"/>
    </def-cat>

    <def-cat n="cnjadv1"><!-- conjuncions adverbials que van amb el verb conjugat--> 
      <cat-item lemma="nez" tags="cnjadv"/>
      <cat-item lemma="lako" tags="cnjadv"/>
      <cat-item lemma="nean" tags="cnjadv"/>
    </def-cat>

    <def-cat n="lako"><!--ampliar-ho a més cnjadv per a fer regles unitàries -->
      <cat-item lemma="lako" tags="cnjadv"/>
    </def-cat>

    <def-cat n="cnjadv2"><!-- conjuncions adverbials que van amb el verb sense conjugar (pp)--> 
      <cat-item lemma="ezean" tags="cnjadv"/>
      <cat-item lemma="ezik" tags="cnjadv"/>
      <cat-item lemma="ondoren" tags="cnjadv"/>
      <cat-item lemma="eta gero" tags="cnjadv"/>
      <cat-item lemma="baino lehen" tags="cnjadv"/>
      <cat-item lemma="arren" tags="cnjadv"/>
    </def-cat>

    <def-cat n="conj">
      <cat-item tags="cnjcoo"/>
    </def-cat>

    <def-cat n="reladj">
      <cat-item lemma="n" tags="rel"/>
    </def-cat>
    <def-cat n="quesubj"><!-- particules subordinants que apareixen després d'una forma subjuntiva-->
      <cat-item lemma="n" tags="cnjsub"/>
      <cat-item lemma="la" tags="cnjsub"/>
    </def-cat>

    <def-cat n="cnjsub">
      <cat-item lemma="la" tags="cnjsub"/>
    </def-cat>


    <def-cat n="ba">
      <cat-item lemma="ba" tags="cnjsub"/>
    </def-cat>

    <def-cat n="baino">
      <cat-item lemma="baino" tags="cnjloc"/>
    </def-cat>


    <def-cat n="ez">
      <cat-item lemma="ez" tags="adv"/>
      <cat-item lemma="baino ez" tags="adv"/>
    </def-cat>

    <def-cat n="cm">
      <cat-item tags="cm"/>
    </def-cat>

    <def-cat n="sent">
      <cat-item tags="sent"/>
    </def-cat>

    

  </section-def-cats>
  <section-def-attrs>
    <def-attr n="a_nom">
      <attr-item tags="n"/>
      <attr-item tags="n.acr"/>
      <attr-item tags="np.loc"/>
      <attr-item tags="np.ant"/>
      <attr-item tags="np.ant.m"/>
      <attr-item tags="np.ant.f"/>
      <attr-item tags="np.al"/>
      <attr-item tags="np.cog"/>
      <attr-item tags="num"/>
      <attr-item tags="adv"/>
      <attr-item tags="adj"/>
    </def-attr>

    <def-attr n="a_np">
      <attr-item tags="np"/>
    </def-attr>

    <def-attr n="enmajuscula">
      <attr-item tags="np"/>
      <attr-item tags="acr"/>
      <attr-item tags="rom"/>
    </def-attr>

    <def-attr n="a_adj">
      <attr-item tags="adj"/>
      <attr-item tags="adjant"/> 
      <attr-item tags="det"/>
      <attr-item tags="num"/>
      <attr-item tags="num.ord"/>
      <attr-item tags="vblex.pp"/>
      <attr-item tags="vblex.sep.pp"/>
      <attr-item tags="vbser.pp"/>
      <attr-item tags="vblex.padv"/>
      <attr-item tags="adj.sint"/>
      <attr-item tags="adj.sint.comp"/>
      <attr-item tags="adj.sint.sup"/>
    </def-attr>

    <def-attr n="a_det">
      <attr-item tags="det"/>
      <attr-item tags="predet"/> 
    </def-attr> 

    <def-attr n="a_verb">
      <attr-item tags="vblex"/>
      <attr-item tags="vblex.sep"/>
      <attr-item tags="vaux"/>
      <attr-item tags="vbser"/>
      <attr-item tags="vbsint"/>
      <attr-item tags="vbhaver"/>
      <attr-item tags="vbmod"/> 
    </def-attr>
    
    <def-attr n="a_prep">
      <attr-item tags="pr"/>
    </def-attr>

    <def-attr n="grade">
      <attr-item tags="ind"/>
      <attr-item tags="comp"/>
      <attr-item tags="sup"/>
      <attr-item tags="exc"/>
    </def-attr>

    <def-attr n="a_post">
      <attr-item tags="ko"/>
    </def-attr>
    
    <def-attr n="a_adv">
      <attr-item tags="adv"/>
      <attr-item tags="pr"/>
      <attr-item tags="adj"/>
      <attr-item tags="cnjadv"/>
    </def-attr>

    <def-attr n="tipoadv">
      <attr-item tags="gen"/>
    </def-attr>

    <def-attr n="a_num">
      <attr-item tags="num"/>
      <attr-item tags="num.percent"/>
      <attr-item tags="det.ind"/>
    </def-attr>

    <def-attr n="tipus_det">
      <attr-item tags="art"/>
      <attr-item tags="def"/>
      <attr-item tags="ind"/>
      <attr-item tags="indizl"/>
      <attr-item tags="itg"/>
      <attr-item tags="dem"/>
      <attr-item tags="num"/>
      <attr-item tags="ord"/>
      <attr-item tags="qnt"/>
    </def-attr>
    <def-attr n="tipus_adj">
      <attr-item tags="art"/>
      <attr-item tags="def"/>
      <attr-item tags="ind"/>
      <attr-item tags="indizl"/>
      <attr-item tags="itg"/>
      <attr-item tags="dem"/>
      <attr-item tags="ord"/>
      <attr-item tags="qnt"/>
    </def-attr>

    <def-attr n="a_ordinal">
      <attr-item tags="num.ord"/> 
      <attr-item tags="det.ord"/>
    </def-attr>


    <def-attr n="det_pos">
      <attr-item tags="prn.pers"/> 
      <attr-item tags="prn.tn"/>
      <attr-item tags="prn.subj"/>
      <attr-item tags="prn.obj"/>
      <attr-item tags="det.dem"/>
      <attr-item tags="det.pos"/>
      <attr-item tags="adj.pos"/>
    </def-attr>


    <def-attr n="det_prn">
      <attr-item tags="prn.subj.p3.nt"/>
      <attr-item tags="prn.subj.p3.mf"/>
      <attr-item tags="det.dem"/> 
    </def-attr>

    <def-attr n="pers">
      <attr-item tags="p1"/>
      <attr-item tags="p2"/>
      <attr-item tags="p3"/>
      <attr-item tags="PD"/>
    </def-attr>


    <def-attr n="persnbr">
      <attr-item tags="p1.sg"/>
      <attr-item tags="p1.pl"/>
      <attr-item tags="p2.sg"/>
      <attr-item tags="p2.pl"/>
      <attr-item tags="p3.sg"/>
      <attr-item tags="p3.pl"/>
      <attr-item tags="PD.ND"/>

      <attr-item tags="NR_HK"/>
      <attr-item tags="NR_HU"/>
      <attr-item tags="NR_NI"/>
      <attr-item tags="NR_ZK"/>
      <attr-item tags="NR_GU"/>
      <attr-item tags="NR_ZU"/>
      <attr-item tags="NR_HI"/>

      <attr-item tags="NK_HK"/>
      <attr-item tags="NK_HU"/>
      <attr-item tags="NK_NI"/>
      <attr-item tags="NK_ZK"/>
      <attr-item tags="NK_GU"/>
      <attr-item tags="NK_ZU"/>
      <attr-item tags="NK_HI"/>

      <attr-item tags="NI_HK"/>
      <attr-item tags="NI_HU"/>
      <attr-item tags="NI_NI"/>
      <attr-item tags="NI_ZK"/>
      <attr-item tags="NI_GU"/>
      <attr-item tags="NI_ZU"/>
      <attr-item tags="NI_HI"/>
    </def-attr>

    <def-attr n="nor">
      <attr-item tags="NR_HK"/>
      <attr-item tags="NR_HU"/>
      <attr-item tags="NR_NI"/>
      <attr-item tags="NR_ZK"/>
      <attr-item tags="NR_GU"/>
      <attr-item tags="NR_ZU"/>
      <attr-item tags="NR_HI"/>
    </def-attr>

    <def-attr n="nori">
      <attr-item tags="NI_HK"/>
      <attr-item tags="NI_HU"/>
      <attr-item tags="NI_NI"/>
      <attr-item tags="NI_ZK"/>
      <attr-item tags="NI_GU"/>
      <attr-item tags="NI_ZU"/>
      <attr-item tags="NI_HI"/>
    </def-attr>

    <def-attr n="nork">
      <attr-item tags="NK_HK"/>
      <attr-item tags="NK_HU"/>
      <attr-item tags="NK_NI"/>
      <attr-item tags="NK_ZK"/>
      <attr-item tags="NK_GU"/>
      <attr-item tags="NK_ZU"/>
      <attr-item tags="NK_HI"/>
    </def-attr>


    <def-attr n="gen">
      <attr-item tags="m"/>
      <attr-item tags="f"/>
      <attr-item tags="mf"/>
      <attr-item tags="GD"/>
      <attr-item tags="nt"/>
    </def-attr>

    <def-attr n="GD">
      <attr-item tags="GD"/>
    </def-attr>

    <def-attr n="mf">
      <attr-item tags="mf"/>
      <attr-item tags="m"/>
      <attr-item tags="f"/>
    </def-attr>

    <def-attr n="ND">
      <attr-item tags="ND"/>
    </def-attr>

    <def-attr n="sp">
      <attr-item tags="sg"/>
      <attr-item tags="pl"/>
      <attr-item tags="sp"/>
    </def-attr>


    <def-attr n="nbr">
      <attr-item tags="sg"/>
      <attr-item tags="pl"/>
      <attr-item tags="sp"/>
      <attr-item tags="ND"/>
    </def-attr>

    <def-attr n="temps">
      <attr-item tags="inf"/>
      <attr-item tags="pres"/>
      <attr-item tags="past"/>
      <attr-item tags="pri"/>
      <attr-item tags="pp"/>
      <attr-item tags="ger"/>
      <attr-item tags="pprs"/>
      <attr-item tags="subs"/>
      <attr-item tags="pii"/>
      <attr-item tags="pfut"/>
      <attr-item tags="padv"/>
      <attr-item tags="fti"/>
      <attr-item tags="cni"/>
      <attr-item tags="imp"/>
      <attr-item tags="izen"/>
      <attr-item tags="past"/>
      <attr-item tags="potpr"/>
      <attr-item tags="potps"/>
      <attr-item tags="poth"/>
      <attr-item tags="prs"/>
      <attr-item tags="pis"/>
      <attr-item tags="hs"/>
      <attr-item tags="onpr"/>
      <attr-item tags="bald"/>
      <attr-item tags="prs2"/>
      <attr-item tags="prob1"/>
      <attr-item tags="prob2"/>
    </def-attr>

    <def-attr n="tipus_prn">
      <attr-item tags="pers"/>
      <attr-item tags="tn"/>
      <attr-item tags="itg"/>
      <attr-item tags="ind"/>
      <attr-item tags="rec"/>
    </def-attr> 

  </section-def-attrs>

  <section-def-vars>
    <def-var n="caseFirstWord"/>
    <def-var n="caseSecondWord"/>
    <def-var n="EOS" v="true"/>
    <def-var n="genere" v="m"/>
    <def-var n="nombre" v="sg"/>
    <def-var n="gen_chunk"/>
    <def-var n="nbr_chunk"/>
    <def-var n="palabra"/>
    <def-var n="chunk"/>
    <def-var n="tipusdet"/>
    <def-var n="subjtags"/>
    <def-var n="procltags"/>
    <def-var n="objtags"/>
    <def-var n="prn_enc"/>
    <def-var n="aux_verb"/>
    <def-var n="verbo"/>
    <def-var n="adverbio"/>
    <def-var n="lema"/>
    <def-var n="lemachunk"/>
    <def-var n="adv_adjectiu"/>
    <def-var n="adv_adjname"/>
    <def-var n="ezta"/>
    <def-var n="erg"/>
    <def-var n="blanco"/>
    <def-var n="grado"/>
    <def-var n="genitive"/>
    <def-var n="nnblank1"/>
    <def-var n="nnblank2"/>
    <def-var n="nnblank3"/>
  </section-def-vars>




  <section-def-lists>

    <def-list n="nombrescol"> 
      <list-item v="jende"/>
      <list-item v="ogi"/>
      <list-item v="su"/>
      <list-item v="ur"/>
      <list-item v="diru"/>
    </def-list>

    <def-list n="million">
      <list-item v="hundred"/>
      <list-item v="thousand"/>
      <list-item v="million"/>
      <list-item v="hundred thousand"/>
    </def-list>

    <def-list n="lang">
      <list-item v="euskara"/>
    </def-list>
  </section-def-lists>
  


  <section-def-macros>


    <def-macro n="f_bcond" npar="2"><!--Per mirar si el blanc conté o no format. Cal posar aquesta funció en les regles en què desaparegui alguna paraula, per tal de decidir si el blanc de la paraula eliminada s'ha d'eliminar o conservar. Si conté format cal conservar-la, si no en conté cal eliminar-la perquè no apareguin dos espais seguits. -->
      <choose>
        <when>
          <test>
            <not>
              <equal>
                <b pos="1"/>
                <lit v=" "/>
              </equal>
            </not>
          </test>
          <out>
            <b pos="1"/>
          </out>
        </when>
      </choose>
    </def-macro>

    <def-macro n="nomnp_pl" npar="1">
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </let>
          </when>
        </choose>
    </def-macro>


    <def-macro n="n_num" npar="1">
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="lem"/>
                  <lit v="mila"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="tags"/>
                  <lit-tag v="n"/>
                </equal>
              </and>
            </test>
            <let>
              <clip pos="1" side="tl" part="lem"/>
              <lit v="thousand"/>
            </let>
            <let>
              <clip pos="1" side="tl" part="tags"/>
              <lit-tag v="num.sp"/>
            </let>
          </when>
        </choose>
    </def-macro>

    <def-macro n="nnblank_v1" npar="3"><!-- Identical macros, different variables-->
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <b pos="1"/>
                  <lit v=""/>
                </equal>
              </not>
              <not>
                <equal>
                  <b pos="2"/>
                  <lit v=""/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="nnblank1"/>
            <concat>
              <b pos="1"/>
              <b pos="2"/>
            </concat>
          </let>
        </when>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <b pos="1"/>
                  <lit v=""/>
                </equal>
              </not>
              <equal>
                <b pos="2"/>
                <lit v=""/>
              </equal>
            </and>
          </test>
          <let>
            <var n="nnblank1"/>
            <b pos="1"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <b pos="2"/>
                  <lit v=""/>
                </equal>
              </not>
              <equal>
                <b pos="1"/>
                <lit v=""/>
              </equal>
            </and>
          </test>
          <let>
            <var n="nnblank1"/>
            <b pos="2"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="nnblank1"/>
            <lit v=" "/>
          </let>
        </otherwise>
      </choose>
    </def-macro>
    <def-macro n="nnblank_v2" npar="3"><!-- Identical macros, different variables-->
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <b pos="1"/>
                  <lit v=""/>
                </equal>
              </not>
              <not>
                <equal>
                  <b pos="2"/>
                  <lit v=""/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="nnblank2"/>
            <concat>
              <b pos="1"/>
              <b pos="2"/>
            </concat>
          </let>
        </when>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <b pos="1"/>
                  <lit v=""/>
                </equal>
              </not>
              <equal>
                <b pos="2"/>
                <lit v=""/>
              </equal>
            </and>
          </test>
          <let>
            <var n="nnblank2"/>
            <b pos="1"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <b pos="2"/>
                  <lit v=""/>
                </equal>
              </not>
              <equal>
                <b pos="1"/>
                <lit v=""/>
              </equal>
            </and>
          </test>
          <let>
            <var n="nnblank2"/>
            <b pos="2"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="nnblank2"/>
            <lit v=" "/>
          </let>
        </otherwise>
      </choose>
    </def-macro>
    <def-macro n="nnblank_v3" npar="3"><!-- Identical macros, different variables-->
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <b pos="1"/>
                  <lit v=""/>
                </equal>
              </not>
              <not>
                <equal>
                  <b pos="2"/>
                  <lit v=""/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="nnblank3"/>
            <concat>
              <b pos="1"/>
              <b pos="2"/>
            </concat>
          </let>
        </when>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <b pos="1"/>
                  <lit v=""/>
                </equal>
              </not>
              <equal>
                <b pos="2"/>
                <lit v=""/>
              </equal>
            </and>
          </test>
          <let>
            <var n="nnblank3"/>
            <b pos="1"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <b pos="2"/>
                  <lit v=""/>
                </equal>
              </not>
              <equal>
                <b pos="1"/>
                <lit v=""/>
              </equal>
            </and>
          </test>
          <let>
            <var n="nnblank3"/>
            <b pos="2"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="nnblank3"/>
            <lit v=" "/>
          </let>
        </otherwise>
      </choose>
    </def-macro>

    <def-macro n="adjdetpp" npar="1">
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <clip pos="1" side="tl" part="a_adj"/>
                <lit-tag v="adj"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="a_adj"/>
                <lit-tag v="adj.sint"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="a_adj"/>
                <lit-tag v="adj.sint.comp"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="a_adj"/>
                <lit-tag v="adj.sint.sup"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="a_adj"/>
                <lit-tag v="vblex.pp"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="a_adj"/>
                <lit-tag v="vbser.pp"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="a_adj"/>
                <lit-tag v="vblex.sep.pp"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="a_adj"/>
                <lit-tag v="num.ord"/>
              </equal>
            </or>
          </test>
          <let>
            <clip pos="1" side="tl" part="tags"/>
            <clip pos="1" side="tl" part="a_adj"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_adj"/>
              <lit-tag v="num"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="tags"/>
            <concat>
              <clip pos="1" side="tl" part="a_adj"/>
              <clip pos="1" side="tl" part="nbr"/>
            </concat>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_adj"/>
              <lit-tag v="det"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="tags"/>
            <concat>
              <clip pos="1" side="tl" part="a_adj"/>
              <clip pos="1" side="tl" part="tipus_det"/>
              <clip pos="1" side="tl" part="nbr"/>
            </concat>
          </let>
        </when>
      </choose>
    </def-macro>


    <def-macro n="gen_n1" npar="1">
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <clip pos="1" side="tl" part="a_nom"/>
                <lit-tag v="np.ant"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="a_nom"/>
                <lit-tag v="np.cog"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="a_nom"/>
                <lit-tag v="np.ant.m"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="a_nom"/>
                <lit-tag v="np.ant.f"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="genitive"/>
            <concat>
              <lit v="$^'s"/>
              <lit-tag v="gen"/>
            </concat>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genitive"/>
            <lit v=""/>
          </let>
        </otherwise>
      </choose>
    </def-macro>
    <def-macro n="gen_n2" npar="2">
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="pl"/>
              </equal>
              <equal>
                <clip pos="2" side="sl" part="nbr"/>
                <lit-tag v="pl"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="genitive"/>
            <concat>
              <lit v="'"/>
              <lit-tag v="apos"/>
            </concat>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genitive"/>
            <concat>
              <lit v="'s"/>
              <lit-tag v="gen"/>
            </concat>
          </let>
        </otherwise>
      </choose>
    </def-macro>


    <def-macro n="firstWord" npar="1">
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="sl" part="enmajuscula"/>
              <lit v=""/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal> 
                  <var n="EOS"/>
                  <lit v="true"/>
                </equal> 
              </test>
              <modify-case>
                <clip pos="1" side="tl" part="lem"/>
                <lit v="aa"/>
              </modify-case>
              <let>
                <var n="caseFirstWord"/>
                <lit v="Aa"/>
              </let>
            </when>
            <otherwise> 
              <let>
                <var n="caseFirstWord"/>
                <lit v="aa"/>
              </let>
            </otherwise>
          </choose>
        </when>
        <otherwise>
          <let>
            <var n="caseFirstWord"/>
            <lit v="aa"/>
          </let>
        </otherwise>
      </choose>
      <let>
        <var n="EOS"/>
        <lit v="false"/>
      </let>
    </def-macro>


    <def-macro n="adv_adj" npar="2">
	<let>
	  <var n="adv_adjectiu"/>
	  <lit v=""/>
	</let>
	<let>
	  <var n="adv_adjname"/>
	  <lit v=""/>
	</let>
	<choose>
	  <when>
	    <test>
	      <and>
		<equal caseless="yes">
		  <clip pos="1" side="sl" part="lem"/> 
		  <lit v="ago"/>
		</equal>
		<equal caseless="yes">
		  <clip pos="2" side="sl" part="lem"/> 
		  <lit v="lehen"/>
		</equal>
	      </and>
	    </test>
	    <let>
	      <var n="adv_adjectiu"/>
		<concat>
		  <lit v="before"/>
		  <lit-tag v="adv"/>
		</concat>
	    </let>
	    <let>
	      <var n="adv_adjname"/>
	      <lit v="adv"/>
	    </let>
	  </when>
	  <when>
	    <test>
	      <and>
		<equal caseless="yes">
		  <clip pos="1" side="sl" part="lem"/> 
		  <lit v="ago"/>
		</equal>
		<equal>
		  <clip pos="2" side="tl" part="a_adj"/> 
		  <lit-tag v="adj.sint"/>
		</equal>
	      </and>
	    </test>
	    <let>
	      <var n="adv_adjectiu"/>
		<concat>
		  <clip pos="2" side="tl" part="lem"/> 
		  <clip pos="2" side="tl" part="a_adj"/>
		  <lit-tag v="comp"/>
		</concat>
	    </let>
	    <let>
	      <var n="adv_adjname"/>
	      <lit v="adj_"/>
	    </let>
	  </when>
	  <when>
	    <test>
	      <and>
		<equal caseless="yes">
		  <clip pos="1" side="sl" part="lem"/> 
		  <lit v="ago"/>
		</equal>
                <not>
		  <equal>
		    <clip pos="2" side="tl" part="a_adj"/> 
		    <lit-tag v="adj.sint"/>
		  </equal>
                </not>
	      </and>
	    </test>
	    <let>
	      <var n="adv_adjectiu"/>
		<concat>
		  <get-case-from pos="2">
                    <lit v="more"/>
		  </get-case-from>
                  <lit-tag v="preadv"/>
                  <lit v="$ ^"/>
		  <clip pos="2" side="tl" part="lem"/> 
		  <clip pos="2" side="tl" part="a_adj"/>
		</concat>
	    </let>
	    <let>
	      <var n="adv_adjname"/>
	      <lit v="adv_adj_"/>
	    </let>
	  </when>
	  <when>
	    <test>
	      <and>
		<equal caseless="yes">
		  <clip pos="1" side="sl" part="lem"/> 
		  <lit v="en"/>
		</equal>
		<equal>
		  <clip pos="2" side="tl" part="a_adj"/> 
		  <lit-tag v="adj.sint"/>
		</equal>
	      </and>
	    </test>
	    <let>
	      <var n="adv_adjectiu"/>
		<concat>
		  <clip pos="2" side="tl" part="lem"/> 
		  <clip pos="2" side="tl" part="a_adj"/>
		  <lit-tag v="sup"/>
		</concat>
	    </let>
	    <let>
	      <var n="adv_adjname"/>
	      <lit v="adj_"/>
	    </let>
	  </when>
	  <when>
	    <test>
	      <and>
		<equal caseless="yes">
		  <clip pos="1" side="sl" part="lem"/> 
		  <lit v="en"/>
		</equal>
                <not>
		  <equal>
		    <clip pos="2" side="tl" part="a_adj"/> 
		    <lit-tag v="adj.sint"/>
		  </equal>
                </not>
	      </and>
	    </test>
	    <let>
	      <var n="adv_adjectiu"/>
		<concat>
		  <get-case-from pos="2">
                    <lit v="most"/>
		  </get-case-from>
                  <lit-tag v="preadv"/>
                  <lit v="$ ^"/>
		  <clip pos="2" side="tl" part="lem"/> 
		  <clip pos="2" side="tl" part="a_adj"/>
		</concat>
	    </let>
	    <let>
	      <var n="adv_adjname"/>
	      <lit v="adv_adj_"/>
	    </let>
	  </when>
	  <when>
	    <test>
	      <and>
		<equal caseless="yes">
		  <clip pos="1" side="sl" part="lem"/>
		  <lit v="egi"/>
		</equal>
		<equal>
		  <clip pos="2" side="sl" part="a_adj"/>
		  <lit-tag v="vblex.pp"/>
		</equal>
	      </and>
	    </test>
	    <let>
	      <var n="adv_adjectiu"/>
		<concat>
		  <get-case-from pos="2">
		    <lit v="overly"/>
		  </get-case-from>
		  <lit-tag v="preadv"/> 
		  <lit v="$ ^"/>
		  <clip pos="2" side="tl" part="lem"/> 
		  <clip pos="2" side="tl" part="a_adj"/>
		</concat>
	    </let>
	    <let>
	      <var n="adv_adjname"/>
	      <lit v="adj_"/>
	    </let>
	  </when>
	  <when>
	    <test>
	      <and>
		<equal caseless="yes">
		  <clip pos="1" side="sl" part="lem"/>
		  <lit v="egi"/>
		</equal>
		<not>
		  <equal>
		    <clip pos="2" side="sl" part="a_adj"/>
		    <lit-tag v="vblex.pp"/>
		  </equal>
		</not>
	      </and>
	    </test>
	    <let>
	      <var n="adv_adjectiu"/>
		<concat>
		  <get-case-from pos="2">
		    <lit v="too"/>
		  </get-case-from>
		  <lit-tag v="preadv"/> 
		  <lit v="$ ^"/>
		  <clip pos="2" side="tl" part="lem"/> 
		  <clip pos="2" side="tl" part="a_adj"/>
		</concat>
	    </let>
	    <let>
	      <var n="adv_adjname"/>
	      <lit v="adj_"/>
	    </let>
	  </when>
	  <otherwise>
	    <let>
	      <var n="adv_adjectiu"/>
		<concat>
		  <clip pos="1" side="tl" part="whole"/> 
		  <lit v="$ ^"/>
		  <clip pos="2" side="tl" part="lem"/> 
		  <clip pos="2" side="tl" part="a_adj"/>
		</concat>
	    </let>
	    <let>
	      <var n="adv_adjname"/>
	      <lit v="adj_"/>
	    </let>
	  </otherwise>
	</choose>
    </def-macro>



    <def-macro n="concord_n2" npar="2"><!--par 1= nombre; par 2= det/adj/pp -->

      <let>
        <var n="nbr_chunk"/>
        <lit v=""/>
      </let>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/> 
              <lit-tag v="ND"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <and>
                    <equal>
                      <clip pos="2" side="sl" part="lem"/> 
                      <lit v="a"/>
                    </equal>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/> 
                      <lit-tag v="det"/>
                    </equal>
                  </and>
                  <or>
                    <equal>
                      <clip pos="2" side="sl" part="nbr"/> 
                      <lit-tag v="sg"/>
                    </equal>
                    <equal>
                      <clip pos="2" side="sl" part="nbr"/> 
                      <lit-tag v="pl"/>
                    </equal>
                  </or>
                </and>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <clip pos="2" side="sl" part="nbr"/> 
              </let>
              <let>
                <var n="nbr_chunk"/>
                <clip pos="2" side="sl" part="nbr"/> 
              </let>
            </when>
            <when>
              <test>
                <and>
                  <and>
                    <equal>
                      <clip pos="2" side="tl" part="lem"/> 
                      <lit v="this"/>
                    </equal>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/> 
                      <lit-tag v="det"/>
                    </equal>
                  </and>
                  <or>
                    <equal>
                      <clip pos="2" side="sl" part="nbr"/> 
                      <lit-tag v="sg"/>
                    </equal>
                    <equal>
                      <clip pos="2" side="sl" part="nbr"/> 
                      <lit-tag v="pl"/>
                    </equal>
                  </or>
                </and>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <clip pos="2" side="sl" part="nbr"/> 
              </let>
              <let>
                <var n="nbr_chunk"/>
                <clip pos="2" side="sl" part="nbr"/> 
              </let>
            </when>
            <when>
              <test>
                <and>
                  <or>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/> 
                      <lit-tag v="sp"/>
                    </equal>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/> 
                      <lit-tag v=""/>
                    </equal>
                  </or>
                  <or>
                    <equal>
                      <clip pos="2" side="sl" part="nbr"/> 
                      <lit-tag v="sg"/>
                    </equal>
                    <equal>
                      <clip pos="2" side="sl" part="nbr"/> 
                      <lit-tag v="pl"/>
                    </equal>
                  </or>
                </and>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <clip pos="2" side="sl" part="nbr"/> 
              </let>
              <let>
                <var n="nbr_chunk"/>
                <clip pos="2" side="sl" part="nbr"/> 
              </let>
            </when>

            <when>
              <test>
                <equal> 
                  <clip pos="2" side="sl" part="nbr"/> 
                  <lit-tag v="sp"/>
                </equal>
              </test>
              <choose>
                <when>
                  <test>
                    <or>
                      <in caseless="yes">
                        <clip pos="1" side="sl" part="lemh"/>
                        <list n="nombrescol"/>
                      </in>
                      <equal>
                        <clip pos="2" side="tl" part="nbr"/> 
                        <lit-tag v="sg"/>
                      </equal>
                    </or>
                  </test>
                  <let><!--más dinero -->
                    <clip pos="1" side="tl" part="nbr"/> 
                    <lit-tag v="sg"/> 
                  </let>
                  <choose>
                    <when>
                      <test>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/> 
                          <lit-tag v="ND"/>
                        </equal>
                      </test>
                      <let>
                        <clip pos="2" side="tl" part="nbr"/> 
                        <lit-tag v="sg"/> 
                      </let>
                    </when>
                  </choose>
                </when>
                <otherwise> <!-- más coches: si determinante es sp (indefinidos/cuantitativos, se pone pos 1 en plural)-->
                  <let>
                    <clip pos="1" side="tl" part="nbr"/> 
                    <lit-tag v="pl"/> 
                  </let>
                  <choose>
                    <when>
                      <test>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/> 
                          <lit-tag v="ND"/>
                        </equal>
                      </test>
                      <let>
                        <clip pos="2" side="tl" part="nbr"/> 
                        <lit-tag v="pl"/> 
                      </let>
                    </when>
                  </choose>
                </otherwise>
              </choose>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/> 
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/> 
            <clip pos="1" side="tl" part="nbr"/> 
          </let>
        </when>
        <when><!--si ha habido cambio de número de sl a tl, el nombre manda y asigna número al det/adj (oporraldia = las vacaciones) -->
          <test>
            <or>
              <and>
                <equal>
                  <clip pos="2" side="tl" part="nbr"/> 
                  <lit-tag v="sg"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/> 
                  <lit-tag v="pl"/>
                </equal>
              </and>
              <and>
                <equal>
                  <clip pos="2" side="tl" part="nbr"/> 
                  <lit-tag v="pl"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/> 
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </or>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/> 
            <clip pos="1" side="tl" part="nbr"/> 
          </let>
        </when> 
      </choose>
      <!--determinem gènere i nombre del chunk -->

      <choose>
        <when>
          <test>
            <or>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v=""/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="nbr_chunk"/>
            <lit-tag v="ND"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="nbr_chunk"/>
            <clip pos="1" side="tl" part="nbr"/>
          </let>
        </otherwise>
      </choose>
    </def-macro>



    <def-macro n="concord_n3" npar="3"><!--par 1= nombre; par 2= det/adj/pp; par 3=det -->
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <clip pos="2" side="tl" part="a_adj"/>
                <lit-tag v="vblex.pp"/>
              </equal>
              <equal>
                <clip pos="2" side="tl" part="a_adj"/>
                <lit-tag v="vbser.pp"/>
              </equal>
              <equal>
                <clip pos="2" side="sl" part="a_adj"/>
                <lit-tag v="vblex.padv"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="palabra"/>
            <clip pos="2" side="tl" part="whole"/>
          </let>
          <let>
            <clip pos="2" side="tl" part="whole"/>
            <var n="palabra"/>
          </let>
        </when>
      </choose>

      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/> 
              <lit-tag v="ND"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <and>
                    <equal>
                      <clip pos="3" side="sl" part="lem"/> 
                      <lit v="a"/>
                    </equal>
                    <equal>
                      <clip pos="3" side="sl" part="a_det"/> 
                      <lit-tag v="det"/>
                    </equal>
                  </and>
                  <or>
                    <equal>
                      <clip pos="3" side="sl" part="nbr"/> 
                      <lit-tag v="sg"/>
                    </equal>
                    <equal>
                      <clip pos="3" side="sl" part="nbr"/> 
                      <lit-tag v="pl"/>
                    </equal>
                  </or>
                </and>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <clip pos="3" side="sl" part="nbr"/> 
              </let>
            </when>
            <when>
              <test>
                <and>
                  <equal>
                    <clip pos="2" side="tl" part="nbr"/> 
                    <lit-tag v="sp"/>
                  </equal>
                  <or>
                    <equal>
                      <clip pos="2" side="sl" part="nbr"/> 
                      <lit-tag v="sg"/>
                    </equal>
                    <equal>
                      <clip pos="2" side="sl" part="nbr"/> 
                      <lit-tag v="pl"/>
                    </equal>
                  </or>
                </and>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <clip pos="2" side="sl" part="nbr"/> 
              </let>
            </when> 
            <when>
              <test>
                <and>
                  <equal> 
                    <clip pos="2" side="sl" part="nbr"/> 
                    <lit-tag v="sp"/>
                  </equal>
                  <in caseless="yes">
                    <clip pos="1" side="sl" part="lemh"/>
                    <list n="nombrescol"/>
                  </in>
                </and>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <lit-tag v="sg"/> 
              </let>
              <choose>
                <when>
                  <test>
                    <equal>
                      <clip pos="3" side="tl" part="nbr"/> 
                      <lit-tag v="ND"/>
                    </equal>
                  </test>
                  <let>
                    <clip pos="3" side="tl" part="nbr"/> 
                    <lit-tag v="sg"/> 
                  </let>
                </when>
              </choose>
            </when>
            <when>
              <test><!--cuando 2 es sp en origen (determinantes indefinidos) o en destino (adjizl -> det; p. ex. gainerako) -->
                <and>
                  <or>
                    <equal> 
                      <clip pos="2" side="sl" part="nbr"/> 
                      <lit-tag v="sp"/>
                    </equal>
                    <equal> 
                      <clip pos="2" side="tl" part="nbr"/> 
                      <lit-tag v="sp"/>
                    </equal>
                  </or>
                  <equal> 
                    <clip pos="3" side="tl" part="nbr"/> 
                    <lit-tag v="pl"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <lit-tag v="pl"/> 
              </let>
            </when>
            <when>
              <test>
                <and>
                  <or>
                    <equal> 
                      <clip pos="2" side="sl" part="nbr"/> 
                      <lit-tag v="sp"/>
                    </equal>
                    <equal> 
                      <clip pos="2" side="tl" part="nbr"/> 
                      <lit-tag v="sp"/>
                    </equal>
                  </or>
                  <equal> 
                    <clip pos="3" side="tl" part="nbr"/> 
                    <lit-tag v="sg"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <lit-tag v="sg"/> 
              </let>
            </when>
            
            <when>
              <test>
                <and>
                  <equal> 
                    <clip pos="2" side="sl" part="nbr"/> 
                    <lit-tag v="sp"/>
                  </equal>
                  <not>
                    <in caseless="yes">
                      <clip pos="1" side="sl" part="lemh"/>
                      <list n="nombrescol"/>
                    </in>
                  </not>
                </and>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <lit-tag v="pl"/> 
              </let>
              <choose>
                <when>
                  <test>
                    <equal>
                      <clip pos="3" side="tl" part="nbr"/> 
                      <lit-tag v="ND"/>
                    </equal>
                  </test>
                  <let>
                    <clip pos="3" side="tl" part="nbr"/> 
                    <lit-tag v="pl"/> 
                  </let>
                </when>
              </choose>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <equal>
                    <clip pos="3" side="tl" part="nbr"/> 
                    <lit-tag v="sp"/>
                  </equal>
                  <or>
                    <equal>
                      <clip pos="3" side="sl" part="nbr"/> 
                      <lit-tag v="sg"/>
                    </equal>
                    <equal>
                      <clip pos="3" side="sl" part="nbr"/> 
                      <lit-tag v="pl"/>
                    </equal>
                  </or>
                </and>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <clip pos="3" side="sl" part="nbr"/> 
              </let>
              <choose>
                <when>
                  <test>
                    <or>
                      <equal>
                        <clip pos="2" side="tl" part="nbr"/> 
                        <lit-tag v="ND"/>
                      </equal>
                      <equal>
                        <clip pos="2" side="tl" part="nbr"/> 
                        <lit-tag v=""/>
                      </equal>
                    </or>
                  </test>
                  <let>
                    <clip pos="2" side="tl" part="nbr"/> 
                    <clip pos="3" side="sl" part="nbr"/> 
                  </let>
                </when>
              </choose>
            </when>
            <when>
              <test><!--cuando 3 es sp en origen (determinantes indefinidos) -->
                <equal> 
                  <clip pos="3" side="sl" part="nbr"/> 
                  <lit-tag v="sp"/>
                </equal>
              </test>
              <choose>
                <when>
                  <test>
                    <in caseless="yes">
                      <clip pos="1" side="sl" part="lemh"/>
                      <list n="nombrescol"/>
                    </in>
                  </test>
                  <let>
                    <clip pos="1" side="tl" part="nbr"/> 
                    <lit-tag v="sg"/> 
                  </let>
                  <choose>
                    <when>
                      <test>
                        <equal>
                          <clip pos="3" side="tl" part="nbr"/> 
                          <lit-tag v="ND"/>
                        </equal>
                      </test>
                      <let>
                        <clip pos="2" side="tl" part="nbr"/> 
                        <lit-tag v="sg"/> 
                      </let>
                      <let>
                        <var n="nbr_chunk"/>
                        <lit-tag v="sg"/> 
                      </let>
                    </when>
                  </choose>
                  <choose>
                    <when>
                      <test>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/> 
                          <lit-tag v="ND"/>
                        </equal>
                      </test>
                      <let>
                        <clip pos="2" side="tl" part="nbr"/> 
                        <lit-tag v="sg"/> 
                      </let>
                    </when>
                  </choose>
                </when>
                <otherwise>
                  <let>
                    <clip pos="1" side="tl" part="nbr"/> 
                    <lit-tag v="pl"/> 
                  </let>
                  <let>
                    <var n="nbr_chunk"/>
                    <lit-tag v="pl"/> 
                  </let>
                  <choose>
                    <when>
                      <test>
                        <equal>
                          <clip pos="3" side="tl" part="nbr"/> 
                          <lit-tag v="ND"/>
                        </equal>
                      </test>
                      <let>
                        <clip pos="3" side="tl" part="nbr"/> 
                        <lit-tag v="pl"/> 
                      </let>
                      <let>
                        <var n="nbr_chunk"/>
                        <lit-tag v="pl"/> 
                      </let>
                    </when>
                  </choose>
                  <choose>
                    <when>
                      <test>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/> 
                          <lit-tag v="ND"/>
                        </equal>
                      </test>
                      <let>
                        <clip pos="2" side="tl" part="nbr"/> 
                        <lit-tag v="pl"/> 
                      </let>
                    </when>
                  </choose>
                </otherwise>
              </choose>
            </when>
          </choose>
          <choose><!--otros casos: cuando 3 tiene número i 2 es ND (etxe ederra) i 1 es ND -->
            <when>
              <test>
                <equal>
                  <clip pos="2" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/> 
                <clip pos="3" side="tl" part="nbr"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <clip pos="3" side="tl" part="nbr"/>
              </let>
              <let>
                <var n="nbr_chunk"/>
                <clip pos="3" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
        <otherwise><!-- quan 1 no és ND (oporraldi)-->
          <choose>
            <when>
              <test>
                <equal>
                  <clip pos="2" side="tl" part="nbr"/> 
                  <lit-tag v="ND"/>
                </equal>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/> 
                <clip pos="1" side="tl" part="nbr"/> 
              </let>
              <let>
                <var n="nbr_chunk"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <equal>
                  <clip pos="3" side="tl" part="nbr"/> 
                  <lit-tag v="ND"/>
                </equal>
              </test>
              <let>
                <clip pos="3" side="tl" part="nbr"/> 
                <clip pos="1" side="tl" part="nbr"/> 
              </let>
              <let>
                <var n="nbr_chunk"/>
                <clip pos="3" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </otherwise>

      </choose>
      <choose>
        <when><!--si ha habido cambio de número de sl a tl, el nombre manda y asigna número al det o adj (oporraldi ederra = las vacaciones bellas) -->
          <test>
            <or>
              <and>
                <equal>
                  <clip pos="2" side="tl" part="nbr"/> 
                  <lit-tag v="sg"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/> 
                  <lit-tag v="pl"/>
                </equal>
              </and>
              <and>
                <equal>
                  <clip pos="2" side="tl" part="nbr"/> 
                  <lit-tag v="pl"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/> 
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </or>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/> 
            <clip pos="1" side="tl" part="nbr"/> 
          </let>
        </when>
      </choose>
      <choose>
        <when><!--si ha habido cambio de número de sl a tl, el nombre manda y asigna número al det o adj (oporraldi ederra = las vacaciones bellas) -->
          <test>
            <or>
              <and>
                <equal>
                  <clip pos="3" side="tl" part="nbr"/> 
                  <lit-tag v="sg"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/> 
                  <lit-tag v="pl"/>
                </equal>
              </and>
              <and>
                <equal>
                  <clip pos="3" side="tl" part="nbr"/> 
                  <lit-tag v="pl"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/> 
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </or>
          </test>
          <let>
            <clip pos="3" side="tl" part="nbr"/> 
            <clip pos="1" side="tl" part="nbr"/> 
          </let>
          <let>
            <var n="nbr_chunk"/>
            <clip pos="1" side="tl" part="nbr"/>
          </let>
        </when>
      </choose>
      <!--i quan 3 es ND i origen no és sp? es pot donar el cas?? -->

      <choose>
        <when>
          <test>
            <or>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="nbr_chunk"/>
            <lit-tag v="ND"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="nbr_chunk"/>
            <clip pos="1" side="tl" part="nbr"/>
          </let>
        </otherwise>
      </choose> 


    </def-macro>




    <def-macro n="concord_n4" npar="4"><!--par 1= nombre; par 2= adj/pp; par 3=det/adj/pp; par 4=det -->
      <let>
        <var n="nbr_chunk"/>
        <lit v=""/>
      </let>
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <clip pos="2" side="tl" part="a_adj"/>
                <lit-tag v="vblex.pp"/>
              </equal>
              <equal>
                <clip pos="2" side="tl" part="a_adj"/>
                <lit-tag v="vbser.pp"/>
              </equal>
              <equal>
                <clip pos="2" side="sl" part="a_adj"/>
                <lit-tag v="vblex.padv"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="palabra"/>
            <clip pos="2" side="tl" part="whole"/>
          </let>
          <let>
            <clip pos="2" side="tl" part="whole"/>
            <var n="palabra"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <clip pos="3" side="tl" part="a_adj"/>
                <lit-tag v="vblex.pp"/>
              </equal>
              <equal>
                <clip pos="3" side="tl" part="a_adj"/>
                <lit-tag v="vbser.pp"/>
              </equal>
              <equal>
                <clip pos="3" side="sl" part="a_adj"/>
                <lit-tag v="vblex.padv"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="palabra"/>
            <clip pos="3" side="tl" part="whole"/>
          </let>
          <let>
            <clip pos="3" side="tl" part="whole"/>
            <var n="palabra"/>
          </let>
        </when>
      </choose>

      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/> 
              <lit-tag v="ND"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <and>
                    <equal>
                      <clip pos="4" side="sl" part="lem"/> 
                      <lit v="a"/>
                    </equal>
                    <equal>
                      <clip pos="4" side="sl" part="a_det"/> 
                      <lit-tag v="det"/>
                    </equal>
                  </and>
                  <or>
                    <equal>
                      <clip pos="4" side="sl" part="nbr"/> 
                      <lit-tag v="sg"/>
                    </equal>
                    <equal>
                      <clip pos="4" side="sl" part="nbr"/> 
                      <lit-tag v="pl"/>
                    </equal>
                  </or>
                </and>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <clip pos="4" side="sl" part="nbr"/> 
              </let>
              <let>
                <var n="nbr_chunk"/>
                <clip pos="4" side="sl" part="nbr"/> 
              </let>
            </when>
            <when>
              <test><!--cuando 3 tiene número sg o pl -->
                <not>
                  <or>
                    <equal> 
                      <clip pos="3" side="tl" part="nbr"/> 
                      <lit-tag v="ND"/>
                    </equal>
                    <equal> 
                      <clip pos="3" side="tl" part="nbr"/> 
                      <lit-tag v="sp"/>
                    </equal>
                    <equal> 
                      <clip pos="3" side="tl" part="nbr"/> 
                      <lit v=""/>
                    </equal>
                  </or>
                </not>
              </test>
              <let><!--asigna el nbr de 3 a 1 -->
                <clip pos="1" side="tl" part="nbr"/> 
                <clip pos="3" side="tl" part="nbr"/> 
              </let>
              <let>
                <var n="nbr_chunk"/>
                <clip pos="3" side="sl" part="nbr"/> 
              </let>
            </when>
            <when>
              <test><!--cuando 3 es sp en origen (determinantes indefinidos) -->
                <and>
                  <equal> 
                    <clip pos="3" side="sl" part="nbr"/> 
                    <lit-tag v="sp"/>
                  </equal>
                  <equal> 
                    <clip pos="4" side="tl" part="nbr"/> 
                    <lit-tag v="pl"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <lit-tag v="pl"/> 
              </let>
              <let>
                <var n="nbr_chunk"/>
                <lit-tag v="pl"/> 
              </let>
            </when>
            <when>
              <test>
                <and>
                  <equal> 
                    <clip pos="3" side="sl" part="nbr"/> 
                    <lit-tag v="sp"/>
                  </equal>
                  <equal> 
                    <clip pos="4" side="tl" part="nbr"/> 
                    <lit-tag v="sg"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <lit-tag v="sg"/> 
              </let>
              <let>
                <var n="nbr_chunk"/>
                <lit-tag v="sg"/> 
              </let>
            </when>
            <when>
              <test>
                <and>
                  <equal> 
                    <clip pos="3" side="sl" part="nbr"/> 
                    <lit-tag v="sp"/>
                  </equal>
                  <in caseless="yes">
                    <clip pos="1" side="sl" part="lemh"/>
                    <list n="nombrescol"/>
                  </in>
                </and>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <lit-tag v="sg"/> 
              </let>
              <choose>
                <when>
                  <test>
                    <equal>
                      <clip pos="4" side="tl" part="nbr"/> 
                      <lit-tag v="ND"/>
                    </equal>
                  </test>
                  <let>
                    <clip pos="4" side="tl" part="nbr"/> 
                    <lit-tag v="sg"/> 
                  </let>
                  <let>
                    <var n="nbr_chunk"/> 
                    <lit-tag v="sg"/> 
                  </let>
                </when>
              </choose>
            </when>
            <when>
              <test>
                <and>
                  <equal> 
                    <clip pos="3" side="sl" part="nbr"/> 
                    <lit-tag v="sp"/>
                  </equal>
                  <not>
                    <in caseless="yes">
                      <clip pos="1" side="sl" part="lemh"/>
                      <list n="nombrescol"/>
                    </in>
                  </not>
                </and>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <lit-tag v="pl"/> 
              </let>
              <let>
                <var n="nbr_chunk"/>
                <lit-tag v="pl"/> 
              </let>
              <choose>
                <when>
                  <test>
                    <equal>
                      <clip pos="4" side="tl" part="nbr"/> 
                      <lit-tag v="ND"/>
                    </equal>
                  </test>
                  <let>
                    <clip pos="4" side="tl" part="nbr"/> 
                    <lit-tag v="pl"/> 
                  </let>
                </when>
              </choose>
            </when>
          </choose>

          <choose>
            <when>
              <test><!--cuando 4 es sp en origen (determinantes indefinidos) -->
                <equal> 
                  <clip pos="4" side="sl" part="nbr"/> 
                  <lit-tag v="sp"/>
                </equal>
              </test>
              <choose>
                <when>
                  <test>
                    <in caseless="yes">
                      <clip pos="1" side="sl" part="lemh"/>
                      <list n="nombrescol"/>
                    </in>
                  </test>
                  <let>
                    <clip pos="1" side="tl" part="nbr"/> 
                    <lit-tag v="sg"/> 
                  </let>
                  <choose>
                    <when>
                      <test>
                        <equal>
                          <clip pos="4" side="tl" part="nbr"/> 
                          <lit-tag v="ND"/>
                        </equal>
                      </test>
                      <let>
                        <clip pos="3" side="tl" part="nbr"/> 
                        <lit-tag v="sg"/> 
                      </let>
                    </when>
                  </choose>
                  <choose>
                    <when>
                      <test>
                        <equal>
                          <clip pos="3" side="tl" part="nbr"/> 
                          <lit-tag v="ND"/>
                        </equal>
                      </test>
                      <let>
                        <clip pos="3" side="tl" part="nbr"/> 
                        <lit-tag v="sg"/> 
                      </let>
                    </when>
                  </choose>
                </when>
                <otherwise>
                  <let>
                    <clip pos="1" side="tl" part="nbr"/> 
                    <lit-tag v="pl"/> 
                  </let>
                  <let>
                    <var n="nbr_chunk"/>
                   <lit-tag v="pl"/> 
                  </let>
                  <choose>
                    <when>
                      <test>
                        <equal>
                          <clip pos="4" side="tl" part="nbr"/> 
                          <lit-tag v="ND"/>
                        </equal>
                      </test>
                      <let>
                        <clip pos="4" side="tl" part="nbr"/> 
                        <lit-tag v="pl"/> 
                      </let>
                    </when>
                  </choose>
                  <choose>
                    <when>
                      <test>
                        <equal>
                          <clip pos="3" side="tl" part="nbr"/> 
                          <lit-tag v="ND"/>
                        </equal>
                      </test>
                      <let>
                        <clip pos="3" side="tl" part="nbr"/> 
                        <lit-tag v="pl"/> 
                      </let>
                    </when>
                  </choose>
                </otherwise>
              </choose>
            </when>
          </choose>
          <choose><!--otros casos: cuando 4 tiene número i 3 es ND (etxe ederra) -->
            <when>
              <test>
                <equal>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </test>
              <let>
                <clip pos="3" side="tl" part="nbr"/> 
                <clip pos="4" side="tl" part="nbr"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="nbr"/> 
                <clip pos="4" side="tl" part="nbr"/>
              </let>
              <let>
                <var n="nbr_chunk"/>
                <clip pos="4" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose><!--y finalmente, si el 2 es ND, a estas alturas de la regla el nombre ya tiene número, que se asignará a 2 -->
            <when>
              <test>
                <equal>
                  <clip pos="2" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/> 
                <clip pos="1" side="tl" part="nbr"/>
              </let>
              <let>
                <var n="nbr_chunk"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose><!--comprobación final: si ha habido cambio de número de sl a tl, el nombre manda y asigna número a det y adj (oporraldi ederra = las vacaciones bellas -->
        <when>
          <test>
            <or>
              <and>
                <equal>
                  <clip pos="2" side="tl" part="nbr"/> 
                  <lit-tag v="sg"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/> 
                  <lit-tag v="pl"/>
                </equal>
              </and>
              <and>
                <equal>
                  <clip pos="2" side="tl" part="nbr"/> 
                  <lit-tag v="pl"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/> 
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </or>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/> 
            <clip pos="1" side="tl" part="nbr"/> 
          </let>
        </when>
      </choose>
      <choose>
        <when><!--si ha habido cambio de número de sl a tl, el nombre manda y asigna número a det y adj (oporraldi ederra = las vacaciones bellas) -->
          <test>
            <or>
              <and>
                <equal>
                  <clip pos="3" side="tl" part="nbr"/> 
                  <lit-tag v="sg"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/> 
                  <lit-tag v="pl"/>
                </equal>
              </and>
              <and>
                <equal>
                  <clip pos="3" side="tl" part="nbr"/> 
                  <lit-tag v="pl"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/> 
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </or>
          </test>
          <let>
            <clip pos="3" side="tl" part="nbr"/> 
            <clip pos="1" side="tl" part="nbr"/> 
          </let>
        </when>
      </choose>
      <choose>
        <when><!--si ha habido cambio de número de sl a tl, el nombre manda y asigna número a det y adj (oporraldi ederra = las vacaciones bellas) -->
          <test>
            <or>
              <and>
                <equal>
                  <clip pos="4" side="tl" part="nbr"/> 
                  <lit-tag v="sg"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/> 
                  <lit-tag v="pl"/>
                </equal>
              </and>
              <and>
                <equal>
                  <clip pos="4" side="tl" part="nbr"/> 
                  <lit-tag v="pl"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/> 
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </or>
          </test>
          <let>
            <clip pos="4" side="tl" part="nbr"/> 
            <clip pos="1" side="tl" part="nbr"/> 
          </let>
        </when>
      </choose>

      <choose>
        <when>
          <test>
            <or>
              <equal>
                <clip pos="4" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="nbr_chunk"/>
            <lit-tag v="ND"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="nbr_chunk"/>
            <clip pos="1" side="tl" part="nbr"/>
          </let>
        </otherwise>
      </choose>

    </def-macro>
    




    <def-macro n="concord_adj_det" npar="2"><!--par 1= adj; par 2= det/adj -->

      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/> 
              <lit-tag v="ND"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/> 
                  <lit-tag v="sp"/>
                </equal>
              </test>
              <let>
                <var n="nbr_chunk"/>
                <lit-tag v="ND"/>
              </let>
            </when>
            <otherwise>
              <let>
                <clip pos="2" side="tl" part="nbr"/> 
                <clip pos="1" side="tl" part="nbr"/>
              </let>
              <let>
                <var n="nbr_chunk"/> 
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </otherwise>
          </choose>
        </when>
        <otherwise><!--si el 2 no és ND -->
          <choose>
            <when>
              <test><!--quan el 2 és plural -->
                <equal>
                  <clip pos="2" side="tl" part="nbr"/>
                  <lit-tag v="pl"/>
                </equal>
              </test>
              <choose>
                <when>
                  <test>
                    <equal>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="ND"/>
                    </equal>
                  </test>
                  <let>
                    <clip pos="1" side="tl" part="nbr"/>
                    <clip pos="2" side="tl" part="nbr"/>
                  </let>
                  <let>
                    <var n="nbr_chunk"/>
                    <lit-tag v="pl"/>
                  </let>
                </when>
              </choose>
            </when>
            <otherwise><!--quan el 2 no és ni ND ni plural -->
              <let>
                <var n="nbr_chunk"/> 
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </otherwise>
          </choose>
        </otherwise>
      </choose>


    </def-macro>

    <def-macro n="gen_prn" npar="1"><!-- vosotros/vosotras - solució provisional -->
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/> 
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/> 
            <lit-tag v="m"/>
          </let>
        </when>
      </choose>
    </def-macro>

    <def-macro n="nbr_n1" npar="1"><!-- asignar singular cuando el nombre va sin determinante -->
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <lit-tag v="sg"/>
          </let>
        </when>
      </choose>
    </def-macro>

    <def-macro n="num_ord" npar="1">
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="sl" part="a_adj"/>
              <lit-tag v="num"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="a_adj"/>
            <lit-tag v="num.ord"/>
          </let>
        </when>
      </choose>
    </def-macro>


    <def-macro n="posesivo" npar="2"><!--Parameter 1 = pronoun/demonstrative. Parameter 2 = noun -->
      <let>
        <clip pos="1" side="tl" part="det_pos"/> 
        <lit-tag v="det.pos"/>
      </let>
      <choose>
        <when>
          <test>
            <or>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="hura"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="ber"/>
              </equal>
            </or>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/> 
            <lit v="his"/>
          </let>
        </when>
        <when>
          <test>
            <or>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="beraiek"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="eurak"/>
              </equal>
            </or>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/> 
            <lit v="their"/>
          </let>
        </when>
        <when>
          <test>
            <or>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="ni"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="neu"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="en"/>
              </equal>
            </or>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/> 
            <lit v="my"/>
          </let>
        </when>
        <when>
          <test>
            <or>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="zu"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="hi"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="zeu"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="heu"/>
              </equal>
            </or>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/> 
            <lit v="your"/>
          </let>
          <let>
            <clip pos="1" side="tl" part="nbr"/> 
            <lit-tag v="sp"/>
          </let>
        </when>
        <when>
          <test>
            <or>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="gu"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="geu"/>
              </equal>
            </or>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/> 
            <lit v="our"/>
          </let>
          <let>
            <clip pos="1" side="tl" part="nbr"/> 
            <lit-tag v="sp"/>
          </let>
          <let>
            <clip pos="1" side="tl" part="gen"/> 
            <clip pos="2" side="tl" part="gen"/>  
          </let>
        </when>
        <when>
          <test>
            <or>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="zuek"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="zeuek"/>
              </equal>
            </or>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/> 
            <lit v="your"/>
          </let>
          <let>
            <clip pos="1" side="tl" part="nbr"/> 
            <lit-tag v="sp"/>
          </let>
          <let>
            <clip pos="1" side="tl" part="gen"/> 
            <clip pos="2" side="tl" part="gen"/>  
          </let>
        </when>
      </choose>
    </def-macro>


    <def-macro n="posesivo_det" npar="2"><!--Parameter 1 = pronoun/demonstrative. Parameter 2 = determiner -->
      <let>
        <clip pos="1" side="tl" part="det_pos"/> 
        <lit-tag v="adj.pos"/>
      </let> 
      <let>
        <clip pos="1" side="tl" part="nbr"/> 
        <lit v=""/> 
      </let>
      <choose>
        <when>
          <test>
            <or>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="hura"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="ber"/>
              </equal>
            </or>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/> 
            <lit v="his"/>
          </let>
        </when>
        <when>
          <test>
            <or>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="beraiek"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="eurak"/>
              </equal>
            </or>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/> 
            <lit v="theirs"/>
          </let>
        </when>
        <when>
          <test>
            <or>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="ni"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="neu"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="en"/>
              </equal>
            </or>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/> 
            <lit v="mine"/>
          </let>
        </when>
        <when>
          <test>
            <or>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="zu"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="hi"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="zeu"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="heu"/>
              </equal>
            </or>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/> 
            <lit v="yours"/>
          </let>
        </when>
        <when>
          <test>
            <or>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="gu"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="geu"/>
              </equal>
            </or>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/> 
            <lit v="ours"/>
          </let>
        </when>
        <when>
          <test>
            <or>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="zuek"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="zeuek"/>
              </equal>
            </or>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/> 
            <lit v="yours"/>
          </let>
        </when>
      </choose>
    </def-macro>


    <def-macro n="SPgenitivo" npar="1"><!--if the postposition is ko/en, the chunk tag will be SPGEN so t2x can carry out the necessary operations. Note: there are rules which detect chunks with these ('aitaren etxea'), the genitive mark is for the chunks that escape these rules, so t2x can deal with them. -->

      <choose>
        <when>
          <test>
            <or>
              <equal>
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="en"/>
              </equal>
              <equal>
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="ko"/>
              </equal>
              <equal>
                <clip pos="1" side="sl" part="a_post"/> 
                <lit-tag v="ko"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="chunk"/>
            <lit-tag v="SPGEN"/>
          </let>
        </when>
        <when>
          <test>
            <or>
              <equal>
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="k"/>
              </equal>
              <equal>
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="ik"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="chunk"/>
            <lit-tag v="SN"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="chunk"/>
            <lit-tag v="SPR"/>
          </let>
        </otherwise>
      </choose>
      <choose><!-- if the postposition is 'k', as the translation is empty, eliminate the blank. The blank after the postposition must output it with the variable 'blanco'-->
        <when>
          <test>
            <or>
              <equal>
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="k"/>
              </equal>
              <equal>
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="ik"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="blanco"/>
            <lit v=""/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="blanco"/>
            <lit v=" "/>
          </let>
        </otherwise>
      </choose>
    </def-macro>


    <def-macro n="tipo_det" npar="1">
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_det"/>
              <lit-tag v="predet"/>
            </equal>
          </test>
          <let>
            <var n="tipusdet"/>
            <lit-tag v=""/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="tipus_det"/>
              <lit-tag v="dem"/>
            </equal>
          </test>
          <let>
            <var n="tipusdet"/>
            <lit-tag v="dem"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="sl" part="tipus_det"/>
              <lit-tag v="art"/>
            </equal>
          </test>
          <let>
            <var n="tipusdet"/>
            <lit-tag v="def"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="sl" part="tipus_det"/>
              <lit-tag v="num"/>
            </equal>
          </test>
          <let>
            <var n="tipusdet"/>
            <lit-tag v="ind"/>
          </let>
          <let>
            <clip pos="1" side="tl" part="tipus_adj"/>
            <lit-tag v="ord"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="tipusdet"/>
            <clip pos="1" side="tl" part="tipus_det"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <or>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/>
                <lit v="gutxiago"/>
              </equal>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/>
                <lit v="gehiago"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="grado"/>
            <lit-tag v="comp"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="grado"/>
            <lit v=""/>
          </let>
        </otherwise>
      </choose>

    </def-macro>

    <def-macro n="verbal_flex" npar="1">
    <!--Determines the person of the verb and generates pronouns, and outputs the subject pronoun if necessary. 
        IMPORTANT: this macro must be called right before the output of the verb, because of the pronoun generation.
        It also outputs 'maybe' if the verb is either prob1 or prob2 (A2 and B3 in the old tagset): probable present and past respectively. 
        Unlike the eu-es version, as 
-->
      <let>
        <var n="aux_verb"/>
        <lit v=""/>
      </let>
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <clip pos="1" side="sl" part="temps"/>
                <lit-tag v="prob1"/>
              </equal>
              <equal>
                <clip pos="1" side="sl" part="temps"/>
                <lit-tag v="prob2"/>
              </equal>
            </or>
          </test>
           <choose>
             <when>
              <test>
                <equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="prob1"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="tl" part="temps"/>
                <lit-tag v="pri"/>
              </let>
            </when>
            <when>
              <test>
                <equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="prob2"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="tl" part="temps"/>
                <lit-tag v="past"/>
              </let>
            </when>
          </choose>
          <out>
            <chunk name="quiza" case="caseFirstWord">
              <tags>
                <tag><lit-tag v="SADV"/></tag>
                <tag><lit-tag v="adv"/></tag>
              </tags>
              <lu>
                <lit v="maybe"/>
                <lit-tag v="adv"/>
              </lu>
            </chunk>
            <b/>
          </out>
          <let>
            <var n="caseFirstWord"/>
            <lit v="aa"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test><!--if the verb is NOR-NORI or NOR-NORI-NORK, output the NORI pronoun. -->
            <not>
              <equal>
                <clip pos="1" side="sl" part="nori"/>
                <lit v=""/>
              </equal>
            </not>
          </test>
          <choose>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nori"/>
                  <lit-tag v="NI_NI"/>
                </equal>
              </test>
              <let>
                <var n="procltags"/>
                <lit-tag v="prn.obj.p1.mf.sg"/>
              </let>
            </when>
            <when>
              <test>
                <or>
                  <equal> 
                    <clip pos="1" side="sl" part="nori"/>
                    <lit-tag v="NI_ZU"/>
                  </equal>
                  <equal> 
                    <clip pos="1" side="sl" part="nori"/>
                    <lit-tag v="NI_HI"/>
                  </equal>
                </or>
              </test>
              <let>
                <var n="procltags"/>
                <lit-tag v="prn.obj.p2.mf.sp"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nori"/>
                  <lit-tag v="NI_HU"/>
                </equal>
              </test>
              <let> <!-- TODO: make this configurable. The hard part is, Basque pronouns have no gender. Assume m ('he') for object -->
                <var n="procltags"/>
                <lit-tag v="prn.obj.p3.m.sg"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nori"/>
                  <lit-tag v="NI_GU"/>
                </equal>
              </test>
              <let>
                <var n="procltags"/>
                <lit-tag v="prn.obj.p1.mf.pl"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nori"/>
                  <lit-tag v="NI_ZK"/>
                </equal>
              </test>
              <let>
                <var n="procltags"/>
                <lit-tag v="prn.obj.p2.mf.sp"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nori"/>
                  <lit-tag v="NI_HK"/>
                </equal>
              </test>
              <let>
                <var n="procltags"/>
                <lit-tag v="prn.obj.p3.mf.pl"/>
              </let>
            </when>
          </choose>
        </when>
        <when>
          <test><!--if we meet a verb NOR-NORK whose NOR isn't 3rd sg or 3rd pl, set the pronoun with the value of NOR -->
            <and>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="nork"/>
                  <lit v=""/>
                </equal>
              </not>
              <not>
                <equal> 
                  <clip pos="1" side="sl" part="nor"/>
                  <lit-tag v="NR_HU"/>
                </equal>
              </not>
              <not>
                <equal> 
                  <clip pos="1" side="sl" part="nor"/>
                  <lit-tag v="NR_HK"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nor"/>
                  <lit-tag v="NR_NI"/>
                </equal>
              </test>
              <let>
                <var n="objtags"/>
                <lit-tag v="prn.obj.p1.mf.sg"/>
              </let>
            </when>
            <when>
              <test>
                <or>
                  <equal> 
                    <clip pos="1" side="sl" part="nor"/>
                    <lit-tag v="NR_ZU"/>
                  </equal>
                  <equal> 
                    <clip pos="1" side="sl" part="nor"/>
                    <lit-tag v="NR_HI"/>
                  </equal>
                </or>
              </test>
              <let>
                <var n="objtags"/>
                <lit-tag v="prn.obj.p2.mf.sp"/>
              </let>
            </when>
<!--            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nor"/>
                  <lit-tag v="NR_HU"/>
                </equal>
              </test>
              <let>
                <var n="objtags"/>
                <lit-tag v="prn.obj.p3.nt.sg"/>
              </let>
            </when>-->
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nor"/>
                  <lit-tag v="NR_GU"/>
                </equal>
              </test>
              <let>
                <var n="objtags"/>
                <lit-tag v="prn.obj.p1.mf.pl"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nor"/>
                  <lit-tag v="NR_ZK"/>
                </equal>
              </test>
              <let>
                <var n="objtags"/>
                <lit-tag v="prn.obj.p2.mf.sp"/>
              </let>
            </when>
<!--            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nor"/>
                  <lit-tag v="NR_HK"/>
                </equal>
              </test>
              <let>
                <var n="objtags"/>
                <lit-tag v="prn.obj.p3.mf.pl"/>
              </let>
            </when>-->
          </choose>
        </when>
        <otherwise>
          <let>
            <var n="caseSecondWord"/>
            <var n="caseFirstWord"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <not>
              <equal>
                <clip pos="1" side="sl" part="nork"/>
                <lit v=""/>
              </equal>
            </not>
          </test>
          <choose>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nork"/>
                  <lit-tag v="NK_NI"/>
                </equal>
              </test>
              <let>
                <var n="subjtags"/>
                <lit-tag v="prn.subj.p1.mf.sg"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="persnbr"/>
                <lit-tag v="p1.sg"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nork"/>
                  <lit-tag v="NK_ZU"/>
                </equal>
              </test>
              <let>
                <var n="subjtags"/>
                <lit-tag v="prn.subj.p2.mf.sp"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="persnbr"/>
                <lit-tag v="p2.sg"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nork"/>
                  <lit-tag v="NK_HI"/>
                </equal>
              </test>
              <let>
                <var n="subjtags"/>
                <lit-tag v="prn.subj.p2.mf.sp"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="persnbr"/>
                <lit-tag v="p2.sg"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nork"/>
                  <lit-tag v="NK_HU"/>
                </equal>
              </test>
              <let> <!-- make this configurable -->
                <var n="subjtags"/>
                <lit-tag v="prn.subj.p3.m.sg"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="persnbr"/>
                <lit-tag v="p3.sg"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nork"/>
                  <lit-tag v="NK_GU"/>
                </equal>
              </test>
              <let>
                <var n="subjtags"/>
                <lit-tag v="prn.subj.p1.mf.pl"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="persnbr"/>
                <lit-tag v="p1.pl"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nork"/>
                  <lit-tag v="NK_ZK"/>
                </equal>
              </test>
              <let>
                <var n="subjtags"/>
                <lit-tag v="prn.subj.p2.mf.sp"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="persnbr"/>
                <lit-tag v="p2.pl"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nork"/>
                  <lit-tag v="NK_HK"/>
                </equal>
              </test>
              <let>
                <var n="subjtags"/>
                <lit-tag v="prn.subj.p3.mf.pl"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="persnbr"/>
                <lit-tag v="p3.pl"/>
              </let>
            </when>
          </choose>
        </when>
        <otherwise><!--when the verb doesn't have a NORK subject -->
          <choose>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nor"/>
                  <lit-tag v="NR_NI"/>
                </equal>
              </test>
              <let>
                <var n="subjtags"/>
                <lit-tag v="prn.subj.p1.mf.sg"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="persnbr"/>
                <lit-tag v="p1.sg"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nor"/>
                  <lit-tag v="NR_ZU"/>
                </equal>
              </test>
              <let>
                <var n="subjtags"/>
                <lit-tag v="prn.subj.p2.mf.sp"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="persnbr"/>
                <lit-tag v="p2.sg"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nor"/>
                  <lit-tag v="NR_HI"/>
                </equal>
              </test>
              <let>
                <var n="subjtags"/>
                <lit-tag v="prn.subj.p2.mf.sp"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="persnbr"/>
                <lit-tag v="p2.sg"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nor"/>
                  <lit-tag v="NR_HU"/>
                </equal>
              </test>
              <let>
                <var n="subjtags"/>
                <lit-tag v="prn.subj.p3.m.sg"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="persnbr"/>
                <lit-tag v="p3.sg"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nor"/>
                  <lit-tag v="NR_GU"/>
                </equal>
              </test>
              <let>
                <var n="subjtags"/>
                <lit-tag v="prn.subj.p1.mf.pl"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="persnbr"/>
                <lit-tag v="p1.pl"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nor"/>
                  <lit-tag v="NR_ZK"/>
                </equal>
              </test>
              <let>
                <var n="subjtags"/>
                <lit-tag v="prn.subj.p2.mf.sp"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="persnbr"/>
                <lit-tag v="p2.pl"/>
              </let>
            </when>
            <when>
              <test>
                <equal> 
                  <clip pos="1" side="sl" part="nor"/>
                  <lit-tag v="NR_HK"/>
                </equal>
              </test>
              <let>
                <var n="subjtags"/>
                <lit-tag v="prn.subj.p3.mf.pl"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="persnbr"/>
                <lit-tag v="p3.pl"/>
              </let>
            </when>
          </choose>
        </otherwise>       
      </choose>
      <choose> <!-- no pronoun for imperative -->
        <when>
          <test>
  	    <not>
              <or>
                <equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="imp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="inf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
              </or>
      	    </not>
          </test>
          <out>
            <chunk name="prnsubj" case="caseFirstWord">
              <tags>
                <tag><var n="subjtags"/></tag>
              </tags>
              <lu>
                <lit v="prpers"/>
                <var n="subjtags"/>
              </lu>
            </chunk>
            <b/>
          </out>
          <let>
            <var n="caseSecondWord"/>
            <lit v="aa"/>
          </let>
        </when>
      </choose>

      <choose>
        <when>
          <test>
            <or>
              <equal>
                <clip pos="1" side="tl" part="temps"/>
                <lit-tag v="pri"/>
              </equal> 
              <equal>
                <clip pos="1" side="tl" part="temps"/>
                <lit-tag v="pres"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="temps"/>
                <lit-tag v="potpr"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="temps"/>
                <lit-tag v="prs"/>
              </equal>
            </or>
          </test>
          <choose>
            <when>
              <test>
                <or>
                  <and>
                    <equal>
                      <clip pos="1" side="tl" part="persnbr"/>
                      <lit-tag v="p3.sg"/>
                    </equal>
                    <not>
                      <and>
                        <equal>
                          <clip pos="1" side="tl" part="lemh"/>
                          <lit v="can"/>
                        </equal>
                        <equal>
                          <clip pos="1" side="tl" part="a_verb"/>
                          <lit-tag v="vaux"/>
                        </equal>
                      </and>
                    </not>
                  </and>

                  <and>
                    <equal>
                      <clip pos="1" side="tl" part="lemh"/>
                      <lit v="be"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="tl" part="persnbr"/>
                      <lit-tag v="p1.sg"/>
                    </equal>
                  </and>
                </or>
              </test>
              <let>
                <clip pos="1" side="tl" part="temps"/>
                <lit-tag v="pri"/>
              </let>
            </when>
            <otherwise>
              <let>
                <clip pos="1" side="tl" part="temps"/>
                <lit-tag v="pres"/>
              </let>
              <let> <!-- due to an unexpected side-effect in transfer, we need to first set 'nori', 'nork' and 'nor' to nothing, so that setting 'persnbr' to nothing can't fall back to their values. This is Twilight Zone stuff. -->
                <clip pos="1" side="tl" part="nori"/>
                <lit v=""/>
              </let>
              <let>
                <clip pos="1" side="tl" part="nork"/>
                <lit v=""/>
              </let>
              <let>
                <clip pos="1" side="tl" part="nor"/>
                <lit v=""/>
              </let>
              <let>
                <clip pos="1" side="tl" part="persnbr"/>
                <lit v=""/>
              </let>
            </otherwise>
          </choose>
          <let>
            <var n="aux_verb"/>
            <lit v=""/>
          </let>
        </when>
        <when>
          <test>
            <or>
              <equal>
                <clip pos="1" side="tl" part="temps"/>
                <lit-tag v="past"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="temps"/>
                <lit-tag v="pii"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="temps"/>
                <lit-tag v="pis"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="temps"/>
                <lit-tag v="potps"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="temps"/>
                <lit-tag v="bald"/>
              </equal>
            </or>
          </test>
          <choose>
            <when>
              <test>
                <not>
                  <and>
                    <equal>
                      <clip pos="1" side="tl" part="lemh"/>
                      <lit v="be"/>
                    </equal>
                    <or>
                      <equal>
                        <clip pos="1" side="tl" part="persnbr"/>
                        <lit-tag v="p3.sg"/>
                      </equal>
                      <equal>
                        <clip pos="1" side="tl" part="persnbr"/>
                        <lit-tag v="p1.sg"/>
                      </equal>
                    </or>
                  </and>
                </not>
              </test>
              <let> <!-- due to an unexpected side-effect in transfer, we need to first set 'nori', 'nork' and 'nor' to nothing, so that setting 'persnbr' to nothing can't fall back to their values. This is Twilight Zone stuff. -->
                <clip pos="1" side="tl" part="nori"/>
                <lit v=""/>
              </let>
              <let>
                <clip pos="1" side="tl" part="nork"/>
                <lit v=""/>
              </let>
              <let>
                <clip pos="1" side="tl" part="nor"/>
                <lit v=""/>
              </let>
              <let>
                <clip pos="1" side="tl" part="persnbr"/>
                <lit-tag v=""/>
              </let>
            </when>
          </choose>
          <let>
            <clip pos="1" side="tl" part="temps"/>
            <lit-tag v="past"/>
          </let>
          <let>
            <var n="aux_verb"/>
            <lit v=""/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="fti"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <clip pos="1" side="tl" part="lem"/>
                  <lit v="can"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="tl" part="lem"/>
                <lit v="be able to"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="a_verb"/>
                <lit-tag v="vbmod"/>
              </let>
            </when>
          </choose>
          <let> <!-- due to an unexpected side-effect in transfer, we need to first set 'nori', 'nork' and 'nor' to nothing, so that setting 'persnbr' to nothing can't fall back to their values. This is Twilight Zone stuff. -->
            <clip pos="1" side="tl" part="nori"/>
            <lit v=""/>
          </let>
          <let>
            <clip pos="1" side="tl" part="nork"/>
            <lit v=""/>
          </let>
          <let>
            <clip pos="1" side="tl" part="nor"/>
            <lit v=""/>
          </let>
          <let>
            <clip pos="1" side="tl" part="persnbr"/>
            <lit-tag v=""/>
          </let>
          <let>
            <clip pos="1" side="tl" part="temps"/>
            <lit-tag v="inf"/>
          </let>
          <let>
            <var n="aux_verb"/>
            <concat>
              <lit v="^will"/>
              <lit-tag v="vaux.inf"/>
              <lit v="$ "/>
            </concat>
          </let>
        </when>
        <when>
          <test>
            <or>
              <equal>
                <clip pos="1" side="tl" part="temps"/>
                <lit-tag v="onpr"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="temps"/>
                <lit-tag v="cni"/>
              </equal>
              <equal> <!-- FIXME: double check -->
                <clip pos="1" side="tl" part="temps"/>
                <lit-tag v="poth"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="aux_verb"/>
            <concat>
              <lit v="^would"/>
              <lit-tag v="vaux.inf"/>
              <lit v="$ "/>
            </concat>
          </let>
          <let>
            <clip pos="1" side="tl" part="tags"/>
            <concat>
              <clip pos="1" side="tl" part="a_verb"/>
              <lit-tag v="inf"/>
            </concat>
          </let>
          <let> <!-- due to an unexpected side-effect in transfer, we need to first set 'nori', 'nork' and 'nor' to nothing, so that setting 'persnbr' to nothing can't fall back to their values. This is Twilight Zone stuff. -->
            <clip pos="1" side="tl" part="nori"/>
            <lit v=""/>
          </let>
          <let>
            <clip pos="1" side="tl" part="nork"/>
            <lit v=""/>
          </let>
          <let>
            <clip pos="1" side="tl" part="nor"/>
            <lit v=""/>
          </let>
          <let>
            <clip pos="1" side="tl" part="persnbr"/>
            <lit-tag v=""/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="fti"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <equal>
                    <clip pos="1" side="tl" part="lem"/>
                    <lit v="can"/>
                  </equal>
                  <equal>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <lit-tag v="vaux"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="1" side="tl" part="lem"/>
                <lit v="be able to"/>
              </let>
              <let>
                <clip pos="1" side="tl" part="a_verb"/>
                <lit-tag v="vbmod"/>
              </let>
            </when>
          </choose>
          <let>
            <var n="aux_verb"/>
            <concat>
              <lit v="^will"/>
              <lit-tag v="vaux.inf"/>
              <lit v="$ "/>
            </concat>
          </let>
          <let>
            <clip pos="1" side="tl" part="tags"/>
            <concat>
              <clip pos="1" side="tl" part="a_verb"/>
              <lit-tag v="inf"/>
            </concat>
          </let>
          <let> <!-- due to an unexpected side-effect in transfer, we need to first set 'nori', 'nork' and 'nor' to nothing, so that setting 'persnbr' to nothing can't fall back to their values. This is Twilight Zone stuff. -->
            <clip pos="1" side="tl" part="nori"/>
            <lit v=""/>
          </let>
          <let>
            <clip pos="1" side="tl" part="nork"/>
            <lit v=""/>
          </let>
          <let>
            <clip pos="1" side="tl" part="nor"/>
            <lit v=""/>
          </let>
          <let>
            <clip pos="1" side="tl" part="persnbr"/>
            <lit-tag v=""/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="imp"/>
            </equal>
          </test>
          <let>
            <var n="aux_verb"/>
            <lit v=""/>
          </let>
          <let>
            <clip pos="1" side="tl" part="tags"/>
            <concat>
              <clip pos="1" side="tl" part="a_verb"/>
              <lit-tag v="inf"/>
            </concat>
          </let>
          <let> <!-- due to an unexpected side-effect in transfer, we need to first set 'nori', 'nork' and 'nor' to nothing, so that setting 'persnbr' to nothing can't fall back to their values. This is Twilight Zone stuff. -->
            <clip pos="1" side="tl" part="nori"/>
            <lit v=""/>
          </let>
          <let>
            <clip pos="1" side="tl" part="nork"/>
            <lit v=""/>
          </let>
          <let>
            <clip pos="1" side="tl" part="nor"/>
            <lit v=""/>
          </let>
          <let>
            <clip pos="1" side="tl" part="persnbr"/>
            <lit-tag v=""/>
          </let>
        </when>
      </choose>
    </def-macro>

    <def-macro n="sep_pron" npar="1">
      <!-- handle object pronoun with separable verbs -->
      <choose>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="a_verb"/>
                <lit-tag v="vblex.sep"/>
              </equal>
              <not>
                <equal>
                  <var n="procltags"/>
                  <lit v=""/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="prn_enc"/>
            <concat>
              <lit v="+prpers"/>
              <var n="procltags"/>
            </concat>
          </let>
          <let>
            <var n="procltags"/>
            <lit v=""/>
          </let>
        </when>
        <otherwise>
          <let> 
            <var n="prn_enc"/>
            <lit v=""/>
          </let>
        </otherwise>
      </choose>
    </def-macro>

    <def-macro n="objdat_pron" npar="1">
      <choose>
        <when>
          <test>
            <not>
              <equal>
                <var n="objtags"/>
                <lit v=""/>
              </equal>
            </not>
          </test>
          <out>
            <b/>
            <chunk name="prnobj" case="caseSecondWord">
            <tags>
              <tag><var n="objtags"/></tag>
            </tags>
              <lu>
                <lit v="prpers"/>
                <var n="objtags"/>
              </lu>
            </chunk>
          </out>
        </when>
        <when>
          <test>
            <not>
              <equal>
                <var n="procltags"/>
                <lit v=""/>
              </equal>
            </not>
          </test>
          <out>
            <b/>
            <chunk name="pr_datobj" case="caseSecondWord">
            <tags>
              <tag><var n="procltags"/></tag>
            </tags>
              <lu>
                <lit v="to"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="prpers"/>
                <var n="procltags"/>
              </lu>
            </chunk>
          </out>
        </when>
      </choose>
      <let>
        <var n="objtags"/>
        <lit v=""/>
      </let>
      <let>
        <var n="procltags"/>
        <lit v=""/>
      </let>
    </def-macro>
    <def-macro n="do_flex" npar="1">
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="tl" part="temps"/>
                  <lit-tag v="past"/>
                </equal>
                <not>
                  <equal>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <lit-tag v="vbser"/>
                  </equal>
                </not>
              </and>
            </test>
            <let>
              <var n="aux_verb"/>
              <concat>
                <lit v="^do"/>
                <lit-tag v="vbdo.past"/>
                <lit v="$ "/>
              </concat>
            </let>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="inf"/>
            </let>
            <let>
              <clip pos="1" side="tl" part="persnbr"/>
              <lit v=""/>
            </let>
            <let>
              <clip pos="1" side="tl" part="nori"/>
              <lit v=""/>
            </let>
            <let>
              <clip pos="1" side="tl" part="nork"/>
              <lit v=""/>
            </let>
            <let>
              <clip pos="1" side="tl" part="nor"/>
              <lit v=""/>
            </let>
          </when>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="tl" part="temps"/>
                  <lit-tag v="pres"/>
                </equal>
                <not>
                  <equal>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <lit-tag v="vbser"/>
                  </equal>
                </not>
              </and>
            </test>
            <let>
              <var n="aux_verb"/>
              <concat>
                <lit v="^do"/>
                <lit-tag v="vbdo.pres"/>
                <lit v="$ "/>
              </concat>
            </let>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="inf"/>
            </let>
            <let>
              <clip pos="1" side="tl" part="persnbr"/>
              <lit v=""/>
            </let>
            <let>
              <clip pos="1" side="tl" part="nori"/>
              <lit v=""/>
            </let>
            <let>
              <clip pos="1" side="tl" part="nork"/>
              <lit v=""/>
            </let>
            <let>
              <clip pos="1" side="tl" part="nor"/>
              <lit v=""/>
            </let>
          </when>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="tl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="persnbr"/>
                  <lit-tag v="p3.sg"/>
                </equal>
                <not>
                  <equal>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <lit-tag v="vbser"/>
                  </equal>
                </not>
              </and>
            </test>
            <let>
              <var n="aux_verb"/>
              <concat>
                <lit v="^do"/>
                <lit-tag v="vbdo.pri.p3.sg"/>
                <lit v="$ "/>
              </concat>
            </let>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="inf"/>
            </let>
            <let>
              <clip pos="1" side="tl" part="persnbr"/>
              <lit v=""/>
            </let>
            <let>
              <clip pos="1" side="tl" part="nori"/>
              <lit v=""/>
            </let>
            <let>
              <clip pos="1" side="tl" part="nork"/>
              <lit v=""/>
            </let>
            <let>
              <clip pos="1" side="tl" part="nor"/>
              <lit v=""/>
            </let>
          </when>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="imp"/>
                </equal>
                <equal>
                  <var n="aux_verb"/>
                  <lit v=""/>
                </equal>
              </and>
            </test>
            <let>
              <var n="aux_verb"/>
              <concat>
                <lit v="^do"/>
                <lit-tag v="vbdo.inf"/>
                <lit v="$ "/>
              </concat>
            </let>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="inf"/>
            </let>
            <let>
              <clip pos="1" side="tl" part="nori"/>
              <lit v=""/>
            </let>
            <let>
              <clip pos="1" side="tl" part="nork"/>
              <lit v=""/>
            </let>
            <let>
              <clip pos="1" side="tl" part="nor"/>
              <lit v=""/>
            </let>
            <let>
              <clip pos="1" side="tl" part="persnbr"/>
              <lit v=""/>
            </let>
          </when>
        </choose>
    </def-macro>

    <def-macro n="ser_tener" npar="2"><!--ser o tener, esta es la cuestión :-)
                This macro checks if the auxiliary is transitive and if the principal verb is 'izan' (which translates to English as 'be'). If so, change the translation from 'be' to 'have' (izango duzue - you will be - you will have.)
It could be extended to other cases, to deal with the differences in the translation of the second verb if the auxiliary is transitive or intransitive.
 -->
        <choose>
          <when>
            <test>
              <and>
                <equal caseless="yes">
                  <clip pos="1" side="tl" part="lemh"/>
                  <lit v="be"/>
                </equal>
                <not>
                  <equal caseless="yes">
                    <clip pos="2" side="sl" part="nork"/>
                    <lit v=""/>
                  </equal>
                </not>
              </and>
            </test>
            <let>
              <clip pos="1" side="tl" part="lemh"/>
              <get-case-from pos="1">
                <lit v="have"/>
              </get-case-from>
            </let>
            <let>
              <clip pos="1" side="tl" part="a_verb"/>
              <lit-tag v="vbhaver"/>
            </let>
          </when>
        </choose>
</def-macro>
    <def-macro n="swap_temps" npar="2">
        <let>
          <clip pos="1" side="tl" part="persnbr"/>
          <clip pos="2" side="tl" part="persnbr"/>
        </let>
        <let>
          <clip pos="1" side="tl" part="temps"/>
          <clip pos="2" side="tl" part="temps"/>
        </let>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="2" side="tl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="2" side="tl" part="persnbr"/>
                  <lit-tag v="p3.sg"/>
                </equal>
              </and>
            </test>
            <let>
              <clip pos="1" side="tl" part="tags"/>
              <concat>
                <clip pos="1" side="tl" part="a_verb"/>
                <lit-tag v="pri.p3.sg"/>
              </concat>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="2" side="tl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="2" side="tl" part="persnbr"/>
                  <lit-tag v="p1.sg"/>
                </equal>
                <not>
                  <equal>
                    <clip pos="1" side="tl" part="lemh"/>
                    <lit v="be"/>
                  </equal>
                </not>
              </and>
            </test>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="pres"/>
            </let>
            <let>
              <clip pos="1" side="tl" part="persnbr"/>
              <lit v=""/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="2" side="tl" part="temps"/>
                  <lit-tag v="past"/>
                </equal>
                <equal>
                  <clip pos="2" side="tl" part="persnbr"/>
                  <lit-tag v="p3.sg"/>
                </equal>
                <equal>
                  <clip pos="2" side="tl" part="lemh"/>
                  <lit v="be"/>
                </equal>
                <not>
                  <equal>
                    <clip pos="1" side="tl" part="lemh"/>
                    <lit v="be"/>
                  </equal>
                </not>
              </and>
            </test>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="past"/>
            </let>
            <let>
              <clip pos="1" side="tl" part="persnbr"/>
              <lit v=""/>
            </let>
          </when>
        </choose>
  </def-macro>


  </section-def-macros>

  <section-rules>

    <!--********************************* REGLES DE SN   **************************************************** -->


    <rule comment="REGLA: NOM ( per a col·locar la cua en les multiparaules amb g i traduir noms sense determinant">
      <pattern>
        <pattern-item n="nom_np"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <out> 
          <chunk name="nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN.UNDET"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <lit-tag v="3"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: NOM guio NOM">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="guio"/>
        <pattern-item n="nom_np"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="gen_n1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nnblank_v1">
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <out> 
          <chunk name="nom_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN.UNDET"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
              <var n="genitive"/> 
            </lu>
            <var n="nnblank1"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <lit-tag v="3"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: DET (guztiak, gehienak) For when it appears alone or with unknown words">
      <pattern>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="det" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="1" side="tl" part="ND" link-to="3"/>
              <clip pos="1" side="tl" part="sp"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: DETIND For when it appears alone or with unknown words">
      <pattern>
        <pattern-item n="detindizl"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="det" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="1" side="tl" part="ND" link-to="3"/>
              <clip pos="1" side="tl" part="sp"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NUM (For when it appears alone or with unknown words)">
      <pattern>
        <pattern-item n="num"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="num" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><lit-tag v="num"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NOM + DET (etxea - the house)">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="2"/>
        </call-macro>
        <out> 
          <chunk name="det_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="2" side="tl" part="ND" link-to="3"/>
              <clip pos="2" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="ND" link-to="3"/>
              <clip pos="1" side="tl" part="sp"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NUM + ko + MONTH + a + en + NUM + a (1926ko apirilaren 21a - April 21st, 1926)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="ko"/>
        <pattern-item n="month"/>
        <pattern-item n="det"/>
        <pattern-item n="en"/>
        <pattern-item n="num"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="3"/>
        </call-macro>
        <out> 
          <chunk name="num_month_num" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><lit-tag v="DET"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="6" side="tl" part="lem"/> 
              <lit-tag v="num.ord"/>
            </lu>
            <lu>
              <lit v=","/>
              <lit-tag v="cm"/>
            </lu>
            <b pos="5"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: MONTH + a + en + NUM + a (apirilaren 21a - April 21st)">
      <pattern>
        <pattern-item n="month"/>
        <pattern-item n="det"/>
        <pattern-item n="en"/>
        <pattern-item n="num"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="num_month" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><lit-tag v="DET"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="4" side="tl" part="lem"/> 
              <lit-tag v="num.ord"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: NUM + ko + MONTH + a + k + NUM (2009ko maiatzak 16 - May 16 2009)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="ko"/>
        <pattern-item n="month"/>
        <pattern-item n="det"/>
        <pattern-item n="k"/>
        <pattern-item n="num"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="3"/>
        </call-macro>
        <out> 
          <chunk name="num_month_num" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><lit-tag v="DET"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="6" side="tl" part="lem"/> 
              <lit-tag v="num"/>
            </lu>
            <b pos="5"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: NUM + ko + MONTH + a + en + NUM + POST (1926ko apirilaren 21an - on April 21st, 1926)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="ko"/>
        <pattern-item n="month"/>
        <pattern-item n="det"/>
        <pattern-item n="en"/>
        <pattern-item n="num"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="7" side="sl" part="lemh"/>
                <lit v="an"/>
              </equal>
            </test>
            <let>
              <clip pos="7" side="tl" part="lemh"/>
              <lit v="on"/>
            </let>
          </when>
        </choose>
        <out> 
          <chunk name="pr_num_month_num" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><lit-tag v="DET"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="7" side="tl" part="lem"/> 
              <clip pos="7" side="tl" part="a_prep"/> 
            </lu>
            <b/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="6" side="tl" part="lem"/> 
              <lit-tag v="num.ord"/>
            </lu>
            <lu>
              <lit v=","/>
              <lit-tag v="cm"/>
            </lu>
            <b pos="5"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: MONTH + a + en + NUM + POST (apirilaren 21an - on April 21st)">
      <pattern>
        <pattern-item n="month"/>
        <pattern-item n="det"/>
        <pattern-item n="en"/>
        <pattern-item n="num"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="5" side="sl" part="lemh"/>
                <lit v="an"/>
              </equal>
            </test>
            <let>
              <clip pos="5" side="tl" part="lemh"/>
              <lit v="on"/>
            </let>
          </when>
        </choose>
        <out> 
          <chunk name="pr_num_month" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><lit-tag v="DET"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="5" side="tl" part="lem"/> 
              <clip pos="5" side="tl" part="a_prep"/> 
            </lu>
            <b/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="4" side="tl" part="lem"/> 
              <lit-tag v="num.ord"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: NUM + urte + a + ko + MONTH + a + en + NUM + a (1926 urteko apirilaren 21a - April 21st, 1926)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="urte"/>
        <pattern-item n="det"/>
        <pattern-item n="ko"/>
        <pattern-item n="month"/>
        <pattern-item n="det"/>
        <pattern-item n="en"/>
        <pattern-item n="num"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="5"/>
        </call-macro>
        <out> 
          <chunk name="num_month_num" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><lit-tag v="DET"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="5" side="tl" part="lemh"/> 
              <clip pos="5" side="tl" part="a_nom"/>
              <clip pos="5" side="tl" part="nbr"/>
              <clip pos="5" side="tl" part="lemq"/> 
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="8" side="tl" part="lem"/> 
              <lit-tag v="num.ord"/>
            </lu>
            <lu>
              <lit v=","/>
              <lit-tag v="cm"/>
            </lu>
            <b pos="4"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
        <call-macro n="f_bcond">
          <with-param pos="7"/>
          <with-param pos="8"/>
        </call-macro>
      </action>
    </rule>
    <rule comment="REGLA: NUM + urte + a + ko + MONTH + a + en + NUM + a (1926 urteko apirilaren 17tik - from April 21st, 1926)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="urte"/>
        <pattern-item n="det"/>
        <pattern-item n="ko"/>
        <pattern-item n="month"/>
        <pattern-item n="det"/>
        <pattern-item n="en"/>
        <pattern-item n="num"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="5"/>
        </call-macro>
        <out> 
          <chunk name="pr_num_month_num" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><lit-tag v="DET"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="9" side="tl" part="whole"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="5" side="tl" part="lemh"/> 
              <clip pos="5" side="tl" part="a_nom"/>
              <clip pos="5" side="tl" part="nbr"/>
              <clip pos="5" side="tl" part="lemq"/> 
            </lu>
            <b pos="4"/>
            <lu> 
              <clip pos="8" side="tl" part="lem"/> 
              <lit-tag v="num.ord"/>
            </lu>
            <lu>
              <lit v=","/>
              <lit-tag v="cm"/>
            </lu>
            <b pos="7"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NOM + NOM + DET (etxe proiektua - the house project)">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <or>
                  <equal>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant"/> 
                  </equal>
                  <equal>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant.m"/> 
                  </equal>
                  <equal>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant.f"/> 
                  </equal>
                  <equal>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.cog"/> 
                  </equal>
                </or>
                <not> <!-- if it's ant/cog + ant/cog, no genitive -->
                  <or>
                    <equal>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant"/> 
                    </equal>
                    <equal>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant.m"/> 
                    </equal>
                    <equal>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant.f"/> 
                    </equal>
                    <equal>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <lit-tag v="np.cog"/> 
                    </equal>
                  </or>
                </not>
                <and>
                  <equal>
                    <clip pos="3" side="tl" part="lem"/>
                    <lit v="the"/>
                  </equal>
                  <equal>
                    <clip pos="3" side="tl" part="a_det"/>
                    <lit-tag v="det"/>
                  </equal>
                </and>
              </and>
            </test>
            <out> 
              <chunk name="nom_gen_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
                <lu> 
                  <lit v="'s"/>
                  <lit-tag v="gen"/> 
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="ND" link-to="3"/>
                  <clip pos="2" side="tl" part="sp"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out> <!-- no f_bcond, because the remaining space is artificial -->
          </when>
          <otherwise>
            <out> 
              <chunk name="det_nom_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="3" side="tl" part="lem"/> 
                  <clip pos="3" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="ND" link-to="3"/>
                  <clip pos="2" side="tl" part="sp"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    <rule comment="REGLA: NOM-NOM + DET (etxea)">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="guio"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="nnblank_v1">
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <or>
                  <equal>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant"/> 
                  </equal>
                  <equal>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant.m"/> 
                  </equal>
                  <equal>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant.f"/> 
                  </equal>
                  <equal>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.cog"/> 
                  </equal>
                </or>
                <not> <!-- if it's ant/cog + ant/cog, no genitive -->
                  <or>
                    <equal>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant"/> 
                    </equal>
                    <equal>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant.m"/> 
                    </equal>
                    <equal>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant.f"/> 
                    </equal>
                    <equal>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <lit-tag v="np.cog"/> 
                    </equal>
                  </or>
                </not>
                <and>
                  <equal>
                    <clip pos="4" side="tl" part="lem"/>
                    <lit v="the"/>
                  </equal>
                  <equal>
                    <clip pos="4" side="tl" part="a_det"/>
                    <lit-tag v="det"/>
                  </equal>
                </and>
              </and>
            </test>
            <choose>
              <when>
                <test>
                  <equal>
                    <var n="nnblank1"/>
                    <lit v=" "/>
                  </equal>
                </test>
                <let>
                  <var n="nnblank1"/>
                  <lit v=""/>
                </let>
              </when>
            </choose>
            <out> 
              <chunk name="nom_gen_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
                <var n="nnblank1"/>
                <lu> 
                  <lit v="'s"/>
                  <lit-tag v="gen"/> 
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out> 
              <chunk name="det_nom_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="4" side="tl" part="lem"/> 
                  <clip pos="4" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="4" side="tl" part="ND" link-to="3"/>
                  <clip pos="4" side="tl" part="sp"/>
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
                <var n="nnblank1"/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    <rule comment="REGLA: NOM + NOM + DET + POST (urre koloreko - of the gold colour (though in this case 'of the colour of gold' is a superior translation))">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <or>
                  <equal>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant"/> 
                  </equal>
                  <equal>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant.m"/> 
                  </equal>
                  <equal>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant.f"/> 
                  </equal>
                  <equal>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.cog"/> 
                  </equal>
                </or>
                <not> <!-- if it's ant/cog + ant/cog, no genitive -->
                  <or>
                    <equal>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant"/> 
                    </equal>
                    <equal>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant.m"/> 
                    </equal>
                    <equal>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant.f"/> 
                    </equal>
                    <equal>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <lit-tag v="np.cog"/> 
                    </equal>
                  </or>
                </not>
                <and>
                  <equal>
                    <clip pos="3" side="tl" part="lem"/>
                    <lit v="the"/>
                  </equal>
                  <equal>
                    <clip pos="3" side="tl" part="a_det"/>
                    <lit-tag v="det"/>
                  </equal>
                </and>
              </and>
            </test>
            <out> 
              <chunk name="pr_nom_gen_nom" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="4" side="tl" part="lem"/> 
                  <clip pos="4" side="tl" part="a_prep"/> 
                </lu>
                <var n="blanco"/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
                <lu> 
                  <lit v="'s"/>
                  <lit-tag v="gen"/> 
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="ND" link-to="3"/>
                  <clip pos="2" side="tl" part="sp"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out> <!-- no f_bcond, because the remaining space is artificial -->
          </when>
          <otherwise>
            <out> 
              <chunk name="pr_det_nom_nom" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="4" side="tl" part="lem"/> 
                  <clip pos="4" side="tl" part="a_prep"/> 
                </lu>
                <var n="blanco"/>
                <lu>
                  <clip pos="3" side="tl" part="lem"/> 
                  <clip pos="3" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="ND" link-to="3"/>
                  <clip pos="2" side="tl" part="sp"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    <rule comment="REGLA: NOM guio NOM + DET + POST (urre-koloreko - of the gold colour)">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="guio"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="nnblank_v1">
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <or>
                  <equal>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant"/> 
                  </equal>
                  <equal>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant.m"/> 
                  </equal>
                  <equal>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant.f"/> 
                  </equal>
                  <equal>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.cog"/> 
                  </equal>
                </or>
                <not> <!-- if it's ant/cog + ant/cog, no genitive -->
                  <or>
                    <equal>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant"/> 
                    </equal>
                    <equal>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant.m"/> 
                    </equal>
                    <equal>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant.f"/> 
                    </equal>
                    <equal>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <lit-tag v="np.cog"/> 
                    </equal>
                  </or>
                </not>
                <and>
                  <equal>
                    <clip pos="4" side="tl" part="lem"/>
                    <lit v="the"/>
                  </equal>
                  <equal>
                    <clip pos="4" side="tl" part="a_det"/>
                    <lit-tag v="det"/>
                  </equal>
                </and>
              </and>
            </test>
            <choose>
              <when>
                <test>
                  <equal>
                    <var n="nnblank1"/>
                    <lit v=" "/>
                  </equal>
                </test>
                <let>
                  <var n="nnblank1"/>
                  <lit v=""/>
                </let>
              </when>
            </choose>
            <out> 
              <chunk name="pr_nom_gen_nom" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="5" side="tl" part="lem"/> 
                  <clip pos="5" side="tl" part="a_prep"/> 
                </lu>
                <var n="blanco"/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
                <var n="nnblank1"/>
                <lu> 
                  <lit v="'s"/>
                  <lit-tag v="gen"/> 
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out> 
              <chunk name="pr_det_nom_nom" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="5" side="tl" part="lem"/> 
                  <clip pos="5" side="tl" part="a_prep"/> 
                </lu>
                <var n="blanco"/>
                <lu>
                  <clip pos="4" side="tl" part="lem"/> 
                  <clip pos="4" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="4" side="tl" part="ND" link-to="3"/>
                  <clip pos="4" side="tl" part="sp"/>
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
                <var n="nnblank1"/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>


    <rule comment="REGLA: NOM + ADJ + DET (etxe gorria)">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="3"/>
        </call-macro>
        <out> 
          <chunk name="det_adj_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="3" side="tl" part="ND" link-to="3"/>
              <clip pos="3" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="ND" link-to="3"/>
              <clip pos="1" side="tl" part="sp"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NOM + PP + IK (alaba izanik - habiendo sido hija... (para que no entre por la regla siguiente)">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="pp"/>
        <pattern-item n="part"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><lit-tag v="UNDET"/></tag>
              <tag><lit-tag v="sg"/></tag>
            </tags>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="ND" link-to="3"/>
              <clip pos="1" side="tl" part="sp"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
          <b pos="1"/>
          <chunk name="pp_ik"> 
            <tags>
              <tag><lit-tag v="SVsub"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><lit-tag v="ger"/></tag>
            </tags>
            <lu>
              <lit v="have"/>
              <lit-tag v="vbhaver.ger"/>
            </lu>
            <b/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>




    <rule comment="REGLA: NOM + ADJ + POST (balio juridikorik)">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="3"/>
        </call-macro>
        <out> 
          <chunk name="pr_adj_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><lit-tag v="UNDET"/></tag>
              <tag><var n="nbr_chunk"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lem"/>
              <clip pos="3" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu> 
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="tags"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="ND" link-to="3"/>
              <clip pos="1" side="tl" part="sp"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
            <b/>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: NOM + POST (etxetara; gaurko)">
      <pattern>
        <pattern-item n="nom_adv"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <out> 
          <chunk name="pr_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><lit-tag v="UNDET"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_prep"/>
            </lu>
            <var n="blanco"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <!--   <clip pos="1" side="tl" part="a_adv"/>-->
              <lit-tag v="3"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NOM + POST (osasun zentrotatik - por centro de salud)">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="nom"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="2"/>
        </call-macro>

        <out> 
          <chunk name="pr_nom_pr_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><lit-tag v="UNDET"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lem"/>
              <clip pos="3" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu> 
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <lit v="of"/>
              <lit-tag v="pr"/>
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NOM + DET + POST (etxera)">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal caseless="yes">
                  <clip pos="3" side="sl" part="lem"/>
                  <lit v="z"/>
                </equal>
                <in caseless="yes">
                  <clip pos="1" side="sl" part="lem"/>
                  <list n="lang"/>
                </in>
              </and>
            </test>
            <out> 
              <chunk name="in_lang" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <lit v="in"/> 
                  <lit-tag v="pr"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="ND" link-to="3"/>
                  <clip pos="1" side="tl" part="sp"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <when>
            <test>
              <or>
                <and>
                  <equal caseless="yes">
                    <clip pos="1" side="tl" part="a_nom"/>
                    <lit-tag v="np.loc"/>
                  </equal>
                  <equal caseless="yes">
                    <clip pos="1" side="tl" part="sp"/>
                    <lit-tag v="sg"/>
                  </equal>
                </and>
                <equal caseless="yes">
                  <clip pos="1" side="tl" part="a_nom"/>
                  <lit-tag v="np.ant"/>
                </equal>
              </or>
            </test>
            <out> 
              <chunk name="pr_nom" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="3" side="tl" part="lem"/> 
                  <clip pos="3" side="tl" part="a_prep"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="ND" link-to="3"/>
                  <clip pos="1" side="tl" part="sp"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out> 
              <chunk name="pr_det_nom" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="3" side="tl" part="lem"/> 
                  <clip pos="3" side="tl" part="a_prep"/>
                </lu>
                <var n="blanco"/>
                <lu>
                  <clip pos="2" side="tl" part="lem"/> 
                  <clip pos="2" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="2" side="tl" part="ND" link-to="3"/>
                  <clip pos="2" side="tl" part="sp"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="ND" link-to="3"/>
                  <clip pos="1" side="tl" part="sp"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    <rule comment="REGLA: ANT + NOM + DET + POST (etxera)">
      <pattern>
        <pattern-item n="ant"/>
        <pattern-item n="nom"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="3"/>
        </call-macro>
            <out> 
              <chunk name="pr_det_nom_ant" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="4" side="tl" part="lem"/> 
                  <clip pos="4" side="tl" part="a_prep"/>
                </lu>
                <var n="blanco"/>
                <lu>
                  <clip pos="3" side="tl" part="lem"/> 
                  <clip pos="3" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="ND" link-to="3"/>
                  <clip pos="2" side="tl" part="sp"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="sp"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
      </action>
    </rule>

    <rule comment="REGLA: NOM + ADJ + DET + POST (etxe gorrira)">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <chunk name="pr_det_adj_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_prep"/>
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="3" side="tl" part="ND" link-to="3"/>
              <clip pos="3" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="ND" link-to="3"/>
              <clip pos="1" side="tl" part="sp"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NOM + CONJ + NOM + POST (Araba eta Bizkaiko)">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="conj"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="3"/>
        </call-macro>
        <out> 
          <chunk name="pr_nom_cj_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><lit-tag v="UNDET"/></tag>
              <tag><clip pos="3" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_prep"/>
            </lu>
            <var n="blanco"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="2" side="tl" part="whole"/> 
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>




    <rule comment="REGLA: NOM, NOM + CONJ + NOM + POST (Gipuzkoa, Araba eta Bizkaiko)">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="cm"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="conj"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="6"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="5"/>
        </call-macro>
        <out> 
          <chunk name="pr_nom_nom_cj_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><lit-tag v="UNDET"/></tag>
              <tag><clip pos="5" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="6" side="tl" part="lem"/> 
              <clip pos="6" side="tl" part="a_prep"/>
            </lu>
            <var n="blanco"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
            <lu> 
              <clip pos="2" side="tl" part="whole"/> 
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="4" side="tl" part="whole"/> 
            </lu>
            <b pos="4"/>
            <lu> 
              <clip pos="5" side="tl" part="lemh"/> 
              <clip pos="5" side="tl" part="a_nom"/>
              <clip pos="5" side="tl" part="nbr"/>
              <clip pos="5" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NOM + CONJ + NOM + DET (familia eta lana)">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="conj"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="det_nom_cj_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="gen_chunk"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="2" side="tl" part="whole"/> 
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
            </lu>
            <b/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="ND" link-to="3"/>
              <clip pos="3" side="tl" part="sp"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NOM + DET + CONJ + NOM + DET (lana eta familia)">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="conj"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="4"/>
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="5"/>
        </call-macro>
        <out> 
          <chunk name="det_nom_cj_det_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="whole"/> 
            </lu>
            <b/>
            <lu>
              <clip pos="5" side="tl" part="lem"/> 
              <clip pos="5" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="5" side="tl" part="ND" link-to="3"/>
              <clip pos="5" side="tl" part="sp"/>
            </lu>
            <b/>
            <lu> 
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
              <clip pos="4" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NOM + DET + CONJ + NOM (lana eta familia)(per quan el tagger s'equivoca i tria 'familia' sense det">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="conj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="4"/>
        </call-macro>
        <out> 
          <chunk name="nom_cj_det_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><clip pos="4" side="tl" part="nbr"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="whole"/> 
            </lu>
            <b/>
            <lu> 
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
              <clip pos="4" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


<!-- segmentation!
    < rule comment="REGLA: NUM + NOM + CONJ + NOM (bi ordu eta erdi) ">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="conj"/>
        <pattern-item n="nom_adv"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="2"/>
        </call-macro>
        <let>
          <clip pos="4" side="tl" part="nbr"/>
          <lit-tag v="sg"/>
        </let>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="sl" part="lem"/>
                <lit v="erdi"/>
              </equal>
            </test>
            <let>
              <clip pos="4" side="tl" part="lem"/>
              <lit v="a half"/>
            </let>
            <let>
              <clip pos="4" side="tl" part="a_nom"/>
              <lit-tag v="adj"/>
            </let>
            <call-macro n="adjdetpp">
              <with-param pos="4"/>
            </call-macro>
            <out> 
              <chunk name="num_conj_nom_n" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><lit-tag v="UNDET"/></tag>
                  <tag><clip pos="2" side="tl" part="nbr"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="a_num"/> 
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="3" side="tl" part="whole"/> 
                </lu>
                <b pos="2"/>      
                <lu> 
                  <clip pos="4" side="tl" part="lemh"/> 
                  <clip pos="4" side="tl" part="tags"/>
                  <clip pos="4" side="tl" part="lemq"/> 
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out> 
              <chunk name="num_n_conj_nom" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><lit-tag v="UNDET"/></tag>
                  <tag><clip pos="2" side="tl" part="nbr"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="a_num"/> 
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="whole"/> 
                </lu>
                <b pos="3"/>      
                <lu> 
                  <clip pos="4" side="tl" part="lemh"/> 
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="nbr"/>
                  <clip pos="4" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
-->
    <rule comment="REGLA: NUM + NOM + CONJ + NOM + POST (bi ordu eta erdiko (bilera)) ">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="conj"/>
        <pattern-item n="nom_adv"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="2"/>
        </call-macro>
        <let>
          <clip pos="4" side="tl" part="nbr"/>
          <lit-tag v="sg"/>
        </let>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="sl" part="lem"/>
                <lit v="erdi"/>
              </equal>
            </test>
            <let>
              <clip pos="4" side="tl" part="lem"/>
              <lit v="a half"/>
            </let>
            <let>
              <clip pos="4" side="tl" part="a_nom"/>
              <lit-tag v="adj"/>
            </let>
            <call-macro n="adjdetpp">
              <with-param pos="4"/>
            </call-macro>
            <out> 
              <chunk name="pr_num_conj_nom_n" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><lit-tag v="UNDET"/></tag>
                  <tag><clip pos="2" side="tl" part="nbr"/></tag>
                </tags>
                <lu>
                  <clip pos="5" side="tl" part="lem"/> 
                  <clip pos="5" side="tl" part="a_prep"/>
                </lu>
                <var n="blanco"/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="a_num"/> 
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="3" side="tl" part="whole"/> 
                </lu>
                <b pos="2"/>      
                <lu> 
                  <clip pos="4" side="tl" part="lemh"/> 
                  <clip pos="4" side="tl" part="tags"/>
                  <clip pos="4" side="tl" part="lemq"/> 
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out> 
              <chunk name="pr_num_n_conj_nom" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><lit-tag v="UNDET"/></tag>
                  <tag><clip pos="2" side="tl" part="nbr"/></tag>
                </tags>
                <lu>
                  <clip pos="5" side="tl" part="lem"/> 
                  <clip pos="5" side="tl" part="a_prep"/>
                </lu>
                <var n="blanco"/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="a_num"/> 
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="whole"/> 
                </lu>
                <b pos="3"/>      
                <lu> 
                  <clip pos="4" side="tl" part="lemh"/> 
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="nbr"/>
                  <clip pos="4" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: PRONOMBREpers ( para asignar género a 'nosotros' y 'vosotros'. Por ahora será 'm' por defecto) ">
      <pattern>
        <pattern-item n="prnpers"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="gen_prn">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="hura"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="lem"/> 
              <lit v="prpers"/>
            </let>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="1" side="tl" part="nbr"/> 
                    <lit-tag v="pl"/>
                  </equal>
                </test>
                <let>
                  <clip pos="1" side="tl" part="det_prn"/> 
                  <lit-tag v="prn.subj.p3.mf"/>
                </let>
              </when>
              <otherwise>
                <let>
                  <clip pos="1" side="tl" part="det_prn"/> 
                  <lit-tag v="prn.subj.p3.nt"/>
                </let>
              </otherwise>
            </choose>
          </when>
        </choose>
        
        <out> 
          <chunk name="prnpers" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="PRN"/></tag>
              <tag><clip pos="1" side="tl" part="tipus_prn"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu> 
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: PRONOMBREpers + k (nik) ">
      <pattern>
        <pattern-item n="prnpers"/>
        <pattern-item n="k"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="gen_prn">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/> 
                <lit v="hura"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="lem"/> 
              <lit v="prpers"/>
            </let>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="1" side="tl" part="nbr"/> 
                    <lit-tag v="pl"/>
                  </equal>
                </test>
                <let>
                  <clip pos="1" side="tl" part="det_prn"/> 
                  <lit-tag v="prn.subj.p3.mf"/>
                </let>
              </when>
              <otherwise>
                <let>
                  <clip pos="1" side="tl" part="det_prn"/> 
                  <lit-tag v="prn.subj.p3.nt"/>
                </let>
              </otherwise>
            </choose>
          </when>
        </choose> 
        <out> 
          <chunk name="prnpers" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="PRN"/></tag>
              <tag><clip pos="1" side="tl" part="tipus_prn"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><lit-tag v="erg"/></tag>
            </tags>
            <lu> 
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: PRONOMBREpers + POST(gurekin, norekin - con nosotros, con quién) ">
      <pattern>
        <pattern-item n="prnpers"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="gen_prn">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal caseless="yes">
                  <clip pos="1" side="tl" part="lem"/>
                  <lit v="prpers"/>
                </equal>
                <equal caseless="yes">
                  <clip pos="1" side="tl" part="det_pos"/>
                  <lit-tag v="prn.subj"/>
                </equal>
              </and>
            </test>
            <let>
              <clip pos="1" side="tl" part="det_pos"/>
              <lit-tag v="prn.obj"/>
            </let>
          </when>
          <when>
            <test>
              <and>
                <equal caseless="yes">
                  <clip pos="1" side="tl" part="lem"/>
                  <lit v="who"/>
                </equal>
                <equal caseless="yes">
                  <clip pos="1" side="tl" part="tags"/>
                  <lit-tag v="prn.itg.m.sp"/>
                </equal>
              </and>
            </test>
            <let>
              <clip pos="1" side="tl" part="lem"/>
              <lit v="whom"/>
            </let>
            <let>
              <clip pos="1" side="tl" part="tags"/>
              <lit-tag v="rel.an.mf.sp"/>
            </let>
          </when>
        </choose>
        <out> 
          <chunk name="pr_prnpers" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><clip pos="1" side="tl" part="tipus_prn"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu> 
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu> 
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: PRONOMBREind + K (inork - para pronombres no personales) ">
      <pattern>
        <pattern-item n="prn"/>
        <pattern-item n="k"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="gen_prn">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="prn" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="1" side="tl" part="tipus_prn"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><lit-tag v="erg"/></tag>
            </tags>
            <lu> 
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: PRONOMBRE recíproco (elkar) ">
      <pattern>
        <pattern-item n="prnrec"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="elkar" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SADV"/></tag>
              <tag><clip pos="1" side="sl" part="tipus_prn"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    

    <rule comment="REGLA: PRONOMBRE recíproco + POST (elkarri) ">
      <pattern>
        <pattern-item n="prnrec"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal caseless="yes">
                <clip pos="2" side="sl" part="lem"/>
                <lit v="en"/>
              </equal>
            </test>
          <out>
            <chunk name="elkarren" case="caseFirstWord">
              <tags>
                  <tag><lit-tag v="SPGEN"/></tag>
                  <tag><lit-tag v="def"/></tag>
                  <tag><lit-tag v="mf"/></tag>
                  <tag><lit-tag v="sp"/></tag>
                </tags>
                <lu>
                  <lit v="each other"/> <!-- add to bidix -->
                  <lit-tag v="adj"/>
                </lu>
            </chunk>
          </out>
          </when>
          <otherwise>
        <let>
          <var n="lema"/>
          <concat>
            <lit v="elkar_"/>
            <clip pos="2" side="sl" part="lem"/>
          </concat>
        </let>
          
        <out>
          <chunk namefrom="lema" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SPR"/></tag>
              <tag><clip pos="1" side="sl" part="tipus_prn"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
          </otherwise>
        </choose>
      </action>
    </rule>



    <rule comment="REGLA: PRONOMBREind/itg + POST (inorekin - para pronombres no personales) ">
      <pattern>
        <pattern-item n="prn"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="gen_prn">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal caseless="yes">
                  <clip pos="1" side="tl" part="lem"/>
                  <lit v="prpers"/>
                </equal>
                <equal caseless="yes">
                  <clip pos="1" side="tl" part="det_pos"/>
                  <lit-tag v="prn.subj"/>
                </equal>
              </and>
            </test>
            <let>
              <clip pos="1" side="tl" part="det_pos"/>
              <lit-tag v="prn.subj"/>
            </let>
          </when>
          <when>
            <test>
              <and>
                <equal caseless="yes">
                  <clip pos="1" side="tl" part="lem"/>
                  <lit v="who"/>
                </equal>
                <equal caseless="yes">
                  <clip pos="1" side="tl" part="tags"/>
                  <lit-tag v="prn.itg.m.sp"/>
                </equal>
              </and>
            </test>
            <let>
              <clip pos="1" side="tl" part="lem"/>
              <lit v="whom"/>
            </let>
            <let>
              <clip pos="1" side="tl" part="tags"/>
              <lit-tag v="rel.an.mf.sp"/>
            </let>
          </when>
        </choose>
        <out> 
          <chunk name="pr_prn" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><clip pos="1" side="tl" part="tipus_prn"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu> 
              <clip pos="2" side="tl" part="whole"/> 
            </lu>
            <var n="blanco"/>
            <lu> 
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: PRONOMBRE ">
      <pattern>
        <pattern-item n="prnind"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="ezer"/>
              </equal>
            </test>
            <let>
              <var n="lemachunk"/>
              <lit v="ezer"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="inor"/>
              </equal>
            </test>
            <let>
              <var n="lemachunk"/>
              <lit v="inor"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="inortxo"/>
              </equal>
            </test>
            <let>
              <var n="lemachunk"/>
              <lit v="inortxo"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="nehor"/>
              </equal>
            </test>
            <let>
              <var n="lemachunk"/>
              <lit v="nehor"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="ezertxo"/>
              </equal>
            </test>
            <let>
              <var n="lemachunk"/>
              <lit v="ezertxo"/>
            </let>
          </when>
          <otherwise>
            <let>
              <var n="lemachunk"/>
              <lit v="prntn"/>
            </let>
          </otherwise>
        </choose>
        <out>
          <chunk namefrom="lemachunk" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="1" side="tl" part="tipus_prn"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    

    <rule comment="REGLA: DET + NOM  (zenbait etxe - some houses / nahiko jende = enough people)">
      <pattern>
        <pattern-item n="detindizl"/>
        <pattern-item n="nom_np"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="det_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu> 
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="ND" link-to="3"/>
              <clip pos="2" side="tl" part="sp"/>
              <clip pos="2" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: DET + NOM  (zenbait etxetan - in some houses)">
      <pattern>
        <pattern-item n="detindizl"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="pr_det_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu> 
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="ND" link-to="3"/>
              <clip pos="2" side="tl" part="sp"/>
              <clip pos="2" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: ADJ + NOM + DET (euskal presoak - the Basque prisoners !tagger picks sg!)">
      <pattern>
        <pattern-item n="adjizl"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="2"/>
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="det_adj_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="3" side="tl" part="ND" link-to="3"/>
              <clip pos="3" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="ND" link-to="3"/>
              <clip pos="2" side="tl" part="sp"/>
              <clip pos="2" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: ADJ + NOM + NOM + DET (azken lege proiektua - the last law project)">
      <pattern>
        <pattern-item n="adjizl"/>
        <pattern-item n="nom"/>
        <pattern-item n="nom"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="3"/>
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <or>
                  <equal>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant"/> 
                  </equal>
                  <equal>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant.m"/> 
                  </equal>
                  <equal>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant.f"/> 
                  </equal>
                  <equal>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <lit-tag v="np.cog"/> 
                  </equal>
                </or>
                <not> <!-- if it's ant/cog + ant/cog, no genitive -->
                  <or>
                    <equal>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant"/> 
                    </equal>
                    <equal>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant.m"/> 
                    </equal>
                    <equal>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant.f"/> 
                    </equal>
                    <equal>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <lit-tag v="np.cog"/> 
                    </equal>
                  </or>
                </not>
                <and>
                  <equal>
                    <clip pos="4" side="tl" part="lem"/>
                    <lit v="the"/>
                  </equal>
                  <equal>
                    <clip pos="4" side="tl" part="a_det"/>
                    <lit-tag v="det"/>
                  </equal>
                </and>
              </and>
            </test>
            <out> 
              <chunk name="nom_gen_adj_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
                <lu> 
                  <lit v="'s"/>
                  <lit-tag v="gen"/> 
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="tags"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out> <!-- no f_bcond, because the remaining space is artificial -->
          </when>
          <otherwise>
            <out> 
              <chunk name="det_adj_nom_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="4" side="tl" part="lem"/> 
                  <clip pos="4" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="4" side="tl" part="ND" link-to="3"/>
                  <clip pos="4" side="tl" part="sp"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="tags"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: ADJ + NOM + NOM + POST (azken osasun zentrotatik - of last health centre)">
      <pattern>
        <pattern-item n="adjizl"/>
        <pattern-item n="nom"/>
        <pattern-item n="nom"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <or>
                  <equal>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant"/> 
                  </equal>
                  <equal>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant.m"/> 
                  </equal>
                  <equal>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant.f"/> 
                  </equal>
                  <equal>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <lit-tag v="np.cog"/> 
                  </equal>
                </or>
                <not> <!-- if it's ant/cog + ant/cog, no genitive -->
                  <or>
                    <equal>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant"/> 
                    </equal>
                    <equal>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant.m"/> 
                    </equal>
                    <equal>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant.f"/> 
                    </equal>
                    <equal>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <lit-tag v="np.cog"/> 
                    </equal>
                  </or>
                </not>
              </and>
            </test>
            <out> 
              <chunk name="pr_nom_gen_adj_nom" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="4" side="tl" part="lem"/> 
                  <clip pos="4" side="tl" part="a_prep"/> 
                </lu>
                <var n="blanco"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
                <lu> 
                  <lit v="'s"/>
                  <lit-tag v="gen"/> 
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="tags"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out> <!-- no f_bcond, because the remaining space is artificial -->
          </when>
          <otherwise>
            <out> 
              <chunk name="pr_adj_nom_nom" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="4" side="tl" part="lem"/> 
                  <clip pos="4" side="tl" part="a_prep"/> 
                </lu>
                <var n="blanco"/>
                <lu> 
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="tags"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>


    <rule comment="REGLA: ADJ + NOM + NOM + DET + POST (azken lege proiektuaren - del último proyecto de ley)">
      <pattern>
        <pattern-item n="adjizl"/>
        <pattern-item n="nom"/>
        <pattern-item n="nom"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="3"/>
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="pr_d_a_n_pr_n" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="gen_chunk"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="5" side="tl" part="lem"/> 
              <clip pos="5" side="tl" part="a_prep"/>
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="ND" link-to="3"/>
              <clip pos="3" side="tl" part="sp"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
            <b pos="2"/>
            <lu>
              <lit v="of"/>
              <lit-tag v="pr"/>
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: ADJ + NOM + DET + POST (lehen orrialdean)">
      <pattern>
        <pattern-item n="adjizl"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="2"/>
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="num_ord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="pr_det_adj_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="lem"/>
              <clip pos="4" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="3" side="tl" part="ND" link-to="3"/>
              <clip pos="3" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="ND" link-to="3"/>
              <clip pos="2" side="tl" part="sp"/>
              <clip pos="2" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: ADJ + NOM + POST (azken urtetako)">
      <pattern>
        <pattern-item n="adjizl"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="pr_adj_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><lit-tag v="UNDET"/></tag>
              <tag><var n="nbr_chunk"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu> 
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="ND" link-to="3"/>
              <clip pos="2" side="tl" part="sp"/>
              <clip pos="2" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: ADJ + NOM + ADJ + DET (beste etxe ederra)">
      <pattern>
        <pattern-item n="adjizl"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n4">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <out> 
          <chunk name="det_adj_adj_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="tags"/>
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="ND" link-to="3"/>
              <clip pos="2" side="tl" part="sp"/>
              <clip pos="2" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: ADJ + NOM + ADJ + DET + POST (beste etxe ederran)">
      <pattern>
        <pattern-item n="adjizl"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n4">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="5"/>
        </call-macro>
        <out> 
          <chunk name="pr_det_adj_adj_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="5" side="tl" part="lem"/>
              <clip pos="5" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="tags"/>
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="ND" link-to="3"/>
              <clip pos="2" side="tl" part="sp"/>
              <clip pos="2" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <!-- SN precedidos de complementos de nombre -->

    <rule comment="REGLA: N(incluye adv) + ko/ren + NOM + DET (gaurko egunkaria - today's newspaper)">
      <pattern>
        <pattern-item n="nom_adv"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <out> 
          <chunk name="nom_gen_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
            <lu>
              <lit v="'s"/>
              <lit-tag v="gen"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="ND" link-to="3"/>
              <clip pos="3" side="tl" part="sp"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: N(incluye adv) + ko/ren + NOM + DET + POST (gaurko entzierroan)">
      <pattern>
        <pattern-item n="nom_adv"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="5"/>
        </call-macro>
        <out> 
          <chunk name="pr_nom_gen_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu> 
              <clip pos="5" side="tl" part="lem"/>
              <clip pos="5" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="ND" link-to="3"/>
              <clip pos="1" side="tl" part="sp"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
            <lu>
              <lit v="'s"/>
              <lit-tag v="gen"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: N + ART + ko/ren + NOM + DET (emakumearen egunkaria)"> 
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="concord_n2"><!--en último lugar la concord de las palabras que determinan gen_chunk y nbr_chunk -->
          <with-param pos="4"/>
          <with-param pos="5"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <call-macro n="tipo_det">
          <with-param pos="5"/>
        </call-macro>
        <out> 
          <chunk name="d_n_pr_d_n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="5" side="tl" part="lem"/> 
              <clip pos="5" side="tl" part="a_det"/> 
              <lit-tag v="2"/>
              <clip pos="5" side="tl" part="ND" link-to="3"/>
              <clip pos="5" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
              <clip pos="4" side="tl" part="lemq"/> 
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="3" side="tl" part="whole"/> 
            </lu>
            <b pos="4"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_det"/> 
              <clip pos="2" side="tl" part="tipus_det"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: N + ART + ko/ren + NOM + DET (larunbateko etapan)"> 
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro><!--en último lugar la concord de las palabras que determinan gen_chunk y nbr_chunk -->
        <call-macro n="concord_n2">
          <with-param pos="4"/>
          <with-param pos="5"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <call-macro n="tipo_det">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="6"/>
        </call-macro>
        <out> 
          <chunk name="pr_d_n_pr_d_n" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="6" side="tl" part="lem"/> 
              <clip pos="6" side="tl" part="a_prep"/>
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="5" side="tl" part="lem"/> 
              <clip pos="5" side="tl" part="a_det"/> 
              <lit-tag v="2"/>
              <clip pos="5" side="tl" part="ND" link-to="3"/>
              <clip pos="5" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
              <clip pos="4" side="tl" part="lemq"/> 
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="3" side="tl" part="whole"/> 
            </lu>
            <b pos="4"/>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: N(incluye adv) + ko/ren + NOM + DET (hurrengo Nafarroako Gobernua)">
      <pattern>
        <pattern-item n="adjizl"/>
        <pattern-item n="nom_adv"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="4"/>
          <with-param pos="5"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="5"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <or>
                  <equal>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant"/> 
                  </equal>
                  <equal>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant.m"/> 
                  </equal>
                  <equal>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <lit-tag v="np.ant.f"/> 
                  </equal>
                  <equal>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <lit-tag v="np.cog"/> 
                  </equal>
                  <equal>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <lit-tag v="np.loc"/> 
                  </equal>
                </or>
                <not>
                  <or>
                    <equal>
                      <clip pos="4" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant"/> 
                    </equal>
                    <equal>
                      <clip pos="4" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant.m"/> 
                    </equal>
                    <equal>
                      <clip pos="4" side="tl" part="a_nom"/>
                      <lit-tag v="np.ant.f"/> 
                    </equal>
                    <equal>
                      <clip pos="4" side="tl" part="a_nom"/>
                      <lit-tag v="np.cog"/> 
                    </equal>
                  </or>
                </not>
                <and>
                  <equal>
                    <clip pos="5" side="tl" part="lem"/>
                    <lit v="the"/>
                  </equal>
                  <equal>
                    <clip pos="5" side="tl" part="a_det"/>
                    <lit-tag v="det"/>
                  </equal>
                </and>
              </and>
            </test>
            <out> 
              <chunk name="nom_gen_adj_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="gen_chunk"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
                <lu>
                  <lit v="'s"/>
                  <lit-tag v="gen"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="tags"/>
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="4" side="tl" part="lemh"/> 
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="ND" link-to="3"/>
                  <clip pos="4" side="tl" part="sp"/>
                  <clip pos="4" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out> 
              <chunk name="det_adj_nom_pr_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="gen_chunk"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="5" side="tl" part="lem"/> 
                  <clip pos="5" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="5" side="tl" part="ND" link-to="3"/>
                  <clip pos="5" side="tl" part="sp"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="tags"/>
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="4" side="tl" part="lemh"/> 
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="ND" link-to="3"/>
                  <clip pos="4" side="tl" part="sp"/>
                  <clip pos="4" side="tl" part="lemq"/> 
                </lu>
                <b pos="4"/>
                <lu> 
                  <clip pos="3" side="tl" part="whole"/> 
                </lu>
                <b/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>


    <rule comment="REGLA: N + ART + ko/ren + NOM + DET (bulegoko zuzendari ohia - the office's ex manager)"> 
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="4"/>
          <with-param pos="5"/>
          <with-param pos="6"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="5"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <call-macro n="tipo_det">
          <with-param pos="6"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="6" side="tl" part="lem"/>
                  <lit v="the"/>
                </equal>
                <equal>
                  <clip pos="6" side="tl" part="a_det"/>
                  <lit-tag v="det"/>
                </equal>
              </and>
            </test>
            <out> 
              <chunk name="det_nom_gen_adj_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="gen_chunk"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="2" side="tl" part="lem"/> 
                  <clip pos="2" side="tl" part="a_det"/> 
                  <clip pos="2" side="tl" part="tipus_det"/> 
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
                <lu>
                  <lit v="'s"/>
                  <lit-tag v="gen"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="5" side="tl" part="lem"/> 
                  <clip pos="5" side="tl" part="tags"/>
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="4" side="tl" part="lemh"/> 
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="ND" link-to="3"/>
                  <clip pos="4" side="tl" part="sp"/>
                  <clip pos="4" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out> 
              <chunk name="det_adj_nom_pr_det_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="6" side="tl" part="lem"/> 
                  <clip pos="6" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="6" side="tl" part="ND" link-to="3"/>
                  <clip pos="6" side="tl" part="sp"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="5" side="tl" part="lem"/> 
                  <clip pos="5" side="tl" part="a_adj"/>
                  <clip pos="5" side="tl" part="tipus_adj"/>
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="4" side="tl" part="lemh"/> 
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="ND" link-to="3"/>
                  <clip pos="4" side="tl" part="sp"/>
                  <clip pos="4" side="tl" part="lemq"/> 
                </lu>
                <b pos="4"/>
                <lu> 
                  <clip pos="3" side="tl" part="whole"/> 
                </lu>
                <b pos="5"/>
                <lu>
                  <clip pos="2" side="tl" part="lem"/> 
                  <clip pos="2" side="tl" part="a_det"/> 
                  <clip pos="2" side="tl" part="tipus_det"/> 
                  <clip pos="1" side="tl" part="ND" link-to="3"/>
                  <clip pos="1" side="tl" part="sp"/>
                </lu>
                <b/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: N + ART + ko/ren + NOM + DET (bulegoko zuzendari ohien - of the office's ex manager)"> 
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="4"/>
          <with-param pos="5"/>
          <with-param pos="6"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="5"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <call-macro n="tipo_det">
          <with-param pos="6"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="7"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="6" side="tl" part="lem"/>
                  <lit v="the"/>
                </equal>
                <equal>
                  <clip pos="6" side="tl" part="a_det"/>
                  <lit-tag v="det"/>
                </equal>
              </and>
            </test>
            <out> 
              <chunk name="pr_det_nom_gen_adj_nom" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="gen_chunk"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu> 
                  <clip pos="7" side="tl" part="lem"/> 
                  <clip pos="7" side="tl" part="a_prep"/> 
                </lu>
                <var n="blanco"/>
                <lu>
                  <clip pos="2" side="tl" part="lem"/> 
                  <clip pos="2" side="tl" part="a_det"/> 
                  <clip pos="2" side="tl" part="tipus_det"/> 
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
                <lu>
                  <lit v="'s"/>
                  <lit-tag v="gen"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="5" side="tl" part="lem"/> 
                  <clip pos="5" side="tl" part="tags"/>
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="4" side="tl" part="lemh"/> 
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="ND" link-to="3"/>
                  <clip pos="4" side="tl" part="sp"/>
                  <clip pos="4" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out> 
              <chunk name="pr_det_adj_nom_pr_det_nom" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu> 
                  <clip pos="7" side="tl" part="lem"/> 
                  <clip pos="7" side="tl" part="a_prep"/> 
                </lu>
                <var n="blanco"/>
                <lu>
                  <clip pos="6" side="tl" part="lem"/> 
                  <clip pos="6" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="6" side="tl" part="ND" link-to="3"/>
                  <clip pos="6" side="tl" part="sp"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="5" side="tl" part="lem"/> 
                  <clip pos="5" side="tl" part="a_adj"/>
                  <clip pos="5" side="tl" part="tipus_adj"/>
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="4" side="tl" part="lemh"/> 
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="ND" link-to="3"/>
                  <clip pos="4" side="tl" part="sp"/>
                  <clip pos="4" side="tl" part="lemq"/> 
                </lu>
                <b pos="4"/>
                <lu> 
                  <clip pos="3" side="tl" part="whole"/> 
                </lu>
                <b pos="5"/>
                <lu>
                  <clip pos="2" side="tl" part="lem"/> 
                  <clip pos="2" side="tl" part="a_det"/> 
                  <clip pos="2" side="tl" part="tipus_det"/> 
                  <clip pos="1" side="tl" part="ND" link-to="3"/>
                  <clip pos="1" side="tl" part="sp"/>
                </lu>
                <b/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: N(incluye adv) + ko/ren + N + cnjcoo + N + ko/ren + NOM + DET (Generalitateko presidenteorde eta ERCko burua)">
      <pattern>
        <pattern-item n="nom_adv"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_adv"/>
        <pattern-item n="conj"/>
        <pattern-item n="nom_adv"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="3"/>
          <with-param pos="8"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose> 
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="5" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="5" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose> 
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="7" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="7" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose> 

        <call-macro n="tipo_det">
          <with-param pos="8"/>
        </call-macro>
        <out> 
          <chunk name="d_n_pr_d_cnj_n_pr_n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="8" side="tl" part="lem"/> 
              <clip pos="8" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="8" side="tl" part="ND" link-to="3"/>
              <clip pos="8" side="tl" part="sp"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="ND" link-to="3"/>
              <clip pos="3" side="tl" part="sp"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="2" side="tl" part="whole"/> 
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
            <b pos="4"/>
            <lu> 
              <clip pos="4" side="tl" part="whole"/> 
            </lu>
            <b/>
            <lu> 
              <clip pos="7" side="tl" part="lemh"/> 
              <clip pos="7" side="tl" part="a_nom"/>
              <clip pos="7" side="tl" part="nbr"/>
              <clip pos="7" side="tl" part="lemq"/> 
            </lu>
            <b/>
            <lu> 
              <clip pos="6" side="tl" part="whole"/> 
            </lu>
            <b pos="6"/>
            <lu> 
              <clip pos="5" side="tl" part="lemh"/> 
              <clip pos="5" side="tl" part="a_nom"/>
              <clip pos="5" side="tl" part="nbr"/>
              <clip pos="5" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: N(incluye adv) + ko/ren + N + DET + ko/ren + NOM + DET (Espainiako Errepublikako Gobernua - the Government of the Republic of Spain)">
      <pattern>
        <pattern-item n="nom_adv"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_adv"/>
        <pattern-item n="det"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <call-macro n="concord_n2">
          <with-param pos="6"/>
          <with-param pos="7"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="7"/>
        </call-macro>
        <out> 
          <chunk name="d_n_pr_d_n_pr_n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="7" side="tl" part="lem"/> 
              <clip pos="7" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="7" side="tl" part="ND" link-to="3"/>
              <clip pos="7" side="tl" part="sp"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="6" side="tl" part="lemh"/> 
              <clip pos="6" side="tl" part="a_nom"/>
              <clip pos="6" side="tl" part="ND" link-to="3"/>
              <clip pos="6" side="tl" part="sp"/>
              <clip pos="6" side="tl" part="lemq"/> 
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="5" side="tl" part="whole"/> 
            </lu>
            <b pos="5"/>
            <lu>
              <clip pos="4" side="tl" part="whole"/> 
            </lu>
            <b pos="6"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
            <b/>
            <lu> 
              <clip pos="2" side="tl" part="whole"/> 
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <!--     <clip pos="1" side="tl" part="a_adv"/>-->
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: N(incluye adv) + ko/ren + N + DET + ko/ren + NOM + DET + POST(Irakeko Gobernuaren aurreikuspenen)">
      <pattern>
        <pattern-item n="nom_adv"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_adv"/>
        <pattern-item n="det"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <call-macro n="concord_n2">
          <with-param pos="6"/>
          <with-param pos="7"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="7"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="8"/>
        </call-macro>
        <out> 
          <chunk name="pr_d_n_pr_d_n_pr_n" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="8" side="tl" part="lem"/> 
              <clip pos="8" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="7" side="tl" part="lem"/> 
              <clip pos="7" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="7" side="tl" part="ND" link-to="3"/>
              <clip pos="7" side="tl" part="sp"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="6" side="tl" part="lemh"/> 
              <clip pos="6" side="tl" part="a_nom"/>
              <clip pos="6" side="tl" part="ND" link-to="3"/>
              <clip pos="6" side="tl" part="sp"/>
              <clip pos="6" side="tl" part="lemq"/> 
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="5" side="tl" part="whole"/> 
            </lu>
            <b pos="5"/>
            <lu>
              <clip pos="4" side="tl" part="whole"/> 
            </lu>
            <b pos="6"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
            <b/>
            <lu> 
              <clip pos="2" side="tl" part="whole"/> 
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <!--     <clip pos="1" side="tl" part="a_adv"/>-->
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: N(incluye adv) + ko/ren + N + DET + ko/ren + NOM + DET (Espainiako Errepublikako Gobernua)">
      <pattern>
        <pattern-item n="nom_adv"/>
        <pattern-item n="det"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_adv"/>
        <pattern-item n="det"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <call-macro n="concord_n2">
          <with-param pos="4"/>
          <with-param pos="5"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="5" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="5" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <call-macro n="concord_n2">
          <with-param pos="7"/>
          <with-param pos="8"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="8"/>
        </call-macro>
        <out> 
          <chunk name="d_n_pr_d_n_pr_d_n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="8" side="tl" part="lem"/> 
              <clip pos="8" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="8" side="tl" part="ND" link-to="3"/>
              <clip pos="8" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="7" side="tl" part="lemh"/> 
              <clip pos="7" side="tl" part="a_nom"/>
              <clip pos="7" side="tl" part="ND" link-to="3"/>
              <clip pos="7" side="tl" part="sp"/>
              <clip pos="7" side="tl" part="lemq"/> 
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="6" side="tl" part="whole"/> 
            </lu>
            <b pos="4"/>
            <lu>
              <clip pos="5" side="tl" part="whole"/> 
            </lu>
            <b pos="7"/>
            <lu> 
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="nbr"/>
              <clip pos="4" side="tl" part="lemq"/> 
            </lu>
            <b/>
            <lu> 
              <clip pos="3" side="tl" part="whole"/> 
            </lu>
            <b/>
            <lu> 
              <clip pos="2" side="tl" part="whole"/> 
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <!--     <clip pos="1" side="tl" part="a_adv"/>-->
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: N(incluye adv) + ko/ren + N + DET + ko/ren + NOM + DET + POST (Espainiako Errepublikako Gobernua)">
      <pattern>
        <pattern-item n="nom_adv"/>
        <pattern-item n="det"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_adv"/>
        <pattern-item n="det"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <call-macro n="concord_n2">
          <with-param pos="4"/>
          <with-param pos="5"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="5" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="5" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <call-macro n="concord_n2">
          <with-param pos="7"/>
          <with-param pos="8"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="8"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="9"/>
        </call-macro>
        <out> 
          <chunk name="pr_d_n_pr_d_n_pr_d_n" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="9" side="tl" part="lem"/> 
              <clip pos="9" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="8" side="tl" part="lem"/> 
              <clip pos="8" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="8" side="tl" part="ND" link-to="3"/>
              <clip pos="8" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="7" side="tl" part="lemh"/> 
              <clip pos="7" side="tl" part="a_nom"/>
              <clip pos="7" side="tl" part="ND" link-to="3"/>
              <clip pos="7" side="tl" part="sp"/>
              <clip pos="7" side="tl" part="lemq"/> 
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="6" side="tl" part="whole"/> 
            </lu>
            <b pos="4"/>
            <lu>
              <clip pos="5" side="tl" part="whole"/> 
            </lu>
            <b pos="6"/>
            <lu> 
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="nbr"/>
              <clip pos="4" side="tl" part="lemq"/> 
            </lu>
            <b pos="7"/>
            <lu> 
              <clip pos="3" side="tl" part="whole"/> 
            </lu>
            <b/>
            <lu> 
              <clip pos="2" side="tl" part="whole"/> 
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NUM + NOM (bi emakume - two women; mila emakume - a thousand women)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom_np"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <in caseless="yes">
                <clip pos="1" side="tl" part="lem"/>
                <list n="million"/>
              </in>
            </test>
            <out> 
              <chunk name="a_num_n" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN.num"/></tag>
                  <tag><clip pos="2" side="tl" part="nbr"/></tag>
                </tags>
                <lu>
                  <lit v="a"/>
                  <lit-tag v="det.ind.sg"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="a_num"/> 
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <b/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="num_n" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN.num"/></tag>
                 <tag><clip pos="2" side="tl" part="nbr"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="a_num"/> 
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>




    <rule comment="REGLA: NUM + NUM + NOM (ehun mila emakume - hundred thousand women)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="num"/>
        <pattern-item n="nom_np"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="3"/>
        </call-macro>
        <out> 
          <chunk name="num_num_n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN.num"/></tag>
              <tag><clip pos="3" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_num"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


 <rule comment="REGLA: NUM + NUM + NOM (400 milioi euro - 400 million euros)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="milioi"/>
        <pattern-item n="nom_np"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <in caseless="yes">
                <clip pos="2" side="tl" part="lem"/>
                <list n="million"/>
              </in>
            </test>
            <let>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <out> 
          <chunk name="num_nom_n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN.num"/></tag>
              <tag><clip pos="3" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="mf"/>
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_nom"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: NUM + NOM + DET (bi emakumeak - the two women">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="3"/>
        </call-macro> 
        <call-macro n="concord_n2">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <not>
                <equal>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </test>
            <let>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test><!--zazpi lagun gutxiago - less than seven people-->
              <or>
                <equal caseless="yes">
                  <clip pos="3" side="sl" part="lem"/>
                  <lit v="gutxiago"/>
                </equal>
                <equal caseless="yes">
                  <clip pos="3" side="sl" part="lem"/>
                  <lit v="gehiago"/>
                </equal>
              </or>
            </test>
            <out> 
              <chunk name="det_cnj_num_n" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><clip pos="2" side="tl" part="nbr"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="3" side="tl" part="lem"/> 
                  <clip pos="3" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
                <b/>
                <lu>
                  <lit v="than"/>
                  <lit-tag v="cnjcoo"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="a_num"/> 
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out> 
              <chunk name="d_num_n" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><clip pos="2" side="tl" part="nbr"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="3" side="tl" part="lem"/> 
                  <clip pos="3" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="a_num"/> 
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>


    <rule comment="REGLA: NUM + NUM + NOM + DET (ehun mila emakumeak - las cien mil mujeres">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="num"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <not>
                <equal>
                  <clip pos="4" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </test>
            <let>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </let>
          </when>
        </choose>
        <out> 
          <chunk name="d_num_num_n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><clip pos="3" side="tl" part="nbr"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_num"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: NUM + NOM + ADJ (300 liburu berri - 300 libros nuevos (pl))">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="adjnopp"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="3"/>
        </call-macro>
        
        <out> 
          <chunk name="num_adj_n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN.num"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



 <rule comment="REGLA: NUM + NOM (31 eta 50 urte [bitarteko] - [entre] 31 y 50 años))">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="conj"/>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="4"/>
        </call-macro>
        <out> 
          <chunk name="num_cj_num__n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN.num"/></tag>
              <tag><clip pos="4" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="whole"/> 
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="a_num"/> 
              <clip pos="3" side="tl" part="nbr"/>
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="nbr"/>
              <clip pos="4" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>




    <rule comment="REGLA: NOM + BI (kide bi - dos miembros (porque el 'bi' a veces va detrás))">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="bi"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="1"/>
        </call-macro>
        
        <out> 
          <chunk name="num_n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN.num"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_num"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NOM + BI + DET (kide biak - los dos miembros)">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="bi"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <chunk name="d_num_n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lem"/>
              <clip pos="3" side="tl" part="a_det"/>
              <lit-tag v="2"/>
              <clip pos="3" side="tl" part="ND" link-to="3"/>
              <clip pos="3" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="a_num"/>
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    



    <rule comment="REGLA: NOM + BAT + DET (etxe bata)">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="bat"/>
        <pattern-item n="detart"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="3"/>
        </call-macro> 
        <let>
          <clip pos="1" side="tl" part="nbr"/>
          <clip pos="2" side="sl" part="nbr"/>
        </let>
        <out> 
          <chunk name="num_n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><lit-tag v="def"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_num"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: BAT + DET (bata - el uno, los unos)">
      <pattern>
        <pattern-item n="bat"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="2"/>
        </call-macro>
        <out> 
          <chunk name="d_num" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b/>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <lit-tag v="prn.tn"/><!--para que traduzca 'uno'(prn tn) y no 'un' (det), que es la opción del diccionario -->
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>




    <rule comment="REGLA: NUM + NOM (bi erasotan - en dos agresiones (pl))">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="3"/>
        </call-macro>
        <out> 
          <chunk name="pr_num_n" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><lit-tag v="num"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NUM + NOM + NOM + POST (bi osasun zentrotatik - por dos centros de salud (pl))">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
        <pattern-item n="nom"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="2"/>
        </call-macro>
        <out> 
          <chunk name="pr_num_n_n" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><lit-tag v="num"/></tag>
              <tag><clip pos="3" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="lemq"/> 
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NUM + NUM + NOM (ehun mila lagunen - de cien mil personas (pl))">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="num"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="4"/>
        </call-macro>
        <out> 
          <chunk name="pr_num_num_n" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><lit-tag v="num"/></tag>
              <tag><clip pos="3" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_num"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule> 



    <rule comment="REGLA: NUM + ADJ + NOM + DET (hiru euskal herritarrak)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adj"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <not>
                <equal>
                  <clip pos="4" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </test>
            <let>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </let>
          </when>
        </choose>
        <call-macro n="concord_n3">
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="d_num_adj_n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_adj"/>
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NUM + ADJ + NOM + DET (ehun mila euskal herritarrak)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="num"/>
        <pattern-item n="adj"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="4"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <not>
                <equal>
                  <clip pos="5" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </test>
            <let>
              <clip pos="5" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </let>
          </when>
        </choose>
        <call-macro n="concord_n3">
          <with-param pos="4"/>
          <with-param pos="5"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <chunk name="d_num_num_adj_n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="5" side="tl" part="lem"/> 
              <clip pos="5" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="5" side="tl" part="ND" link-to="3"/>
              <clip pos="5" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_num"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="a_adj"/>
            </lu>
            <b pos="4"/>
            <lu> 
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="nbr"/>
              <clip pos="4" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>






    <rule comment="REGLA: NUM + NOM + DET + POST (bi emakumeak - las dos mujeres (pl) (cuando tagger se equivoca y elige ergativo en vez de determinante plural)
                   bost urtean - en () cinco años">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <not>
                <equal>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </test>
            <let>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test><!--zazpi lagun gutxiagok - siete personas menos-->
              <or>
                <equal caseless="yes">
                  <clip pos="3" side="sl" part="lem"/>
                  <lit v="gutxiago"/>
                </equal>
                <equal caseless="yes">
                  <clip pos="3" side="sl" part="lem"/>
                  <lit v="gehiago"/>
                </equal>
              </or>
            </test>
            <out> 
              <chunk name="pr_num_n_d" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><clip pos="2" side="tl" part="nbr"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="4" side="tl" part="lem"/> 
                  <clip pos="4" side="tl" part="a_prep"/> 
                </lu>
                <var n="blanco"/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="a_num"/> 
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <b pos="1"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lem"/> 
                  <clip pos="3" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            
            <out> 
              <chunk name="pr_d_num_n" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="gen_chunk"/></tag>
                  <tag><clip pos="2" side="tl" part="nbr"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="4" side="tl" part="lem"/> 
                  <clip pos="4" side="tl" part="a_prep"/> 
                </lu>
                <var n="blanco"/>
                <lu>
                  <clip pos="3" side="tl" part="lem"/> 
                  <clip pos="3" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="a_num"/> 
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="2" side="tl" part="lemh"/> 
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>



    <rule comment="REGLA: NUM + NUM + NOM + DET + POST (ehun mila lagunen - de (las) cien mil personas ">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="num"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <not>
                <equal>
                  <clip pos="4" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </test>
            <let>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </let>
          </when>
        </choose>

        <out> 
          <chunk name="pr_d_num_num_n" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="gen_chunk"/></tag>
              <tag><clip pos="3" side="tl" part="nbr"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="5" side="tl" part="lem"/> 
              <clip pos="5" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="4" side="tl" part="nbr"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_num"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: ADJ + NUM + NOM + DET + POST (azken lau urteetan - in the last four years)">
      <pattern>
        <pattern-item n="adjizl"/>
        <pattern-item n="num"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <not>
                <equal>
                  <clip pos="4" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </test>
            <let>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </let>
          </when>
        </choose>
        <call-macro n="concord_n3">
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="pr_det_adj_num_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="5" side="tl" part="lem"/> 
              <clip pos="5" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_num"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


  <rule comment="REGLA: ADJ + NUM + NOM + DET + POST (bi eraso suizidetan - in the two suicidal assaults)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="adj"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <not>
                <equal>
                  <clip pos="4" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </test>
            <let>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </let>
          </when>
        </choose>
        <call-macro n="concord_n3">
          <with-param pos="2"/>
          <with-param pos="4"/>
          <with-param pos="3"/>
        </call-macro>
        
        <out> 
          <chunk name="pr_det_adj_num_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="gen_chunk"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="5" side="tl" part="lem"/> 
              <clip pos="5" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="tags"/>
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: ADJ + NUM + NOM + DET + POST (azken 100 mila urteetan - in the last 100 thousand years)">
      <pattern>
        <pattern-item n="adjizl"/>
        <pattern-item n="num"/>
        <pattern-item n="num"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="6"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <not>
                <equal>
                  <clip pos="5" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </test>
            <let>
              <clip pos="5" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </let>
          </when>
        </choose>
        <call-macro n="concord_n3">
          <with-param pos="4"/>
          <with-param pos="5"/>
          <with-param pos="1"/>
        </call-macro>
        
        <out> 
          <chunk name="pr_det_adj_num_num_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="gen_chunk"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="6" side="tl" part="lem"/>
              <clip pos="6" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="5" side="tl" part="lem"/> 
              <clip pos="5" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="5" side="tl" part="ND" link-to="3"/>
              <clip pos="5" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_num"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b pos="3"/>
            <lu>
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="a_num"/> 
              <clip pos="3" side="tl" part="nbr"/>
            </lu>
            <b pos="4"/>
            <lu> 
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="nbr"/>
              <clip pos="4" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


   <rule comment="REGLA: ADJ + NUM + NOM + POST (beste bost atxiloturen - of the other five arrested persons)">
      <pattern>
        <pattern-item n="adjizl"/>
        <pattern-item n="num"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="beste"/>
              </equal>
            </test>
            <let>
              <var n="palabra"/>
              <concat>
                <lit v="^the"/>
                <lit-tag v="det.def.sg"/>
                <lit v="$ "/>
              </concat>
            </let>
            <let>
              <var n="lema"/>
              <lit v="pr_d_adj_num_n"/>
            </let>
          </when>
          <otherwise>
            <let>
              <var n="palabra"/>
              <lit v=""/>
            </let>
            <let>
              <var n="lema"/>
              <lit v="pr_adj_num_n"/>
            </let>
          </otherwise>
        </choose>
        <out> 
          <chunk namefrom="lema" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="gen_chunk"/></tag>
              <tag><var n="nbr_chunk"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <var n="palabra"/>
            <lu> 
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_num"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: NUM + ADJ+ NOM + DET + POST (hiru euskal herritarrak - the three Basque citizens)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adj"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="5"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <not>
                <equal>
                  <clip pos="4" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </test>
            <let>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </let>
          </when>
        </choose>
        <call-macro n="concord_n3">
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="2"/>
        </call-macro>
        
        <out>
          <chunk name="pr_det_num_adj_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="5" side="tl" part="lem"/>
              <clip pos="5" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="tags"/>
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>




    <rule comment="REGLA: NUM + NUM + ADJ+ NOM + DET + POST (100 mila euskal herritarrak - the 100 thousand Basque citizens)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="num"/>
        <pattern-item n="adj"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="nomnp_pl">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="6"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <not>
                <equal>
                  <clip pos="5" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </test>
            <let>
              <clip pos="5" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </let>
          </when>
        </choose>
        <call-macro n="concord_n3">
          <with-param pos="4"/>
          <with-param pos="5"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <chunk name="pr_det_num_num_adj_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="6" side="tl" part="lem"/> 
              <clip pos="6" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="5" side="tl" part="lem"/> 
              <clip pos="5" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="5" side="tl" part="ND" link-to="3"/>
              <clip pos="5" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_num"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="tags"/>
            </lu>
            <b pos="4"/>
            <lu> 
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="nbr"/>
              <clip pos="4" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>




    <rule comment="REGLA: NUM + DET (zortziak - eight. Delete the determiner, as this is usually an indicator of the hour)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="2"/>
        </call-macro>
        <out> 
          <chunk name="d_num" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NUM + DET + POST (19etatik - from 19. Delete the article, as it usually refers to hours)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal caseless="yes">
                <clip pos="3" side="sl" part="lem"/> 
                <lit v="an"/>
              </equal>
            </test>
            <let>
              <clip pos="3" side="tl" part="lem"/> 
              <lit v="at"/>
            </let>
          </when>
        </choose>
        <out> 
          <chunk name="pr_d_num" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="whole"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



  <rule comment="REGLA: NUM + tik + NUM ( hamarretik hiru - three out of ten)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="tik"/>
        <pattern-item n="num"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="3"/>
        </call-macro>
        <out> 
          <chunk name="num_pr_num" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN.num"/></tag>
              <tag><clip pos="3" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="whole"/> 
            </lu>
            <b pos="1"/>
            <lu>
              <lit v="out of"/>
              <lit-tag v="pr"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


 <rule comment="REGLA: NUM + tik + NUM (lautik bostera - from four to five)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="tik"/>
        <pattern-item n="num"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="sl" part="lem"/>
                <lit v="ra"/>
              </equal>
            </test>
            <let>
              <clip pos="4" side="tl" part="lem"/>
              <lit v="to"/>
            </let>
            <let>
              <clip pos="4" side="tl" part="a_prep"/>
              <lit-tag v="pr"/>
            </let>
          </when>
        </choose>
        <out> 
          <chunk name="pr_num_pr_num" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN.num"/></tag>
              <tag><clip pos="3" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <lit v="from"/>
              <lit-tag v="pr"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="4" side="tl" part="whole"/> 
            </lu>
            <b pos="3"/>
            <lu>
              <clip pos="3" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NOM + DET + ko/en NUM + DET (goizeko zortziak - eight in the morning. Se pone en femenino porque casi siempre es indicación horaria)">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="num"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <call-macro n="tipo_det">
          <with-param pos="5"/>
        </call-macro>
        <out> 
          <chunk name="num_pr_d_n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><clip pos="5" side="tl" part="nbr"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="whole"/> 
            </lu>
            <b pos="1"/>
            <lu> 
              <lit v="in"/>
              <lit-tag v="pr"/>
            </lu>
            <b/>
            <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="a_det"/>
              <lit-tag v="2"/>
              <clip pos="2" side="tl" part="ND" link-to="3"/>
              <clip pos="2" side="tl" part="sp"/>
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NOM + DET + ko/en NUM + DET + POST (goizeko bederatzietan - a las nueve de la mañana. Se pone en femenino porque casi siempre es indicación horaria)">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="num"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="6" side="tl" part="lem"/>
                <lit v="in"/>
              </equal>
            </test>
            <let>
              <clip pos="6" side="tl" part="lem"/>
              <lit v="at"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="tl" part="lem"/>
                <lit v="of"/>
              </equal>
            </test>
            <let>
              <clip pos="3" side="tl" part="lem"/>
              <lit v="in"/>
            </let>
          </when>
        </choose>
        <call-macro n="tipo_det">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="6"/>
        </call-macro>
        <out> 
          <chunk name="pr_num_pr_det_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><clip pos="5" side="tl" part="nbr"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="6" side="tl" part="lem"/> 
              <clip pos="6" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="4" side="tl" part="whole"/> 
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="3" side="tl" part="whole"/> 
            </lu>
            <b/>
            <lu>
              <clip pos="2" side="tl" part="whole"/> 
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
            
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NUM + ADJ (sei palestinar - six Palestinian - no plural adjectives in English, need to do something about nominalising these)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adjnopp"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test> 
              <equal>
                <clip pos="1" side="tl" part="lem"/>
                <lit v="1"/>
              </equal>
            </test>
            <let>
              <var n="nbr_chunk"/>
              <lit-tag v="sg"/>
            </let>
          </when>
          <otherwise>
            <let>
              <var n="nbr_chunk"/>
              <lit-tag v="pl"/>
            </let>
          </otherwise>
        </choose>
        <out> 
          <chunk name="num_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><lit-tag v="num"/></tag>
              <tag><var n="nbr_chunk"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="tags"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NUM + NUM + ADJ (ehun mila palestinar)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="num"/>
        <pattern-item n="adjnopp"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="3"/>
        </call-macro>
        <let>
          <var n="nbr_chunk"/>
          <lit-tag v="pl"/>
        </let>
        <out> 
          <chunk name="num_num_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><lit-tag v="num"/></tag>
              <tag><var n="nbr_chunk"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_num"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="tags"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NUM + ADJ (bi handiak - the two big FIXME: ones?)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adjnopp"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="concord_adj_det">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <not>
                <equal>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </test>
            <choose>
              <when>
                <test>
                  <not>
                    <equal>
                      <clip pos="1" side="tl" part="lem"/>
                      <lit v="1"/>
                    </equal>
                  </not>
                </test>
                <let>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="pl"/>
                </let>
              </when>
              <otherwise>
                <let>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="sg"/>
                </let>
              </otherwise>
            </choose>
          </when>
        </choose>
                  
        <choose>
          <when>
            <test> 
              <equal>
                <clip pos="1" side="tl" part="lem"/>
                <lit v="1"/>
              </equal>
            </test>
            <let>
              <var n="nbr_chunk"/>
              <lit-tag v="sg"/>
            </let>
          </when>
          <otherwise>
            <let>
              <var n="nbr_chunk"/>
              <lit-tag v="pl"/>
            </let>
          </otherwise>
        </choose>
        <out> 
          <chunk name="pr_d_num_adj" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="3" side="tl" part="nbr"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="tags"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NUM + ADJ (100 mila handiak - the 100 thousand big FIXME: ones?)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="num"/>
        <pattern-item n="adjnopp"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="n_num">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="concord_adj_det">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>

        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </let>
          </when>
        </choose>
        <let>
          <var n="nbr_chunk"/>
          <lit-tag v="pl"/>
        </let>
        <out> 
          <chunk name="pr_d_num_adj" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
            </tags>
            <lu>
              <clip pos="5" side="tl" part="lem"/> 
              <clip pos="5" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="4" side="tl" part="nbr"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_num"/> 
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="tags"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <!-- lexical : -z beteta : full of : need more! -->

    <rule comment="REGLA: NOM + DET + z + beteta (aingirez beteta - full of eels)">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="det"/>
        <pattern-item n="z"/>
        <pattern-item n="beteta"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="lem"/>
                <lit v="a"/>
              </equal>
            </test>
            <out> 
              <chunk name="full_of_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><lit-tag v="pos"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                </tags>
                <lu>
                  <lit v="full"/>
                  <lit-tag v="adj.sint"/>
                </lu>
                <b/>
                <lu>
                  <lit v="of"/>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="ND" link-to="3"/>
                  <clip pos="1" side="tl" part="sp"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <call-macro n="tipo_det">
              <with-param pos="3"/>
            </call-macro>
            <out> 
              <chunk name="full_of_det_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><lit-tag v="pos"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                </tags>
                <lu>
                  <lit v="full"/>
                  <lit-tag v="adj.sint"/>
                </lu>
                <b/>
                <lu>
                  <lit v="of"/>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="3" side="tl" part="lem"/>
                  <clip pos="3" side="tl" part="a_det"/>
                  <clip pos="3" side="tl" part="tipus_det"/>
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="ND" link-to="3"/>
                  <clip pos="1" side="tl" part="sp"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    <rule comment="REGLA: NOM + DET + z + bete + a (ardoz betea - full of wine)">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="z"/>
        <pattern-item n="beteta"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="sl" part="lem"/>
                <lit v="a"/>
              </equal>
            </test>
            <out> 
              <chunk name="full_of_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><lit-tag v="pos"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                </tags>
                <lu>
                  <lit v="full"/>
                  <lit-tag v="adj.sint"/>
                </lu>
                <b/>
                <lu>
                  <lit v="of"/>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="ND" link-to="3"/>
                  <clip pos="1" side="tl" part="sp"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <call-macro n="tipo_det">
              <with-param pos="3"/>
            </call-macro>
            <out> 
              <chunk name="full_of_det_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><lit-tag v="pos"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                </tags>
                <lu>
                  <lit v="full"/>
                  <lit-tag v="adj.sint"/>
                </lu>
                <b/>
                <lu>
                  <lit v="of"/>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="4" side="tl" part="lem"/>
                  <clip pos="4" side="tl" part="a_det"/>
                  <clip pos="4" side="tl" part="tipus_det"/>
                  <clip pos="4" side="tl" part="ND" link-to="3"/>
                  <clip pos="4" side="tl" part="sp"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="ND" link-to="3"/>
                  <clip pos="1" side="tl" part="sp"/>
                  <clip pos="1" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <!-- POSESIVOS -->


    <rule comment="REGLA: PRON + en + NOM + DET (nirea - mine)">
      <pattern>
        <pattern-item n="prnpers"/>
        <pattern-item n="en"/>
        <pattern-item n="detart"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="posesivo_det">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <out> 
          <chunk name="pos" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA"/></tag>
              <tag><lit-tag v="pos"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="det_pos"/>
              <clip pos="1" side="tl" part="nbr" link-to="3"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: PRON + en + NOM + DET (nire etxea - my house)">
      <pattern>
        <pattern-item n="prnpers"/>
        <pattern-item n="en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="posesivo"><!--MG adequar funció a concord_n2 -->
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <out> 
          <chunk name="pos_n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><lit-tag v="pos"/></tag>
              <tag><var n="nbr_chunk"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <!--<clip pos="1" side="tl" part="det_pos"/>-->
              <lit-tag v="det.pos"/>
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="ND" link-to="3"/>
              <clip pos="3" side="tl" part="sp"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: PRON + en + NOM + DET (nire etxean - in my house)">
      <pattern>
        <pattern-item n="prnpers"/>
        <pattern-item n="en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="posesivo"><!--MG adequar funció a concord_n2 -->
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="5"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="5" side="sl" part="lem"/>
                  <lit v="en"/>
                </equal>
                <or>
                  <equal>
                    <clip pos="3" side="tl" part="lem"/>
                    <lit v="right"/>
                  </equal>
                  <equal>
                    <clip pos="3" side="tl" part="lem"/>
                    <lit v="left"/>
                  </equal>
                </or>
              </and>
            </test>
            <let>
              <clip pos="5" side="tl" part="lem"/>
              <lit v="on"/>
            </let>
          </when>
        </choose>
        <out> 
          <chunk name="pr_pos_n" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><lit-tag v="pos"/></tag>
              <tag><var n="gen_chunk"/></tag>
              <tag><var n="nbr_chunk"/></tag>
            </tags>
            <lu>
              <clip pos="5" side="tl" part="lem"/>
              <clip pos="5" side="tl" part="a_prep"/>
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="det_pos"/>
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="ND" link-to="3"/>
              <clip pos="3" side="tl" part="sp"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: PRON + en + NOM + ADJ + DET (nire etxe gorria - my red house; nire etxe handi hori - this big house of mine)">
      <pattern>
        <pattern-item n="prnpers"/>
        <pattern-item n="en"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="det"/><!--MG: nire etxe handi hori falla, fer que sigui sols 'a'? -->
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="posesivo">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="4"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="5" side="sl" part="lem"/>
                <lit v="a"/>
              </equal>
            </test>
            <out> 
              <chunk name="pos_adj_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><lit-tag v="pos"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="det_pos"/>
                  <clip pos="5" side="tl" part="ND" link-to="3"/>
                  <clip pos="5" side="tl" part="sp"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="4" side="tl" part="lem"/> 
                  <clip pos="4" side="tl" part="tags"/>
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <call-macro n="posesivo_det">
              <with-param pos="1"/>
              <with-param pos="5"/>
            </call-macro>
            <call-macro n="tipo_det">
              <with-param pos="5"/>
            </call-macro>
            <out> 
              <chunk name="det_adj_nom_of_mine" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><lit-tag v="pos"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                </tags>
                <lu>
                  <clip pos="5" side="tl" part="lem"/>
                  <clip pos="5" side="tl" part="a_det"/>
                  <clip pos="5" side="tl" part="tipus_det"/>
                  <clip pos="5" side="tl" part="ND" link-to="3"/>
                  <clip pos="5" side="tl" part="sp"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="4" side="tl" part="lem"/> 
                  <clip pos="4" side="tl" part="tags"/>
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
                <b/>
                <lu>
                  <lit v="of"/>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="det_pos"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: PRON + en + NOM + ADJ + DET (nire etxe gorrian - in my red house)">
      <pattern>
        <pattern-item n="prnpers"/>
        <pattern-item n="en"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="det"/><!--MG: nire etxe handi hori falla, fer que sigui sols 'a'? -->
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="posesivo">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="6"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="4"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="5" side="sl" part="lem"/>
                <lit v="a"/>
              </equal>
            </test>
            <out> 
              <chunk name="pos_adj_nom" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><lit-tag v="pos"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                </tags>
                <lu>
                  <clip pos="6" side="tl" part="lem"/>
                  <clip pos="6" side="tl" part="a_prep"/>
                </lu>
                <var n="blanco"/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="det_pos"/>
                  <clip pos="5" side="tl" part="ND" link-to="3"/>
                  <clip pos="5" side="tl" part="sp"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="4" side="tl" part="lem"/> 
                  <clip pos="4" side="tl" part="tags"/>
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <call-macro n="posesivo_det">
              <with-param pos="1"/>
              <with-param pos="5"/>
            </call-macro>
            <call-macro n="tipo_det">
              <with-param pos="5"/>
            </call-macro>
            <out> 
              <chunk name="det_adj_nom_of_mine" case="caseFirstWord">
                <tags>
                  <tag><var n="chunk"/></tag>
                  <tag><lit-tag v="pos"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                </tags>
                <lu>
                  <clip pos="6" side="tl" part="lem"/>
                  <clip pos="6" side="tl" part="a_prep"/>
                </lu>
                <var n="blanco"/>
                <lu>
                  <clip pos="5" side="tl" part="lem"/>
                  <clip pos="5" side="tl" part="a_det"/>
                  <clip pos="5" side="tl" part="tipus_det"/>
                  <clip pos="5" side="tl" part="ND" link-to="3"/>
                  <clip pos="5" side="tl" part="sp"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="4" side="tl" part="lem"/> 
                  <clip pos="4" side="tl" part="tags"/>
                </lu>
                <b pos="3"/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="ND" link-to="3"/>
                  <clip pos="3" side="tl" part="sp"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
                <b/>
                <lu>
                  <lit v="of"/>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="det_pos"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: PRON + en + NOM + ADJ + DET (bere hurrengo opera - his next opera)">
      <pattern>
        <pattern-item n="prnpers"/>
        <pattern-item n="en"/>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="posesivo">
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="4"/>
          <with-param pos="3"/>
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="3"/>
        </call-macro>
        <out> 
          <chunk name="pos_adj_n" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><lit-tag v="pos"/></tag>
              <tag><var n="nbr_chunk"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="det_pos"/>
              <clip pos="5" side="tl" part="ND" link-to="3"/>
              <clip pos="5" side="tl" part="sp"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="tags"/>
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
              <clip pos="4" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: PRON + en + NOM + ADJ + DET (bere hurrengo operan - in his next opera)">
      <pattern>
        <pattern-item n="prnpers"/>
        <pattern-item n="en"/>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="posesivo">
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="4"/>
          <with-param pos="3"/>
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="6"/>
        </call-macro>
        <out> 
          <chunk name="pr_pos_adj_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><lit-tag v="pos"/></tag>
              <tag><var n="gen_chunk"/></tag>
              <tag><var n="nbr_chunk"/></tag>
            </tags>
            <lu>
              <clip pos="6" side="tl" part="lem"/>
              <clip pos="6" side="tl" part="a_prep"/>
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="det_pos"/>
              <clip pos="5" side="tl" part="ND" link-to="3"/>
              <clip pos="5" side="tl" part="sp"/>
            </lu>
            <b pos="2"/>
            <lu> 
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="tags"/>
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
              <clip pos="4" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>




    <rule comment="REGLA: PRON + en + NOM + ko/en+ NOM + DET (nire aitaren etxea - my father's house) (em sembla que no es dóna mai posesiu + nom mugagabe, treure?">
      <pattern>
        <pattern-item n="prnpers"/>
        <pattern-item n="en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="5"/>
          <with-param pos="6"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="posesivo">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="6"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="6" side="tl" part="lem"/>
                <lit v="the"/>
              </equal>
            </test>
            <out> 
              <chunk name="nom_gen_pos_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="det_pos"/>
                  <clip pos="5" side="tl" part="nbr"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="5" side="tl" part="nbr"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
                <lu>
                  <lit v="'s"/> 
                  <lit-tag v="gen"/> 
                </lu>
                <b pos="4"/>
                <lu> 
                  <clip pos="5" side="tl" part="lemh"/> 
                  <clip pos="5" side="tl" part="a_nom"/>
                  <clip pos="5" side="tl" part="ND" link-to="3"/>
                  <clip pos="5" side="tl" part="sp"/>
                  <clip pos="5" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out> 
              <chunk name="det_nom_pr_pos_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="6" side="tl" part="lem"/> 
                  <clip pos="6" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="6" side="tl" part="ND" link-to="3"/>
                  <clip pos="6" side="tl" part="sp"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="5" side="tl" part="lemh"/> 
                  <clip pos="5" side="tl" part="a_nom"/>
                  <clip pos="5" side="tl" part="ND" link-to="3"/>
                  <clip pos="5" side="tl" part="sp"/>
                  <clip pos="5" side="tl" part="lemq"/> 
                </lu>
                <b pos="4"/>
                <lu>
                  <clip pos="4" side="tl" part="whole"/> 
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="det_pos"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
                <b/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: PRON + en + NOM + DET + ko/en+ NOM + DET (nire aitaren etxea - la casa de mi padre)">
      <pattern>
        <pattern-item n="prnpers"/>
        <pattern-item n="en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="6"/>
          <with-param pos="7"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <call-macro n="posesivo">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="7"/>
        </call-macro>
        <call-macro n="gen_n2">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="7" side="tl" part="lem"/>
                <lit v="the"/>
              </equal>
            </test>
            <out> 
              <chunk name="pos_nom_gen_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="det_pos"/>
                  <clip pos="4" side="tl" part="nbr"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="nbr"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
                <lu>
                  <var n="genitive"/>
                </lu>
                <b pos="5"/>
                <lu> 
                  <clip pos="6" side="tl" part="lemh"/> 
                  <clip pos="6" side="tl" part="a_nom"/>
                  <clip pos="6" side="tl" part="ND" link-to="3"/>
                  <clip pos="6" side="tl" part="sp"/>
                  <clip pos="6" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out> 
              <chunk name="det_nom_pr_pos_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="7" side="tl" part="lem"/> 
                  <clip pos="7" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="7" side="tl" part="ND" link-to="3"/>
                  <clip pos="7" side="tl" part="sp"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="6" side="tl" part="lemh"/> 
                  <clip pos="6" side="tl" part="a_nom"/>
                  <clip pos="6" side="tl" part="ND" link-to="3"/>
                  <clip pos="6" side="tl" part="sp"/>
                  <clip pos="6" side="tl" part="lemq"/> 
                </lu>
                <b pos="5"/>
                <lu>
                  <clip pos="5" side="tl" part="whole"/> 
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="det_pos"/>
                  <clip pos="4" side="tl" part="nbr"/>
                </lu>
                <b/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="nbr"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
                <b/>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>



    <rule comment="REGLA: PRON + en + NOM + ko/en+ NOM + DET (nire aitaren etxean - in my father's house) (em sembla que no es dóna mai posesiu + nom mugagabe, treure?">
      <pattern>
        <pattern-item n="prnpers"/>
        <pattern-item n="en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="5"/>
          <with-param pos="6"/>
        </call-macro>
        <call-macro n="nbr_n1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="7"/>
        </call-macro>
        <call-macro n="posesivo">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="6"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="6" side="tl" part="lem"/>
                <lit v="the"/>
              </equal>
            </test>
            <out> 
              <chunk name="pr_pos_nom_gen_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="7" side="tl" part="lem"/> 
                  <clip pos="7" side="tl" part="a_prep"/> 
                </lu>
                <var n="blanco"/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="det_pos"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
                <lu>
                  <var n="genitive"/>
                </lu>
                <b pos="4"/>
                <lu> 
                  <clip pos="5" side="tl" part="lemh"/> 
                  <clip pos="5" side="tl" part="a_nom"/>
                  <clip pos="5" side="tl" part="ND" link-to="3"/>
                  <clip pos="5" side="tl" part="sp"/>
                  <clip pos="5" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out> 
              <chunk name="pr_det_nom_pr_pos_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="7" side="tl" part="lem"/> 
                  <clip pos="7" side="tl" part="a_prep"/> 
                </lu>
                <var n="blanco"/>
                <lu>
                  <clip pos="6" side="tl" part="lem"/> 
                  <clip pos="6" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="6" side="tl" part="ND" link-to="3"/>
                  <clip pos="6" side="tl" part="sp"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="5" side="tl" part="lemh"/> 
                  <clip pos="5" side="tl" part="a_nom"/>
                  <clip pos="5" side="tl" part="ND" link-to="3"/>
                  <clip pos="5" side="tl" part="sp"/>
                  <clip pos="5" side="tl" part="lemq"/> 
                </lu>
                <b pos="4"/>
                <lu>
                  <clip pos="4" side="tl" part="whole"/> 
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="det_pos"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
                <b/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: PRON + en + NOM + DET + ko/en+ NOM + DET (nire aitaren etxean - in my father's house)">
      <pattern>
        <pattern-item n="prnpers"/>
        <pattern-item n="en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="ko_en"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="6"/>
          <with-param pos="7"/>
        </call-macro>
        <call-macro n="gen_n2">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="8"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <call-macro n="posesivo">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="7"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="7" side="tl" part="lem"/>
                <lit v="the"/>
              </equal>
            </test>
            <out> 
              <chunk name="pr_pos_nom_gen_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="8" side="tl" part="lem"/> 
                  <clip pos="8" side="tl" part="a_prep"/> 
                </lu>
                <var n="blanco"/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="det_pos"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
                <lu>
                  <var n="genitive"/>
                </lu>
                <b pos="5"/>
                <lu> 
                  <clip pos="6" side="tl" part="lemh"/> 
                  <clip pos="6" side="tl" part="a_nom"/>
                  <clip pos="6" side="tl" part="ND" link-to="3"/>
                  <clip pos="6" side="tl" part="sp"/>
                  <clip pos="6" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out> 
              <chunk name="pr_det_nom_pr_pos_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="tipusdet"/></tag>
                  <tag><var n="nbr_chunk"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="8" side="tl" part="lem"/> 
                  <clip pos="8" side="tl" part="a_prep"/> 
                </lu>
                <var n="blanco"/>
                <lu>
                  <clip pos="7" side="tl" part="lem"/> 
                  <clip pos="7" side="tl" part="a_det"/> 
                  <lit-tag v="2"/> 
                  <clip pos="7" side="tl" part="ND" link-to="3"/>
                  <clip pos="7" side="tl" part="sp"/>
                </lu>
                <b pos="2"/>
                <lu> 
                  <clip pos="6" side="tl" part="lemh"/> 
                  <clip pos="6" side="tl" part="a_nom"/>
                  <clip pos="6" side="tl" part="ND" link-to="3"/>
                  <clip pos="6" side="tl" part="sp"/>
                  <clip pos="6" side="tl" part="lemq"/> 
                </lu>
                <b pos="5"/>
                <lu>
                  <clip pos="5" side="tl" part="whole"/> 
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="det_pos"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
                <b/>
                <lu> 
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <clip pos="3" side="tl" part="lemq"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>


    <!--**** SN amb graus adjectiu (comparatiu, superlatiu, excessiu) -->



    <rule comment="REGLA: N + ADJ + GRADO + DET (etxe handiagoa - the bigger house, gauza txarrena - the worst thing)">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="gra"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="adv_adj">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
	<let>
	  <var n="lemachunk"/>
	  <concat>
	    <lit v="det_"/>
	    <var n="adv_adjname"/>
	    <lit v="nom"/>
	  </concat>
	</let>
        <out> 
          <chunk namefrom="lemachunk" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_det"/> 
              <clip pos="4" side="tl" part="tipus_det" link-to="2"/> 
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu>
	      <var n="adv_adjectiu"/>
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="ND" link-to="3"/>
              <clip pos="1" side="tl" part="sp"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
	<let>
	  <var n="adv_adjectiu"/>
	  <lit v=""/>
	</let>
	<let>
	  <var n="adv_adjname"/>
	  <lit v=""/>
	</let>
      </action>
    </rule>
    <rule comment="REGLA: N + ADJ + GRADO + DET (etxe handiagoa - the bigger house, gauza txarrena - the worst thing - tagger bug)">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="gra"/>
        <pattern-item n="gra"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="adv_adj">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="5"/>
        </call-macro>
	<let>
	  <var n="lemachunk"/>
	  <concat>
	    <lit v="det_"/>
	    <var n="adv_adjname"/>
	    <lit v="nom"/>
	  </concat>
	</let>
        <out> 
          <chunk namefrom="lemachunk" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="5" side="tl" part="lem"/> 
              <clip pos="5" side="tl" part="a_det"/> 
              <clip pos="5" side="tl" part="tipus_det" link-to="2"/> 
              <clip pos="5" side="tl" part="ND" link-to="3"/>
              <clip pos="5" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu>
	      <var n="adv_adjectiu"/>
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="ND" link-to="3"/>
              <clip pos="1" side="tl" part="sp"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
	<let>
	  <var n="adv_adjectiu"/>
	  <lit v=""/>
	</let>
	<let>
	  <var n="adv_adjname"/>
	  <lit v=""/>
	</let>
      </action>
    </rule>


    <rule comment="REGLA: N + ik + ADJ + sup + a (gauzarik txarrena - the worst thing)">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="part"/>
        <pattern-item n="adj"/>
        <pattern-item n="sup"/>
        <pattern-item n="detart"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="1"/>
          <with-param pos="3"/>
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="adv_adj">
          <with-param pos="4"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="5"/>
        </call-macro>
	<let>
	  <var n="lemachunk"/>
	  <concat>
	    <lit v="det_"/>
	    <var n="adv_adjname"/>
	    <lit v="nom"/>
	  </concat>
	</let>
        <out> 
          <chunk namefrom="lemachunk" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
            </tags>
            <lu>
              <clip pos="5" side="tl" part="lem"/> 
              <clip pos="5" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="5" side="tl" part="ND" link-to="3"/>
              <clip pos="5" side="tl" part="sp"/>
            </lu>
            <b pos="2"/>
            <lu>
	      <var n="adv_adjectiu"/>
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="ND" link-to="3"/>
              <clip pos="1" side="tl" part="sp"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
	<let>
	  <var n="adv_adjectiu"/>
	  <lit v=""/>
	</let>
	<let>
	  <var n="adv_adjname"/>
	  <lit v=""/>
	</let>
      </action>
    </rule>

    <rule comment="REGLA: PP + ko (egindako - done)">
      <pattern>
        <pattern-item n="pp_adv"/>
        <pattern-item n="ko"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let>
          <clip pos="1" side="tl" part="temps"/>
          <lit-tag v="pp"/>
        </let>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lemh"/>
                <lit v="izan"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="lemh"/>
              <lit v="have"/>
            </let>
            <let>
              <clip pos="1" side="tl" part="a_verb"/>
              <lit-tag v="vbhaver"/>
            </let>
          </when>
        </choose>
        <out>
          <chunk name="padv" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SPGEN"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NOM + DET + POST + PADV + KO (etxean egindako - done in the house)">
      <pattern>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
        <pattern-item n="padv"/>
        <pattern-item n="ko"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <choose><!--porque para palabras con función de CN no se puede dejar GD i ND para el t2x, ya que no están enlazados con chunk -->
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <let>
          <clip pos="4" side="tl" part="temps"/>
          <lit-tag v="pp"/>
        </let>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="sl" part="lemh"/>
                <lit v="izan"/>
              </equal>
            </test>
            <let>
              <clip pos="4" side="tl" part="lemh"/>
              <lit v="have"/>
            </let>
            <let>
              <clip pos="4" side="tl" part="a_verb"/>
              <lit-tag v="vbhaver"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="lem"/>
                <lit v="k"/>
              </equal>
            </test>
            <let>
              <var n="palabra"/>
              <concat>
                <lit v="by"/>
                <lit-tag v="pr"/>
              </concat>
            </let>
          </when>
          <otherwise>
            <let>
              <var n="palabra"/>
              <concat>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_prep"/>
              </concat>
            </let>
          </otherwise>
        </choose>
        <out> 
          <chunk name="padv_pr_det_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SPGEN"/></tag>
              <tag><clip pos="4" side="tl" part="a_verb"/></tag>
              <tag><clip pos="4" side="tl" part="temps"/></tag>
              <tag><lit-tag v="ND"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="a_verb"/>
              <clip pos="4" side="tl" part="temps"/>
              <lit-tag v="5"/>
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <var n="palabra"/> 
            </lu>
            <b/>
            <lu>
              <clip pos="2" side="tl" part="whole"/> 
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: ANT + NOM + DET + POST + PADV + KO (etxean egindako)">
      <pattern>
        <pattern-item n="ant"/>
        <pattern-item n="nom"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
        <pattern-item n="padv"/>
        <pattern-item n="ko"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <choose><!--porque para palabras con función de CN no se puede dejar GD i ND para el t2x, ya que no están enlazados con chunk -->
          <when>
            <test>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <let>
          <clip pos="5" side="tl" part="temps"/>
          <lit-tag v="pp"/>
        </let>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="5" side="sl" part="lemh"/>
                <lit v="izan"/>
              </equal>
            </test>
            <let>
              <clip pos="5" side="tl" part="lemh"/>
              <lit v="have"/>
            </let>
            <let>
              <clip pos="5" side="tl" part="a_verb"/>
              <lit-tag v="vbhaver"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="sl" part="lem"/>
                <lit v="k"/>
              </equal>
            </test>
            <let>
              <var n="palabra"/>
              <concat>
                <lit v="by"/>
                <lit-tag v="pr"/>
              </concat>
            </let>
          </when>
          <otherwise>
            <let>
              <var n="palabra"/>
              <concat>
                <clip pos="4" side="tl" part="lem"/>
                <clip pos="4" side="tl" part="a_prep"/>
              </concat>
            </let>
          </otherwise>
        </choose>
        <out> 
          <chunk name="padv_pr_nom_gen_ant" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SPGEN"/></tag>
              <tag><clip pos="5" side="tl" part="a_verb"/></tag>
              <tag><clip pos="5" side="tl" part="temps"/></tag>
              <tag><lit-tag v="ND"/></tag>
            </tags>
            <lu>
              <clip pos="5" side="tl" part="lemh"/>
              <clip pos="5" side="tl" part="a_verb"/>
              <clip pos="5" side="tl" part="temps"/>
              <lit-tag v="5"/>
              <clip pos="5" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <var n="palabra"/> 
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/> 
            </lu>
            <lu> 
              <lit v="'s"/> 
              <lit-tag v="gen"/>
            </lu>
            <b/>
            <lu> 
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: PP + KO + NOM + DET (ezarritako alerta - put the alert)">
      <pattern>
        <pattern-item n="pp_adv"/>
        <pattern-item n="ko"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="3"/>
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <let>
          <clip pos="1" side="tl" part="temps"/>
          <lit-tag v="pp"/>
        </let>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lemh"/>
                <lit v="izan"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="lemh"/>
              <lit v="have"/>
            </let>
            <let>
              <clip pos="1" side="tl" part="a_verb"/>
              <lit-tag v="vbhaver"/>
            </let>
          </when>
        </choose> 
        <out> 
          <chunk name="pp_det_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="ND" link-to="3"/>
              <clip pos="3" side="tl" part="sp"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: PP + KO + NOM + DET + POST (egindako lehergailu batekin - done with a bomb)">
      <pattern>
        <pattern-item n="pp_adv"/>
        <pattern-item n="ko"/>
        <pattern-item n="nom_np"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="concord_n3">
          <with-param pos="3"/>
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="5"/>
        </call-macro>
        <let>
          <clip pos="1" side="tl" part="temps"/>
          <lit-tag v="pp"/>
        </let>

        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lemh"/>
                <lit v="izan"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="lemh"/>
              <lit v="have"/>
            </let>
            <let>
              <clip pos="1" side="tl" part="a_verb"/>
              <lit-tag v="vbhaver"/>
            </let>
          </when>
        </choose> 
        <out> 
          <chunk name="pp_pr_det_nom" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="5" side="tl" part="lem"/> 
              <clip pos="5" side="tl" part="a_prep"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="4" side="tl" part="ND" link-to="3"/>
              <clip pos="4" side="tl" part="sp"/>
            </lu>
            <b pos="3"/>
            <lu> 
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="ND" link-to="3"/>
              <clip pos="3" side="tl" part="sp"/>
              <clip pos="3" side="tl" part="lemq"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <!--******************* REGLAS CON NÚMEROS (PARA FECHAS) ***************************** -->



    <rule comment="REGLA: NUM + POST (2007ko - of 2007(in?))">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="2"/>
        </call-macro>
        <out> 
          <chunk name="pr_num">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><lit-tag v="UNDET"/></tag>
              <tag><clip pos="1" side="tl" part="a_num"/></tag>
            </tags>
            <lu> 
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="a_prep"/> 
            </lu>
            <var n="blanco"/>
            <lu> 
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <!--********************************* REGLES DE SA ***************************************************** -->

    <rule comment="REGLA: ADJ (gorri - red) Para los adjetivos que quedan solos (en teoría todos deberían formar parte de un SA)">
      <pattern>
        <pattern-item n="adjnopp"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA.UNDET"/></tag>
              <tag><lit-tag v="ND"/></tag>
            </tags>
            <lu> 
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="tags"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>




    <rule comment="REGLA: ADJ + DET (gorria - the red)">
      <pattern>
        <pattern-item n="adjnopp"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="concord_adj_det">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="det_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="2" side="tl" part="ND" link-to="3"/>
              <clip pos="2" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="tags"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: ADJ + DET + POST (pribatuan - in the private)">
      <pattern>
        <pattern-item n="adjnopp"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="pr_det_adj" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lem"/>
              <clip pos="3" side="tl" part="a_prep"/>
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="2" side="tl" part="ND" link-to="3"/>
              <clip pos="2" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu> 
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b/>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: PP (irekia - the opened)">
      <pattern>
        <pattern-item n="pp"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="det_pp" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="2" side="tl" part="ND" link-to="3"/>
              <clip pos="2" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: PP (atxilotuei - to the arrested)">
      <pattern>
        <pattern-item n="pp"/>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="concord_n2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <chunk name="pr_det_pp" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><var n="nbr_chunk"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lem"/>
              <clip pos="3" side="tl" part="a_prep"/>
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="2" side="tl" part="ND" link-to="3"/>
              <clip pos="2" side="tl" part="sp"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: ADJ + GRADO (gorriago, gorriegi - too red, gorrien(a))">
      <pattern>
        <pattern-item n="adj"/>
        <pattern-item n="gra"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="adv_adj">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk namefrom="adv_adjname" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA.UNDET"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><lit-tag v="ND"/></tag>
              <tag><clip pos="2" side="sl" part="grade"/></tag>
            </tags>
            <lu>
	      <var n="adv_adjectiu"/>
            </lu>
          </chunk>
        </out>
	<let>
	  <var n="adv_adjectiu"/>
	  <lit v=""/>
	</let>
	<let>
	  <var n="adv_adjname"/>
	  <lit v=""/>
	</let>
      </action>
    </rule>

    <rule comment="REGLA: ADJ + GRADO (gorriago, gorriegi - too red, gorrien(a) - tagger bug)">
      <pattern>
        <pattern-item n="adj"/>
        <pattern-item n="gra"/>
        <pattern-item n="gra"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="adv_adj">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk namefrom="adv_adjname" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA.UNDET"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><lit-tag v="ND"/></tag>
              <tag><clip pos="2" side="sl" part="grade"/></tag>
            </tags>
            <lu>
	      <var n="adv_adjectiu"/>
            </lu>
          </chunk>
        </out>
	<let>
	  <var n="adv_adjectiu"/>
	  <lit v=""/>
	</let>
	<let>
	  <var n="adv_adjname"/>
	  <lit v=""/>
	</let>
      </action>
    </rule>

    <!-- the following two rules are here because of a strange error, as a workaround -->
    <rule comment="REGLA: GRADO">
      <pattern>
        <pattern-item n="gra"/>
      </pattern>
      <action>
        <let>
          <var n="blanco"/>
          <lit v=""/>
        </let>
        <let>
           <var n="adv_adjname"/>
           <clip pos="1" side="sl" part="lem"/>
        </let>
        <out> 
          <chunk namefrom="adv_adjname" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="ADV"/></tag>
              <tag><clip pos="1" side="sl" part="tags"/></tag>
            </tags>
            <var n="blanco"/>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: GRADO">
      <pattern>
        <pattern-item n="gra"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <let>
          <var n="blanco"/>
          <lit v=""/>
        </let>
        <let>
           <var n="adv_adjname"/>
           <concat>
             <clip pos="1" side="sl" part="lem"/>
             <lit v="_"/>
             <clip pos="2" side="sl" part="lem"/>
           </concat>
        </let>
        <out> 
          <chunk namefrom="adv_adjname" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="ADV"/></tag>
              <tag><clip pos="1" side="sl" part="tags"/></tag>
              <tag><clip pos="2" side="sl" part="tags"/></tag>
            </tags>
            <var n="blanco"/>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: adv + gra (maizago - more often)">
      <pattern>
        <pattern-item n="adv"/>
        <pattern-item n="gra"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="adv_adv" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SADV"/></tag>
              <tag><clip pos="1" side="tl" part="a_adv"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><clip pos="2" side="sl" part="grade"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_adv"/>
            </lu>
            <b/>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="a_adv"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: adv + gra (maizago - more often) - tagger bug">
      <pattern>
        <pattern-item n="adv"/>
        <pattern-item n="gra"/>
        <pattern-item n="gra"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="adv_adv" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SADV"/></tag>
              <tag><clip pos="1" side="tl" part="a_adv"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><clip pos="2" side="sl" part="grade"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_adv"/>
            </lu>
            <b/>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="a_adv"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: ADJ + GRADO + DET (gorriagoa, gorriegia, gorriena))">
      <pattern>
        <pattern-item n="adj"/>
        <pattern-item n="gra"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="adv_adj">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
	<let>
	  <var n="lemachunk"/>
	  <concat>
	    <lit v="det_"/>
	    <var n="adv_adjname"/>
	  </concat>
	</let>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="lem"/>
                <lit v="en"/>
              </equal>
            </test><!--en este caso se envía determinante 'def' i no 'art' ('el más rojo') -->
            <let>
              <var n="tipusdet"/>
              <lit-tag v="def"/>
            </let>
          </when>
        </choose>
        <out> 
          <chunk namefrom="lemachunk" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><clip pos="3" side="tl" part="nbr"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="3" side="tl" part="nbr" link-to="3"/>
            </lu>
            <b/>
            <lu>
	      <var n="adv_adjectiu"/>
            </lu>
          </chunk>
        </out>
	<let>
	  <var n="adv_adjectiu"/>
	  <lit v=""/>
	</let>
	<let>
	  <var n="adv_adjname"/>
	  <lit v=""/>
	</let>
      </action>
    </rule>

    <rule comment="REGLA: ADJ + GRADO + DET (gorriagoa, gorriegia, gorriena) - delete this if the tagger bug is ever fixed)">
      <pattern>
        <pattern-item n="adj"/>
        <pattern-item n="gra"/>
        <pattern-item n="gra"/>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="adv_adj">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
	<let>
	  <var n="lemachunk"/>
	  <concat>
	    <lit v="det_"/>
	    <var n="adv_adjname"/>
	  </concat>
	</let>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="lem"/>
                <lit v="en"/>
              </equal>
            </test><!--en este caso se envía determinante 'def' i no 'art' ('el más rojo') -->
            <let>
              <var n="tipusdet"/>
              <lit-tag v="def"/>
            </let>
          </when>
        </choose>
        <out> 
          <chunk namefrom="lemachunk" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><clip pos="4" side="tl" part="nbr"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="lem"/> 
              <clip pos="4" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="4" side="tl" part="nbr" link-to="3"/>
            </lu>
            <b/>
            <lu>
	      <var n="adv_adjectiu"/>
            </lu>
          </chunk>
        </out>
	<let>
	  <var n="adv_adjectiu"/>
	  <lit v=""/>
	</let>
	<let>
	  <var n="adv_adjname"/>
	  <lit v=""/>
	</let>
      </action>
    </rule>

    <rule comment="REGLA: ADJ + POST (erruduntzat - como culpable))">
      <pattern>
        <pattern-item n="adjnopp"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="adjdetpp">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="tipus_adj"/>
                <lit v=""/>
              </equal>
            </test>
            <let>
              <var n="tipusdet"/>
              <lit-tag v="UNDET"/>
            </let>
          </when>
          <otherwise>
            <let>
              <var n="tipusdet"/>
              <clip pos="1" side="tl" part="tipus_adj"/>
            </let>
          </otherwise>
        </choose>
        <call-macro n="SPgenitivo">
          <with-param pos="2"/>
        </call-macro>
        <out> 
          <chunk name="pr_adj" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_prep"/>
            </lu>
            <b/>
            <lu> 
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="tags"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <!--********************************* REGLES DE SV ***************************************************** -->

<rule comment="REGLA:  VERBO SINT potencial (para cuando va después de desconocida - daiteke - puede)">
      <pattern>
        <pattern-item n="aux_potencial"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let>
          <clip pos="1" side="tl" part="lem"/>
          <lit v="can"/>
        </let>
        <let>
          <clip pos="1" side="tl" part="a_verb"/>
          <lit-tag v="vaux"/>
        </let>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="temps"/>
                <lit-tag v="potpr"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="pres"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="temps"/>
                <lit-tag v="potps"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="past"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="temps"/>
                <lit-tag v="poth"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="past"/>
            </let>
          </when>
        </choose>
        <call-macro n="verbal_flex">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="vbconj" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="persnbr"/></tag>
              <tag><clip pos="1" side="sl" part="nor"/></tag>
              <tag><clip pos="1" side="sl" part="nori"/></tag>
              <tag><clip pos="1" side="sl" part="nork"/></tag>
            </tags>
            <var n="aux_verb"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <var n="prn_enc"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="objdat_pron">
          <with-param pos="1"/>
        </call-macro>
      </action>
    </rule>

    <rule comment="REGLA: VERBO SINTÉTICO (dut, nabil)">
      <pattern>
        <pattern-item n="vbsint"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="verbal_flex">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/>
                <lit v="ukan"/>
              </equal>
            </test>
            <let>
              <var n="verbo"/>
              <lit v="vbconj_ukan"/>
            </let>
          </when>
          <when>
            <test>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/>
                <lit v="izan"/>
              </equal>
            </test>
            <let>
              <var n="verbo"/>
              <lit v="vbconj_izan"/>
            </let>
          </when>
          <otherwise>
            <let>
              <var n="verbo"/>
              <lit v="vbconj"/>
            </let>
          </otherwise>
        </choose>
        <out>
          <chunk namefrom="verbo" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag><!--en aquesta regla només posem el temps, per a tractar formes compostes separades en el t2x ('ez dutela galdeketa eman') -->
              <tag><clip pos="1" side="tl" part="persnbr"/></tag>
              <tag><clip pos="1" side="sl" part="nor"/></tag>
              <tag><clip pos="1" side="sl" part="nori"/></tag>
              <tag><clip pos="1" side="sl" part="nork"/></tag>
            </tags>
            <var n="aux_verb"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="persnbr"/>
              <var n="prn_enc"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="objdat_pron">
          <with-param pos="1"/>
        </call-macro>
      </action>
    </rule>
    <rule comment="REGLA: VERBO SINTÉTICO (dut, nabil) - check for be">
      <pattern>
        <pattern-item n="ez"/>
        <pattern-item n="vbsint"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="do_flex">
          <with-param pos="2"/>
        </call-macro>
        <let>
          <clip pos="1" side="tl" part="lem"/>
          <lit v="not"/>
        </let>
        <choose>
          <when>
            <test>
              <equal caseless="yes">
                <clip pos="2" side="sl" part="lem"/>
                <lit v="ukan"/>
              </equal>
            </test>
            <let>
              <var n="verbo"/>
              <lit v="vbconj_ukan"/>
            </let>
          </when>
          <when>
            <test>
              <equal caseless="yes">
                <clip pos="2" side="sl" part="lem"/>
                <lit v="izan"/>
              </equal>
            </test>
            <let>
              <var n="verbo"/>
              <lit v="vbconj_izan"/>
            </let>
          </when>
          <otherwise>
            <let>
              <var n="verbo"/>
              <lit v="vbconj"/>
            </let>
          </otherwise>
        </choose>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="2" side="tl" part="lem"/>
                  <lit v="be"/>
                </equal>
                <equal>
                  <clip pos="2" side="tl" part="a_verb"/>
                  <lit-tag v="vbser"/>
                </equal>
                <equal>
                  <var n="aux_verb"/>
                  <lit v=""/>
                </equal>
                <not>
                  <equal>
                    <clip pos="2" side="tl" part="temps"/>
                    <lit-tag v="pp"/>
                  </equal>
                </not>
              </and>
            </test>
            <out>
              <chunk name="be_not" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_verb"/>
                  <clip pos="2" side="tl" part="temps"/>
                  <clip pos="2" side="tl" part="persnbr"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk namefrom="verbo" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="2" side="tl" part="temps"/></tag><!--en aquesta regla només posem el temps, per a tractar formes compostes separades en el t2x ('ez dutela galdeketa eman') -->
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_verb"/>
                  <clip pos="2" side="tl" part="temps"/>
                  <clip pos="2" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="objdat_pron">
          <with-param pos="2"/>
        </call-macro>
      </action>
    </rule>

<!--
    < rule comment="REGLA: lakoan egon - I think...">
      <pattern>
        <pattern-item n="lakoan"/>
        <pattern-item n="egon"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <let>
          <clip pos="2" side="tl" part="lem"/>
          <lit v="think"/>
        </let>
        <let>
          <clip pos="2" side="tl" part="a_verb"/>
          <lit-tag v="vblex"/>
        </let>
        <choose>
          <when>
            <test>
              <equal>
                <var n="aux_verb"/>
                <lit v=""/>
              </equal>
            </test>
            <let>
              <var n="verbo"/>
              <lit v="lakoan_egon"/>
            </let>
          </when>
          <otherwise>
            <let>
              <var n="verbo"/>
              <lit v="aux_lakoan_egon"/>
            </let>
          </otherwise>
        </choose>
        <out>
          <chunk namefrom="verbo" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><clip pos="2" side="tl" part="temps"/></tag><!-x-en aquesta regla només posem el temps, per a tractar formes compostes separades en el t2x ('ez dutela galdeketa eman') -x->
              <tag><clip pos="2" side="tl" part="persnbr"/></tag>
              <tag><clip pos="2" side="sl" part="nor"/></tag>
              <tag><clip pos="2" side="sl" part="nori"/></tag>
              <tag><clip pos="2" side="sl" part="nork"/></tag>
            </tags>
            <var n="aux_verb"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="persnbr"/>
              <var n="prn_enc"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="objdat_pron">
          <with-param pos="1"/>
        </call-macro>
      </action>
    </rule>
-->

    <rule comment="REGLA: VERBO PERIFRÁSTICO (nahi dut)">
      <pattern>
        <pattern-item n="vbper"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="verbal_flex">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="vbconj" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="persnbr"/></tag>
              <tag><clip pos="1" side="sl" part="nor"/></tag>
              <tag><clip pos="1" side="sl" part="nori"/></tag>
              <tag><clip pos="1" side="sl" part="nork"/></tag>
            </tags>
            <var n="aux_verb"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="persnbr"/>
              <var n="prn_enc"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="objdat_pron">
          <with-param pos="1"/>
        </call-macro>
      </action>
    </rule>
    <rule comment="REGLA: VERBO PERIFRÁSTICO (nahi dut)">
      <pattern>
        <pattern-item n="ez"/>
        <pattern-item n="vbper"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="do_flex">
          <with-param pos="2"/>
        </call-macro>
        <let>
          <clip pos="1" side="tl" part="lem"/>
          <lit v="not"/>
        </let>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="2" side="tl" part="lem"/>
                  <lit v="be"/>
                </equal>
                <equal>
                  <clip pos="2" side="tl" part="a_verb"/>
                  <lit-tag v="vbser"/>
                </equal>
                <equal>
                  <var n="aux_verb"/>
                  <lit v=""/>
                </equal>
                <not>
                  <equal>
                    <clip pos="2" side="tl" part="temps"/>
                    <lit-tag v="pp"/>
                  </equal>
                </not>
              </and>
            </test>
            <out>
              <chunk name="be_not" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_verb"/>
                  <clip pos="2" side="tl" part="temps"/>
                  <clip pos="2" side="tl" part="persnbr"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="ez_vbconj" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_verb"/>
                  <clip pos="2" side="tl" part="temps"/>
                  <clip pos="2" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="objdat_pron">
          <with-param pos="1"/>
        </call-macro>
      </action>
    </rule>

    <rule comment="REGLA: PP + VERBO SINT (ikusi dut - I have seen)">
      <pattern>
        <pattern-item n="pp"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <or>
                <equal>
                  <clip pos="2" side="tl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="2" side="tl" part="temps"/>
                  <lit-tag v="pres"/>
                </equal>
              </or>
            </test>
            <let>
              <clip pos="2" side="tl" part="lem"/>
               <lit v="have"/>
            </let>
            <let>
              <clip pos="2" side="tl" part="a_verb"/>
               <lit-tag v="vbhaver"/>
            </let>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="2" side="tl" part="persnbr"/>
                    <lit-tag v="p1.sg"/>
                  </equal>
                </test>
                <let>
                  <clip pos="2" side="tl" part="persnbr"/>
                   <lit v=""/>
                </let>
                <let>
                  <clip pos="2" side="tl" part="temps"/>
                   <lit-tag v="pres"/>
                </let>
              </when>
            </choose>
            <out>
              <chunk name="have_pp" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_verb"/>
                  <clip pos="2" side="tl" part="temps"/>
                  <clip pos="2" side="tl" part="persnbr"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <call-macro n="swap_temps">
              <with-param pos="1"/>
              <with-param pos="2"/>
            </call-macro>
            <out>
              <chunk name="vbconj" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <var n="aux_verb"/>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <clip pos="1" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
            <call-macro n="f_bcond">
              <with-param pos="1"/>
              <with-param pos="2"/>
            </call-macro>
          </otherwise>
        </choose>
        <call-macro n="objdat_pron">
         <with-param pos="2"/>
        </call-macro>
      </action>
    </rule>

    <rule comment="REGLA: PP + EGIN/IZAN(PP) + VERBO SINT (ikusi egin dut - aditza galdegaia) / (ikusi izan dut - I have seen)">
      <pattern>
        <pattern-item n="pp"/>
        <pattern-item n="egin_izanpp"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <let>
          <clip pos="3" side="tl" part="lem"/>
          <lit v="have"/>
        </let>
        <let>
          <clip pos="3" side="tl" part="a_verb"/>
          <lit-tag v="vbhaver"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <or>
                <equal>
                  <clip pos="3" side="tl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="3" side="tl" part="temps"/>
                  <lit-tag v="pres"/>
                </equal>
              </or>
            </test>
            <out>
              <chunk name="vbconj_pp" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="3" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="3" side="sl" part="nor"/></tag>
                  <tag><clip pos="3" side="sl" part="nori"/></tag>
                  <tag><clip pos="3" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <clip pos="3" side="tl" part="temps"/>
                  <clip pos="3" side="tl" part="persnbr"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <call-macro n="swap_temps">
              <with-param pos="1"/>
              <with-param pos="3"/>
            </call-macro>
            <out>
              <chunk name="vbconj" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="3" side="sl" part="nor"/></tag>
                  <tag><clip pos="3" side="sl" part="nori"/></tag>
                  <tag><clip pos="3" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <clip pos="1" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
            <call-macro n="f_bcond">
              <with-param pos="1"/>
              <with-param pos="2"/>
            </call-macro>
          </otherwise>
        </choose>
        <call-macro n="f_bcond">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="objdat_pron">
         <with-param pos="3"/>
        </call-macro>
      </action>
    </rule>


    <rule comment="REGLA: GER + VERBO SINT (etortzen naiz - I come)">
      <pattern>
        <pattern-item n="ger"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="swap_temps">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="vbconj" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="2" side="tl" part="persnbr"/></tag>
              <tag><clip pos="2" side="sl" part="nor"/></tag>
              <tag><clip pos="2" side="sl" part="nori"/></tag>
              <tag><clip pos="2" side="sl" part="nork"/></tag>
            </tags>
            <var n="aux_verb"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="persnbr"/>
              <var n="prn_enc"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="f_bcond">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="objdat_pron">
         <with-param pos="2"/>
        </call-macro>
      </action>
    </rule>


    <rule comment="REGLA: PP + EGIN(GER) + VERBO SINT (etorri egiten naiz) - aditza galdegaia">
      <pattern>
        <pattern-item n="pp"/>
        <pattern-item n="eginger"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="verbal_flex">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="swap_temps">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <chunk name="vbconj" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="3" side="tl" part="persnbr"/></tag>
              <tag><clip pos="3" side="sl" part="nor"/></tag>
              <tag><clip pos="3" side="sl" part="nori"/></tag>
              <tag><clip pos="3" side="sl" part="nork"/></tag>
            </tags>
            <var n="aux_verb"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="persnbr"/>
              <var n="prn_enc"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="f_bcond">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_bcond">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="objdat_pron">
          <with-param pos="3"/>
        </call-macro>
      </action>
    </rule>


 <rule comment="REGLA: GER + IZAN + VERBO SINT (etortzen izan naiz - vengo (suelo venir))">
      <pattern>
        <pattern-item n="ger"/>
        <pattern-item n="izanpp"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="verbal_flex">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="swap_temps">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <chunk name="vbconj" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="3" side="tl" part="persnbr"/></tag>
              <tag><clip pos="3" side="sl" part="nor"/></tag>
              <tag><clip pos="3" side="sl" part="nori"/></tag>
              <tag><clip pos="3" side="sl" part="nork"/></tag>
            </tags>
            <var n="aux_verb"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="persnbr"/>
              <var n="prn_enc"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="f_bcond">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="objdat_pron">
          <with-param pos="3"/>
        </call-macro>
      </action>
    </rule>



    <rule comment="REGLA: PFUT + VERBO SINT (etorriko naiz - I will come)">
      <pattern>
        <pattern-item n="pfut"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="tl" part="temps"/>
                <lit-tag v="pri"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="temps"/>
              <lit-tag v="fti"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="2" side="tl" part="temps"/>
                <lit-tag v="pii"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="temps"/>
              <lit-tag v="cni"/>
            </let>
          </when>
        </choose>
        <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="swap_temps">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="vbconj" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="2" side="tl" part="persnbr"/></tag>
              <tag><clip pos="2" side="sl" part="nor"/></tag>
              <tag><clip pos="2" side="sl" part="nori"/></tag>
              <tag><clip pos="2" side="sl" part="nork"/></tag>
            </tags>
            <var n="aux_verb"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="persnbr"/>
              <var n="prn_enc"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="f_bcond">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="objdat_pron">
          <with-param pos="2"/>
        </call-macro>
      </action>
    </rule>



    <rule comment="REGLA: PP + EGIN(PFUT) + VERBO SINT (etorri egingo naiz) - aditza galdegaia">
      <pattern>
        <pattern-item n="pp"/>
        <pattern-item n="eginpfut"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="tl" part="temps"/>
                <lit-tag v="pri"/>
              </equal>
            </test>
            <let>
              <clip pos="3" side="tl" part="temps"/>
              <lit-tag v="fti"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="3" side="tl" part="temps"/>
                <lit-tag v="pii"/>
              </equal>
            </test>
            <let>
              <clip pos="3" side="tl" part="temps"/>
              <lit-tag v="cni"/>
            </let>
          </when>
        </choose>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="verbal_flex">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="swap_temps">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <chunk name="vbconj" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="3" side="tl" part="persnbr"/></tag>
              <tag><clip pos="3" side="sl" part="nor"/></tag>
              <tag><clip pos="3" side="sl" part="nori"/></tag>
              <tag><clip pos="3" side="sl" part="nork"/></tag>
            </tags>
            <var n="aux_verb"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="persnbr"/>
              <var n="prn_enc"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="f_bcond">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_bcond">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="objdat_pron">
          <with-param pos="1"/>
        </call-macro>
      </action>
    </rule>




    <rule comment="REGLA: GER + ARI IZAN (prestatzen ari gara - we are preparing)">
      <pattern>
        <pattern-item n="ger"/>
        <pattern-item n="ari_izan"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="be_ger" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="2" side="tl" part="persnbr"/></tag>
              <tag><clip pos="2" side="sl" part="nor"/></tag>
              <tag><clip pos="2" side="sl" part="nori"/></tag>
              <tag><clip pos="2" side="sl" part="nork"/></tag>
            </tags>
            <var n="aux_verb"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="persnbr"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <var n="prn_enc"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="objdat_pron">
          <with-param pos="1"/>
        </call-macro>
      </action>
    </rule>








    <rule comment="REGLA: PP (changes to ger; in t2 may be retained as pp)">
      <pattern>
        <pattern-item n="pp"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="pp" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><lit-tag v="PD"/></tag>
              <tag><lit-tag v="ND"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <lit-tag v="ger"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: INF (para colocar cola en Testvoc, no sirve para nada más)">
      <pattern>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="verbal_flex">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="inf" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <var n="prn_enc"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="objdat_pron">
          <with-param pos="1"/>
        </call-macro>
      </action>
    </rule>

    <rule comment="REGLA: GER ">
      <pattern>
        <pattern-item n="ger"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="ger" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><lit-tag v="PD"/></tag>
              <tag><lit-tag v="ND"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: PFUT  -  en el t2x se le intenta asignar pers y nbr; si no entra por ninguna regla, se deja como infinitivo. ">
      <pattern>
        <pattern-item n="pfut"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="pfut" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><lit-tag v="PD"/></tag>
              <tag><lit-tag v="ND"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <lit-tag v="inf"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: PADV">
      <pattern>
        <pattern-item n="padv"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let>
          <clip pos="1" side="tl" part="temps"/>
          <lit-tag v="pp"/>
        </let>
        <out>
          <chunk name="padv" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

<rule comment="ADITZ IZENA (por ahora se deja en infinitivo si no entra por otras reglas) ">
      <pattern>
        <pattern-item n="vbizen"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let>
          <clip pos="1" side="tl" part="temps"/>
          <lit-tag v="inf"/>
        </let>
        <out>
          <chunk name="inf" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="ADITZ IZENA + KO (joateko - para ir) ">
      <pattern>
        <pattern-item n="vbizen"/>
        <pattern-item n="ko"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let>
          <clip pos="1" side="tl" part="temps"/>
          <lit-tag v="inf"/>
        </let>
        <out>
          <chunk name="tzeko" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SVsub"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><lit-tag v="PD"/></tag>
              <tag><lit-tag v="ND"/></tag>
            </tags>
            <lu>
              <lit v="to"/>
              <lit-tag v="pr"/>
            </lu>
            <b/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="EZ + ADITZ IZENA + KO (ez joateko - not to go) ">
      <pattern>
        <pattern-item n="ez"/>
        <pattern-item n="vbizen"/>
        <pattern-item n="ko"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let>
          <clip pos="2" side="tl" part="temps"/>
          <lit-tag v="inf"/>
        </let>
        <out>
          <chunk name="ez_tzeko" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SVsub"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><clip pos="2" side="tl" part="temps"/></tag>
              <tag><lit-tag v="PD"/></tag>
              <tag><lit-tag v="ND"/></tag>
            </tags>
            <lu>
              <lit v="not"/>
              <lit-tag v="adv"/>
            </lu>
            <b pos="1"/>
            <lu>
              <lit v="to"/>
              <lit-tag v="pr"/>
            </lu>
            <b/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="ADITZ IZENA + ART (izatea = ser) (el artículo desaparece por ahora) ">
      <pattern>
        <pattern-item n="vbizen"/>
        <pattern-item n="detart"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let>
          <clip pos="1" side="tl" part="temps"/>
          <lit-tag v="inf"/>
        </let>
        <out>
          <chunk name="inf" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><lit-tag v="PD"/></tag>
              <tag><lit-tag v="ND"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="ADITZ IZENA + KO (argitzeke - without clarifying) ">
      <pattern>
        <pattern-item n="vbizen"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let>
          <clip pos="1" side="tl" part="temps"/>
          <lit-tag v="ger"/>
        </let>
        <out>
          <chunk name="pr_ger" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="a_prep"/>
            </lu>
            <b/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="ADITZ IZENA + ART (betetzeagatik = by filling) ">
      <pattern>
        <pattern-item n="vbizen"/>
        <pattern-item n="detart"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let>
          <clip pos="1" side="tl" part="temps"/>
          <lit-tag v="ger"/>
        </let>
        <out>
          <chunk name="pr_ger" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><lit-tag v="PD"/></tag>
              <tag><lit-tag v="ND"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lem"/>
              <clip pos="3" side="tl" part="a_prep"/>
            </lu>
            <b/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: PP + ezinda (saldu ezinda - being unable to sell">
      <pattern>
        <pattern-item n="pp"/>
        <pattern-item n="ezinda"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let>
          <clip pos="2" side="tl" part="temps"/>
          <lit-tag v="ger"/>
        </let>
        <let>
          <clip pos="1" side="tl" part="temps"/>
          <lit-tag v="inf"/>
        </let>
        <out>
          <chunk name="ger_inf" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: PP + IK (esanik - having said)">
      <pattern>
        <pattern-item n="pp"/>
        <pattern-item n="part"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out> 
          <chunk name="pp_ik" case="caseFirstWord"> 
            <tags>
              <tag><lit-tag v="SVsub"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><lit-tag v="ger"/></tag>
            </tags>
            <lu>
              <lit v="have"/>
              <lit-tag v="vbhaver.ger"/>
            </lu>
            <b/>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


 <rule comment="REGLA: PP + IK (onartuz [onartuz gero])">
      <pattern>
        <pattern-item n="pp"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="SPgenitivo">
          <with-param pos="2"/>
        </call-macro>
        <let>
          <clip pos="1" side="tl" part="temps"/>
          <lit-tag v="ger"/>
        </let>
        <out> 
          <chunk name="pr_ger" case="caseFirstWord"> 
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
            <b/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: cnjadv que va amb verbs conjugats ((e)nez/lako)">
      <pattern>
        <pattern-item n="cnjadv1"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="cnjadv1" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="cnjadv"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: cnjadv que va amb verbs sense conjugar (ezik, ezean)">
      <pattern>
        <pattern-item n="cnjadv2"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let>
          <var n="lema"/>
          <clip pos="1" side="sl" part="lemh"/>
        </let>
        <out>
          <chunk namefrom="lema" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="cnjadv"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: baino (para hacer comparativas en el t2x)">
      <pattern>
        <pattern-item n="baino"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="baino" case="caseFirstWord">
            <tags>
              <tag><clip pos="1" side="tl" part="tags"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    
    
    <rule comment="REGLA: (zituzte)la (de momento se traduce por una coma porque sino el 'que' sin ordenar distorsiona el sentido:
                   hil dela esan dute - han muerto *que han dicho">
      <pattern>
        <pattern-item n="cnjsub"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="que" case="caseFirstWord">
            <tags>
              <tag><clip pos="1" side="tl" part="tags"/></tag>
            </tags>
            <!--  <lu>
                 <clip pos="1" side="tl" part="whole"/>
                 </lu> -->
            <lu>
              <lit v=","/>
              <lit-tag v="cm"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <!-- Negación de verbos 
         Falta para verbos sintéticos: ponerlo en el diccionario monolingüe mejor, no? 'ez naiz bizi'
         Falta negación de 'prestatzen ari gara'
    -->
    


    <rule comment="REGLA: EZ + VERBO SINT + PP (ez dut ikusi)">
      <pattern>
        <pattern-item n="ez"/>
        <pattern-item n="vbsint_aux"/>
        <pattern-item n="lexpp"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <let>
          <clip pos="2" side="tl" part="lem"/>
          <lit v="have"/>
        </let>
        <let>
          <clip pos="2" side="tl" part="a_verb"/>
          <lit-tag v="vbhaver"/>
        </let>
       <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
	      <or>
                <equal>
                  <clip pos="2" side="tl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="2" side="tl" part="temps"/>
                  <lit-tag v="pres"/>
                </equal>
              </or>
            </test>
            <call-macro n="sep_pron">
              <with-param pos="2"/>
            </call-macro>
            <out>
              <chunk name="have_not_pp">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="2" side="tl" part="temps"/></tag>
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_verb"/>
                  <clip pos="2" side="tl" part="temps"/>
                  <clip pos="2" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
		<lu>
		<lit v="not"/>
		<clip pos="1" side="tl" part="a_adv"/>
		</lu>
		<b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <clip pos="3" side="tl" part="temps"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <call-macro n="swap_temps">
              <with-param pos="3"/>
              <with-param pos="2"/>
            </call-macro>
            <call-macro n="sep_pron">
              <with-param pos="3"/>
            </call-macro>
            <out>
              <chunk name="vbconj">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="3" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="temps"/></tag>
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <clip pos="3" side="tl" part="temps"/>
                  <clip pos="3" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
            <call-macro n="f_bcond">
              <with-param pos="2"/>
              <with-param pos="3"/>
            </call-macro>
          </otherwise>
        </choose>
        <call-macro n="objdat_pron">
          <with-param pos="2"/>
        </call-macro>
      </action>
    </rule>


    <rule comment="REGLA: EZ + VERBO SINT + GER (ez naiz etortzen)">
      <pattern>
        <pattern-item n="ez"/>
        <pattern-item n="vbsint_aux"/>
        <pattern-item n="lexger"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><!--porque los proclíticos dentro de la macro verbal_flex se envían con caseFirstWord-->
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <let>
          <clip pos="1" side="tl" part="lem"/>
          <lit v="not"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="swap_temps">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="do_flex">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="3" side="tl" part="lem"/>
                  <lit v="be"/>
                </equal>
                <equal>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <lit-tag v="vbser"/>
                </equal>
                <equal>
                  <var n="aux_verb"/>
                  <lit v=""/>
                </equal>
                <not>
                  <equal>
                    <clip pos="3" side="tl" part="temps"/>
                    <lit-tag v="pp"/>
                  </equal>
                </not>
              </and>
            </test>
            <out>
              <chunk name="be_not" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <clip pos="3" side="tl" part="temps"/>
                  <clip pos="3" side="tl" part="persnbr"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="aux_not_vblex" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="2" side="tl" part="temps"/></tag><!--en aquesta regla només posem el temps, per a tractar formes compostes separades en el t2x ('ez dutela galdeketa eman') -->
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <clip pos="3" side="tl" part="temps"/>
                  <clip pos="3" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="f_bcond">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="objdat_pron">
         <with-param pos="2"/>
        </call-macro>
      </action>
    </rule>
    

    <rule comment="REGLA: EZ + VERBO SINT + PFUT (ez dira pasako)">
      <pattern>
        <pattern-item n="ez"/>
        <pattern-item n="vbsint_aux"/>
        <pattern-item n="lexpfut"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><!--porque los proclíticos dentro de la macro verbal_flex se envían con caseFirstWord-->
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <let>
          <clip pos="1" side="tl" part="lem"/>
          <lit v="not"/>
        </let>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="pri"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="temps"/>
              <lit-tag v="fti"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="pii"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="temps"/>
              <lit-tag v="cni"/>
            </let>
          </when>
        </choose>
        <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="swap_temps">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="do_flex">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="3" side="tl" part="lem"/>
                  <lit v="be"/>
                </equal>
                <equal>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <lit-tag v="vbser"/>
                </equal>
                <equal>
                  <var n="aux_verb"/>
                  <lit v=""/>
                </equal>
                <not>
                  <equal>
                    <clip pos="3" side="tl" part="temps"/>
                    <lit-tag v="pp"/>
                  </equal>
                </not>
              </and>
            </test>
            <out>
              <chunk name="be_not" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <clip pos="3" side="tl" part="temps"/>
                  <clip pos="3" side="tl" part="persnbr"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="aux_not_vblex" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="2" side="tl" part="temps"/></tag><!--en aquesta regla només posem el temps, per a tractar formes compostes separades en el t2x ('ez dutela galdeketa eman') -->
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <clip pos="3" side="tl" part="temps"/>
                  <clip pos="3" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="f_bcond">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="objdat_pron">
         <with-param pos="2"/>
        </call-macro>
      </action>
    </rule>

    <!--negación de verbos con partícula subordinante -(e)la intercalada (ez zietela eman) -->

    <rule comment="REGLA: EZ + VERBO SINT + (e)la + PP (ez duela ikusi)">
      <pattern>
        <pattern-item n="ez"/>
        <pattern-item n="vbsint_aux"/>
        <pattern-item n="cnjsub"/>
        <pattern-item n="lexpp"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="4"/>
          <with-param pos="2"/>
        </call-macro>
        <let>
          <clip pos="2" side="tl" part="lem"/>
          <lit v="have"/>
        </let>
        <let>
          <clip pos="2" side="tl" part="a_verb"/>
          <lit-tag v="vbhaver"/>
        </let>
       <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
	      <or>
                <equal>
                  <clip pos="2" side="tl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="2" side="tl" part="temps"/>
                  <lit-tag v="pres"/>
                </equal>
              </or>
            </test>
            <call-macro n="sep_pron">
              <with-param pos="2"/>
            </call-macro>
            <out>
              <chunk name="have_not_pp">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="2" side="tl" part="temps"/></tag>
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_verb"/>
                  <clip pos="2" side="tl" part="temps"/>
                  <clip pos="2" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
		<lu>
		<lit v="not"/>
		<clip pos="1" side="tl" part="a_adv"/>
		</lu>
		<b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_verb"/>
                  <clip pos="4" side="tl" part="temps"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <call-macro n="swap_temps">
              <with-param pos="4"/>
              <with-param pos="2"/>
            </call-macro>
            <call-macro n="sep_pron">
              <with-param pos="4"/>
            </call-macro>
            <out>
              <chunk name="vbconj">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="4" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="4" side="tl" part="temps"/></tag>
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_verb"/>
                  <clip pos="4" side="tl" part="temps"/>
                  <clip pos="4" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
            <call-macro n="f_bcond">
              <with-param pos="3"/>
              <with-param pos="4"/>
            </call-macro>
          </otherwise>
        </choose>
        <call-macro n="objdat_pron">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="que">
            <tags>
              <tag><clip pos="3" side="tl" part="tags"/></tag>
            </tags>
            <!--  <lu>
                 <clip pos="3" side="tl" part="whole"/>
                 </lu> -->
            <lu>
              <lit v=","/>
              <lit-tag v="cm"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: EZ + VERBO SINT + (e)la + GER (ez naizela etortzen)">
      <pattern>
        <pattern-item n="ez"/>
        <pattern-item n="vbsint_aux"/>
        <pattern-item n="cnjsub"/>
        <pattern-item n="lexger"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><!--porque los proclíticos dentro de la macro verbal_flex se envían con caseFirstWord-->
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <let>
          <clip pos="1" side="tl" part="lem"/>
          <lit v="not"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="swap_temps">
          <with-param pos="4"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="do_flex">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="4"/>
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="4" side="tl" part="lem"/>
                  <lit v="be"/>
                </equal>
                <equal>
                  <clip pos="4" side="tl" part="a_verb"/>
                  <lit-tag v="vbser"/>
                </equal>
                <equal>
                  <var n="aux_verb"/>
                  <lit v=""/>
                </equal>
                <not>
                  <equal>
                    <clip pos="4" side="tl" part="temps"/>
                    <lit-tag v="pp"/>
                  </equal>
                </not>
              </and>
            </test>
            <out>
              <chunk name="be_not" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_verb"/>
                  <clip pos="4" side="tl" part="temps"/>
                  <clip pos="4" side="tl" part="persnbr"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="aux_not_vblex" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="2" side="tl" part="temps"/></tag><!--en aquesta regla només posem el temps, per a tractar formes compostes separades en el t2x ('ez dutela galdeketa eman') -->
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_verb"/>
                  <clip pos="4" side="tl" part="temps"/>
                  <clip pos="4" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="f_bcond">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="objdat_pron">
         <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="que">
            <tags>
              <tag><clip pos="3" side="tl" part="tags"/></tag>
            </tags>
            <!--  <lu>
                 <clip pos="3" side="tl" part="whole"/>
                 </lu> -->
            <lu>
              <lit v=","/>
              <lit-tag v="cm"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    

    <rule comment="REGLA: EZ + VERBO SINT + (e)la + PFUT (ez direla pasako)">
      <pattern>
        <pattern-item n="ez"/>
        <pattern-item n="vbsint_aux"/>
        <pattern-item n="cnjsub"/>
        <pattern-item n="lexpfut"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><!--porque los proclíticos dentro de la macro verbal_flex se envían con caseFirstWord-->
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <let>
          <clip pos="1" side="tl" part="lem"/>
          <lit v="not"/>
        </let>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="pri"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="temps"/>
              <lit-tag v="fti"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="pii"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="temps"/>
              <lit-tag v="cni"/>
            </let>
          </when>
        </choose>
        <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="swap_temps">
          <with-param pos="4"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="do_flex">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="4"/>
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="4" side="tl" part="lem"/>
                  <lit v="be"/>
                </equal>
                <equal>
                  <clip pos="4" side="tl" part="a_verb"/>
                  <lit-tag v="vbser"/>
                </equal>
                <equal>
                  <var n="aux_verb"/>
                  <lit v=""/>
                </equal>
                <not>
                  <equal>
                    <clip pos="4" side="tl" part="temps"/>
                    <lit-tag v="pp"/>
                  </equal>
                </not>
              </and>
            </test>
            <out>
              <chunk name="be_not" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_verb"/>
                  <clip pos="4" side="tl" part="temps"/>
                  <clip pos="4" side="tl" part="persnbr"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="aux_not_vblex" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="2" side="tl" part="temps"/></tag><!--en aquesta regla només posem el temps, per a tractar formes compostes separades en el t2x ('ez dutela galdeketa eman') -->
                  <tag><clip pos="2" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="2" side="sl" part="nor"/></tag>
                  <tag><clip pos="2" side="sl" part="nori"/></tag>
                  <tag><clip pos="2" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_verb"/>
                  <clip pos="4" side="tl" part="temps"/>
                  <clip pos="4" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="f_bcond">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="objdat_pron">
         <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="que">
            <tags>
              <tag><clip pos="3" side="tl" part="tags"/></tag>
            </tags>
            <!--  <lu>
                 <clip pos="3" side="tl" part="whole"/>
                 </lu> -->
            <lu>
              <lit v=","/>
              <lit-tag v="cm"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

 
<!--negacions en un altre ordre: es pot dir tant 'ez genuen hartu' com 'hartu ez genuen' (crec) -->


    <rule comment="REGLA: PP + ez + VERBO SINT (jaso ez dute - I have not seen)">
      <pattern>
        <pattern-item n="lexpp"/>
        <pattern-item n="ez"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="verbal_flex">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <let>
          <clip pos="2" side="tl" part="lem"/>
          <lit v="not"/>
        </let>
        <choose>
          <when>
            <test>
              <or>
                <equal>
                  <clip pos="3" side="tl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="3" side="tl" part="temps"/>
                  <lit-tag v="pres"/>
                </equal>
              </or>
            </test>
            <let>
              <clip pos="3" side="tl" part="lem"/>
               <lit v="have"/>
            </let>
            <let>
              <clip pos="3" side="tl" part="a_verb"/>
               <lit-tag v="vbhaver"/>
            </let>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="3" side="tl" part="persnbr"/>
                    <lit-tag v="p1.sg"/>
                  </equal>
                </test>
                <let>
                  <clip pos="3" side="tl" part="persnbr"/>
                   <lit v=""/>
                </let>
                <let>
                  <clip pos="3" side="tl" part="temps"/>
                   <lit-tag v="pres"/>
                </let>
              </when>
            </choose>
            <out>
              <chunk name="have_not_pp" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="3" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="3" side="sl" part="nor"/></tag>
                  <tag><clip pos="3" side="sl" part="nori"/></tag>
                  <tag><clip pos="3" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <clip pos="3" side="tl" part="temps"/>
                  <clip pos="3" side="tl" part="persnbr"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <call-macro n="swap_temps">
              <with-param pos="1"/>
              <with-param pos="3"/>
            </call-macro>
            <call-macro n="do_flex">
              <with-param pos="1"/>
            </call-macro>
            <out>
              <chunk name="aux_not_vbconj" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="3" side="sl" part="nor"/></tag>
                  <tag><clip pos="3" side="sl" part="nori"/></tag>
                  <tag><clip pos="3" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <clip pos="1" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
            <call-macro n="f_bcond">
              <with-param pos="2"/>
              <with-param pos="3"/>
            </call-macro>
          </otherwise>
        </choose>
        <call-macro n="objdat_pron">
         <with-param pos="3"/>
        </call-macro>
      </action>
    </rule>



    <rule comment="REGLA: GER + EZ + VERBO SINT (etortzen ez naiz)">
      <pattern>
        <pattern-item n="lexger"/>
        <pattern-item n="ez"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><!--porque los proclíticos dentro de la macro verbal_flex se envían con caseFirstWord-->
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <let>
          <clip pos="2" side="tl" part="lem"/>
          <lit v="not"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="swap_temps">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="do_flex">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="tl" part="lem"/>
                  <lit v="be"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <lit-tag v="vbser"/>
                </equal>
                <equal>
                  <var n="aux_verb"/>
                  <lit v=""/>
                </equal>
                <not>
                  <equal>
                    <clip pos="1" side="tl" part="temps"/>
                    <lit-tag v="pp"/>
                  </equal>
                </not>
              </and>
            </test>
            <out>
              <chunk name="be_not" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="3" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="3" side="sl" part="nor"/></tag>
                  <tag><clip pos="3" side="sl" part="nori"/></tag>
                  <tag><clip pos="3" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <clip pos="1" side="tl" part="persnbr"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="aux_not_vblex" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="3" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="temps"/></tag><!--en aquesta regla només posem el temps, per a tractar formes compostes separades en el t2x ('ez dutela galdeketa eman') -->
                  <tag><clip pos="3" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="3" side="sl" part="nor"/></tag>
                  <tag><clip pos="3" side="sl" part="nori"/></tag>
                  <tag><clip pos="3" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <clip pos="1" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="f_bcond">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="objdat_pron">
         <with-param pos="3"/>
        </call-macro>
      </action>
    </rule>

    

    <rule comment="REGLA: PFUT + EZ + VERBO SINT ( pasako ez dira)">
      <pattern>
        <pattern-item n="lexpfut"/>
        <pattern-item n="ez"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="temps"/>
                <lit-tag v="pri"/>
              </equal>
            </test>
            <let>
              <clip pos="3" side="tl" part="temps"/>
              <lit-tag v="fti"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="temps"/>
                <lit-tag v="pii"/>
              </equal>
            </test>
            <let>
              <clip pos="3" side="tl" part="temps"/>
              <lit-tag v="cni"/>
            </let>
          </when>
        </choose>
        <call-macro n="verbal_flex">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <let>
          <clip pos="2" side="tl" part="lem"/>
          <lit v="not"/>
        </let>
        <choose>
          <when>
            <test>
              <or>
                <equal>
                  <clip pos="3" side="tl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="3" side="tl" part="temps"/>
                  <lit-tag v="pres"/>
                </equal>
              </or>
            </test>
            <let>
              <clip pos="3" side="tl" part="lem"/>
               <lit v="have"/>
            </let>
            <let>
              <clip pos="3" side="tl" part="a_verb"/>
               <lit-tag v="vbhaver"/>
            </let>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="3" side="tl" part="persnbr"/>
                    <lit-tag v="p1.sg"/>
                  </equal>
                </test>
                <let>
                  <clip pos="3" side="tl" part="persnbr"/>
                   <lit v=""/>
                </let>
                <let>
                  <clip pos="3" side="tl" part="temps"/>
                   <lit-tag v="pres"/>
                </let>
              </when>
            </choose>
            <out>
              <chunk name="have_not_pp" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="3" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="3" side="sl" part="nor"/></tag>
                  <tag><clip pos="3" side="sl" part="nori"/></tag>
                  <tag><clip pos="3" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <clip pos="3" side="tl" part="temps"/>
                  <clip pos="3" side="tl" part="persnbr"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <call-macro n="swap_temps">
              <with-param pos="1"/>
              <with-param pos="3"/>
            </call-macro>
            <call-macro n="do_flex">
              <with-param pos="1"/>
            </call-macro>
            <out>
              <chunk name="aux_not_vbconj" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="3" side="sl" part="nor"/></tag>
                  <tag><clip pos="3" side="sl" part="nori"/></tag>
                  <tag><clip pos="3" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <clip pos="1" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
            <call-macro n="f_bcond">
              <with-param pos="2"/>
              <with-param pos="3"/>
            </call-macro>
          </otherwise>
        </choose>
        <call-macro n="objdat_pron">
         <with-param pos="3"/>
        </call-macro>
      </action>
    </rule>


<!--negacions amb -lako -->


    <rule comment="REGLA: PP + EZ +  VERBO SINT + lako ( jaso ez dutelako)">
      <pattern>
        <pattern-item n="lexpp"/>
        <pattern-item n="ez"/>
        <pattern-item n="vbsint_aux"/>
        <pattern-item n="lako"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="cnjadv" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="cnjadv"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="whole"/>
            </lu> 
          </chunk>
          <b pos="1"/>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <var n="caseSecondWord"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <let>
          <clip pos="2" side="tl" part="lem"/>
          <lit v="not"/>
        </let>
        <choose>
          <when>
            <test>
              <or>
                <equal>
                  <clip pos="3" side="tl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="3" side="tl" part="temps"/>
                  <lit-tag v="pres"/>
                </equal>
              </or>
            </test>
            <let>
              <clip pos="3" side="tl" part="lem"/>
               <lit v="have"/>
            </let>
            <let>
              <clip pos="3" side="tl" part="a_verb"/>
               <lit-tag v="vbhaver"/>
            </let>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="3" side="tl" part="persnbr"/>
                    <lit-tag v="p1.sg"/>
                  </equal>
                </test>
                <let>
                  <clip pos="3" side="tl" part="persnbr"/>
                   <lit v=""/>
                </let>
                <let>
                  <clip pos="3" side="tl" part="temps"/>
                   <lit-tag v="pres"/>
                </let>
              </when>
            </choose>
            <out>
              <chunk name="have_not_pp" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="3" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="3" side="sl" part="nor"/></tag>
                  <tag><clip pos="3" side="sl" part="nori"/></tag>
                  <tag><clip pos="3" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <clip pos="3" side="tl" part="temps"/>
                  <clip pos="3" side="tl" part="persnbr"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <call-macro n="swap_temps">
              <with-param pos="1"/>
              <with-param pos="3"/>
            </call-macro>
            <call-macro n="do_flex">
              <with-param pos="1"/>
            </call-macro>
            <out>
              <chunk name="aux_not_vbconj" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="3" side="sl" part="nor"/></tag>
                  <tag><clip pos="3" side="sl" part="nori"/></tag>
                  <tag><clip pos="3" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <clip pos="1" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
            <call-macro n="f_bcond">
              <with-param pos="3"/>
              <with-param pos="4"/>
            </call-macro>
          </otherwise>
        </choose>
        <call-macro n="objdat_pron">
         <with-param pos="3"/>
        </call-macro>
      </action>
    </rule>



    <rule comment="REGLA: GER + EZ + VERBO SINT + lako (etortzen ez naizelako)">
      <pattern>
        <pattern-item n="lexger"/>
        <pattern-item n="ez"/>
        <pattern-item n="vbsint_aux"/>
        <pattern-item n="lako"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><!--porque los proclíticos dentro de la macro verbal_flex se envían con caseFirstWord-->
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <let>
          <clip pos="2" side="tl" part="lem"/>
          <lit v="not"/>
        </let>
        <out>
          <chunk name="cnjadv" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="cnjadv"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="whole"/>
            </lu> 
          </chunk>
          <b pos="1"/>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <var n="caseSecondWord"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="swap_temps">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="do_flex">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="tl" part="lem"/>
                  <lit v="be"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <lit-tag v="vbser"/>
                </equal>
                <equal>
                  <var n="aux_verb"/>
                  <lit v=""/>
                </equal>
                <not>
                  <equal>
                    <clip pos="1" side="tl" part="temps"/>
                    <lit-tag v="pp"/>
                  </equal>
                </not>
              </and>
            </test>
            <out>
              <chunk name="be_not" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="3" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="3" side="sl" part="nor"/></tag>
                  <tag><clip pos="3" side="sl" part="nori"/></tag>
                  <tag><clip pos="3" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <clip pos="1" side="tl" part="persnbr"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="aux_not_vblex" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="3" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="temps"/></tag><!--en aquesta regla només posem el temps, per a tractar formes compostes separades en el t2x ('ez dutela galdeketa eman') -->
                  <tag><clip pos="3" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="3" side="sl" part="nor"/></tag>
                  <tag><clip pos="3" side="sl" part="nori"/></tag>
                  <tag><clip pos="3" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <clip pos="1" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="f_bcond">
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="objdat_pron">
         <with-param pos="3"/>
        </call-macro>
      </action>
    </rule>

    

    <rule comment="REGLA: PFUT + EZ + VERBO SINT + lako ( pasako ez direlako)">
      <pattern>
        <pattern-item n="lexpfut"/>
        <pattern-item n="ez"/>
        <pattern-item n="vbsint_aux"/>
        <pattern-item n="lako"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="temps"/>
                <lit-tag v="pri"/>
              </equal>
            </test>
            <let>
              <clip pos="3" side="tl" part="temps"/>
              <lit-tag v="fti"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="temps"/>
                <lit-tag v="pii"/>
              </equal>
            </test>
            <let>
              <clip pos="3" side="tl" part="temps"/>
              <lit-tag v="cni"/>
            </let>
          </when>
        </choose>
        <out>
          <chunk name="cnjadv" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="cnjadv"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="whole"/>
            </lu> 
          </chunk>
          <b pos="1"/>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <var n="caseSecondWord"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <let>
          <clip pos="2" side="tl" part="lem"/>
          <lit v="not"/>
        </let>
        <choose>
          <when>
            <test>
              <or>
                <equal>
                  <clip pos="3" side="tl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="3" side="tl" part="temps"/>
                  <lit-tag v="pres"/>
                </equal>
              </or>
            </test>
            <let>
              <clip pos="3" side="tl" part="lem"/>
               <lit v="have"/>
            </let>
            <let>
              <clip pos="3" side="tl" part="a_verb"/>
               <lit-tag v="vbhaver"/>
            </let>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="3" side="tl" part="persnbr"/>
                    <lit-tag v="p1.sg"/>
                  </equal>
                </test>
                <let>
                  <clip pos="3" side="tl" part="persnbr"/>
                   <lit v=""/>
                </let>
                <let>
                  <clip pos="3" side="tl" part="temps"/>
                   <lit-tag v="pres"/>
                </let>
              </when>
            </choose>
            <out>
              <chunk name="have_not_pp" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="3" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="3" side="sl" part="nor"/></tag>
                  <tag><clip pos="3" side="sl" part="nori"/></tag>
                  <tag><clip pos="3" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <clip pos="3" side="tl" part="temps"/>
                  <clip pos="3" side="tl" part="persnbr"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <call-macro n="swap_temps">
              <with-param pos="1"/>
              <with-param pos="3"/>
            </call-macro>
            <call-macro n="do_flex">
              <with-param pos="1"/>
            </call-macro>
            <out>
              <chunk name="aux_not_vbconj" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="3" side="sl" part="nor"/></tag>
                  <tag><clip pos="3" side="sl" part="nori"/></tag>
                  <tag><clip pos="3" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <clip pos="1" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
            <call-macro n="f_bcond">
              <with-param pos="3"/>
              <with-param pos="4"/>
            </call-macro>
          </otherwise>
        </choose>
        <call-macro n="objdat_pron">
         <with-param pos="3"/>
        </call-macro>
      </action>
    </rule>


    <!--
        MG: no sé com es fa el negatiu de 'prestatzen ari garelako: falta fer la forma negativa canviant la regla següent


< rule comment="REGLA: GER + ARI IZAN (prestatzen ari gara - estamos preparando) + lako">
<pattern>
<pattern-item n="ger"/>
<pattern-item n="ari_izan"/>
<pattern-item n="lako"/>
</pattern>
<action>
<call-macro n="firstWord">
<with-param pos="1"/>
</call-macro>
<out>
<chunk name="cnjadv" case="caseFirstWord">
<tags>
<tag><lit-tag v="cnjadv"/></tag>
</tags>
<lu>
<clip pos="3" side="tl" part="whole"/>
</lu>
</chunk>
</out>
<let>
<var n="caseFirstWord"/>
<lit v="aa"/>
</let>
<call-macro n="verbal_flex">
<with-param pos="2"/>
</call-macro>
<out> 
<chunk name="estar_ger">
<tags>
<tag><lit-tag v="SV"/></tag>
<tag><clip pos="1" side="tl" part="a_verb"/></tag>
<tag><clip pos="2" side="tl" part="persnbr"/></tag>
<tag><clip pos="2" side="sl" part="nor"/></tag>
<tag><clip pos="2" side="sl" part="nori"/></tag>
<tag><clip pos="2" side="sl" part="nork"/></tag>
</tags>
<b/>
<lu>
<clip pos="2" side="tl" part="lemh"/>
<clip pos="2" side="tl" part="a_verb"/>
<clip pos="2" side="tl" part="temps"/>
<clip pos="2" side="tl" part="persnbr"/>
<clip pos="2" side="tl" part="lemq"/>
</lu>
<b pos="1"/>
<lu>
<clip pos="1" side="tl" part="lemh"/>
<clip pos="1" side="tl" part="a_verb"/>
<clip pos="1" side="tl" part="temps"/>
<clip pos="1" side="tl" part="lemq"/>
</lu>
</chunk>
</out>
</action>
</rule>
    -->

    <!-- formas de condicional - baldintza-->



    <rule comment="REGLA: BA-+VERBO SINTÉTICO (badut, banabil)">
      <pattern>
        <pattern-item n="ba"/>
        <pattern-item n="vbsint"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="hs"/>
              </equal>
            </test>
            <let>
                <clip pos="2" side="tl" part="temps"/>
                <lit-tag v="pis"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="bald"/>
              </equal>
            </test>
            <let>
                <clip pos="2" side="tl" part="temps"/>
                <lit-tag v="pis"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="prs2"/>
              </equal>
            </test>
            <let>
                <clip pos="2" side="tl" part="temps"/>
                <lit-tag v="prs"/>
            </let>
          </when>
        </choose>
        <out>
          <chunk name="si" case="caseFirstWord">
            <tags>
              <tag><clip pos="1" side="tl" part="tags"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
          <b/>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="vbconj">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><clip pos="2" side="tl" part="persnbr"/></tag>
              <tag><clip pos="2" side="sl" part="nor"/></tag>
              <tag><clip pos="2" side="sl" part="nori"/></tag>
              <tag><clip pos="2" side="sl" part="nork"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="persnbr"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


  <rule comment="REGLA: BA-+VERBO SINTÉTICO (ez badut)">
      <pattern>
        <pattern-item n="ez"/>
        <pattern-item n="ba"/>
        <pattern-item n="vbsint"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="temps"/>
                <lit-tag v="hs"/>
              </equal>
            </test>
            <let>
                <clip pos="3" side="tl" part="temps"/>
                <lit-tag v="past"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="temps"/>
                <lit-tag v="bald"/>
              </equal>
            </test>
            <let>
                <clip pos="3" side="tl" part="temps"/>
                <lit-tag v="pis"/>
            </let>
          </when>
        </choose>
        <out>
          <chunk name="si" case="caseFirstWord">
            <tags>
              <tag><clip pos="2" side="tl" part="tags"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
          </chunk>
          <b/>
          <chunk name="ez">
            <tags>
              <tag><lit-tag v="SADV"/></tag>
              <tag><clip pos="1" side="tl" part="a_adv"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
          <b pos="1"/>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <chunk name="vbconj">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="3" side="tl" part="a_verb"/></tag>
              <tag><clip pos="3" side="tl" part="persnbr"/></tag>
              <tag><clip pos="3" side="sl" part="nor"/></tag>
              <tag><clip pos="3" side="sl" part="nori"/></tag>
              <tag><clip pos="3" side="sl" part="nork"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_verb"/>
              <clip pos="3" side="tl" part="temps"/>
              <clip pos="3" side="tl" part="persnbr"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: PP + BA-+ VERBO SINT (ikusi badut) (repassar aquesta i les altres formes de condicional)">
      <pattern>
        <pattern-item n="pp"/>
        <pattern-item n="ba"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="temps"/>
                <lit-tag v="hs"/>
              </equal>
            </test>
            <let>
                <clip pos="3" side="tl" part="temps"/>
                <lit-tag v="pis"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="temps"/>
                <lit-tag v="prs2"/>
              </equal>
            </test>
            <let>
                <clip pos="3" side="tl" part="temps"/>
                <lit-tag v="pri"/><!--erantsi badiezaiegu - hemos agregado -->
            </let>
          </when>
        </choose>
        <let>
          <clip pos="3" side="tl" part="lem"/>
          <lit v="have"/>
        </let>
        <let>
          <clip pos="3" side="tl" part="a_verb"/>
          <lit-tag v="vbhaver"/>
        </let>
        <out>
          <chunk name="si" case="caseFirstWord">
            <tags>
              <tag><clip pos="2" side="tl" part="tags"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
          </chunk>
          <b/>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <or>
                <equal>
                  <clip pos="3" side="tl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="3" side="tl" part="temps"/>
                  <lit-tag v="pres"/>
                </equal>
              </or>
            </test>
            <out>
              <chunk name="vbconj_pp" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="3" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="3" side="sl" part="nor"/></tag>
                  <tag><clip pos="3" side="sl" part="nori"/></tag>
                  <tag><clip pos="3" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <clip pos="3" side="tl" part="temps"/>
                  <clip pos="3" side="tl" part="persnbr"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <call-macro n="swap_temps">
              <with-param pos="1"/>
              <with-param pos="3"/>
            </call-macro>
            <out>
              <chunk name="vbconj" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="3" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="3" side="sl" part="nor"/></tag>
                  <tag><clip pos="3" side="sl" part="nori"/></tag>
                  <tag><clip pos="3" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <clip pos="1" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
            <call-macro n="f_bcond">
              <with-param pos="1"/>
              <with-param pos="2"/>
            </call-macro>
          </otherwise>
        </choose>
      </action>
    </rule>
    <rule comment="REGLA: PP + NAHI + BA-+ VERBO SINT (ikusi badut) (repassar aquesta i les altres formes de condicional)">
      <pattern>
        <pattern-item n="pp"/>
        <pattern-item n="nahi"/>
        <pattern-item n="ba"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="sl" part="temps"/>
                <lit-tag v="hs"/>
              </equal>
            </test>
            <let>
                <clip pos="4" side="tl" part="temps"/>
                <lit-tag v="past"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="4" side="sl" part="temps"/>
                <lit-tag v="prs2"/>
              </equal>
            </test>
            <let>
                <clip pos="4" side="tl" part="temps"/>
                <lit-tag v="pri"/><!--erantsi badiezaiegu - hemos agregado -->
            </let>
          </when>
        </choose>
        <let>
          <clip pos="4" side="tl" part="lem"/>
          <lit v="have"/>
        </let>
        <let>
          <clip pos="4" side="tl" part="a_verb"/>
          <lit-tag v="vbhaver"/>
        </let>
        <out>
          <chunk name="si" case="caseFirstWord">
            <tags>
              <tag><clip pos="3" side="tl" part="tags"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="whole"/>
            </lu>
          </chunk>
          <b/>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <or>
                <equal>
                  <clip pos="4" side="tl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="4" side="tl" part="temps"/>
                  <lit-tag v="pres"/>
                </equal>
              </or>
            </test>
            <out>
              <chunk name="have_wanted_to_inf" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="4" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="4" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="4" side="sl" part="nor"/></tag>
                  <tag><clip pos="4" side="sl" part="nori"/></tag>
                  <tag><clip pos="4" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_verb"/>
                  <clip pos="4" side="tl" part="temps"/>
                  <clip pos="4" side="tl" part="persnbr"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <lit v="want"/>
                  <lit-tag v="vblex.pp"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <lit v="to"/>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <lit-tag v="inf"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="want_to_inf" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="4" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="4" side="sl" part="nor"/></tag>
                  <tag><clip pos="4" side="sl" part="nori"/></tag>
                  <tag><clip pos="4" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <lit v="want"/>
                  <lit-tag v="vblex"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <clip pos="4" side="tl" part="persnbr"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <lit v="to"/>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <lit-tag v="inf"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="objdat_pron">
          <with-param pos="1"/>
        </call-macro>
      </action>
    </rule>


  <rule comment="REGLA: PP + ez + BA-+ VERBO SINT (ikusi ez badut) ">
      <pattern>
        <pattern-item n="pp"/>
        <pattern-item n="ez"/>
        <pattern-item n="ba"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="sl" part="temps"/>
                <lit-tag v="hs"/>
              </equal>
            </test>
            <let>
                <clip pos="4" side="tl" part="temps"/>
                <lit-tag v="pis"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="4" side="sl" part="temps"/>
                <lit-tag v="prs2"/>
              </equal>
            </test>
            <let>
                <clip pos="4" side="tl" part="temps"/>
                <lit-tag v="pri"/><!--erantsi badiezaiegu - hemos agregado -->
            </let>
          </when>
        </choose>
        <let>
          <clip pos="4" side="tl" part="lem"/>
          <lit v="have"/>
        </let>
        <let>
          <clip pos="4" side="tl" part="a_verb"/>
          <lit-tag v="vbhaver"/>
        </let>
        <let>
          <clip pos="2" side="tl" part="lem"/>
          <lit v="not"/>
        </let>
        <out>
          <chunk name="si" case="caseFirstWord">
            <tags>
              <tag><clip pos="3" side="tl" part="tags"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="whole"/>
            </lu>
          </chunk>
          <b pos="1"/>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <not>
                <equal>
                  <var n="aux_verb"/>
                  <lit v=""/>
                </equal>
              </not>
            </test>
            <out>
              <chunk name="aux_not_have_pp" case="caseSecondWord">
              <tags>
                <tag><lit-tag v="SV"/></tag>
                <tag><clip pos="4" side="tl" part="a_verb"/></tag>
                <tag><clip pos="4" side="tl" part="persnbr"/></tag>
                <tag><clip pos="4" side="sl" part="nor"/></tag>
                <tag><clip pos="4" side="sl" part="nori"/></tag>
                <tag><clip pos="4" side="sl" part="nork"/></tag>
              </tags>
              <var n="aux_verb"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
                <clip pos="4" side="tl" part="a_verb"/>
                <clip pos="4" side="tl" part="temps"/>
                <clip pos="4" side="tl" part="persnbr"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
              <b pos="3"/>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <var n="prn_enc"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="have_not_pp" case="caseSecondWord">
              <tags>
                <tag><lit-tag v="SV"/></tag>
                <tag><clip pos="4" side="tl" part="a_verb"/></tag>
                <tag><clip pos="4" side="tl" part="persnbr"/></tag>
                <tag><clip pos="4" side="sl" part="nor"/></tag>
                <tag><clip pos="4" side="sl" part="nori"/></tag>
                <tag><clip pos="4" side="sl" part="nork"/></tag>
              </tags>
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
                <clip pos="4" side="tl" part="a_verb"/>
                <clip pos="4" side="tl" part="temps"/>
                <clip pos="4" side="tl" part="persnbr"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
              <b pos="3"/>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <var n="prn_enc"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      <call-macro n="objdat_pron">
        <with-param pos="1"/>
      </call-macro>
    </action>
  </rule>

    <rule comment="REGLA: GER + BA-+VERBO SINT (etortzen banaiz)">
      <pattern>
        <pattern-item n="ger"/>
        <pattern-item n="ba"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="hs"/>
              </equal>
            </test>
            <let>
                <clip pos="2" side="tl" part="temps"/>
                <lit-tag v="pis"/>
            </let>
          </when>
        </choose>
        <out>
          <chunk name="si" case="caseFirstWord">
            <tags>
              <tag><clip pos="2" side="tl" part="tags"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
          </chunk>
          <b pos="1"/>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="swap_temps">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="vbconj" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="3" side="tl" part="persnbr"/></tag>
              <tag><clip pos="3" side="sl" part="nor"/></tag>
              <tag><clip pos="3" side="sl" part="nori"/></tag>
              <tag><clip pos="3" side="sl" part="nork"/></tag>
            </tags>
            <var n="aux_verb"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="persnbr"/>
              <var n="prn_enc"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="objdat_pron">
          <with-param pos="1"/>
        </call-macro>
      </action>
    </rule>




    <rule comment="REGLA: GER + BA-+VERBO SINT (etortzen ez banaiz)">
      <pattern>
        <pattern-item n="ger"/>
        <pattern-item n="ez"/>
        <pattern-item n="ba"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="ser_tener">
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <let>
          <clip pos="2" side="tl" part="lem"/>
          <lit v="not"/>
        </let>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="hs"/>
              </equal>
            </test>
            <let>
                <clip pos="2" side="tl" part="temps"/>
                <lit-tag v="pis"/>
            </let>
          </when>
        </choose>
        <out>
          <chunk name="si" case="caseFirstWord">
            <tags>
              <tag><clip pos="3" side="tl" part="tags"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="whole"/>
            </lu>
          </chunk>
          <b pos="1"/>
          <chunk name="ez">
            <tags>
              <tag><lit-tag v="SADV"/></tag>
              <tag><clip pos="2" side="tl" part="a_adv"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
          </chunk>
          <b pos="2"/>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="sl" part="temps"/>
                <lit-tag v="pri"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="pri"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="4" side="sl" part="temps"/>
                <lit-tag v="pii"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="pii"/>
            </let>
          </when>
        </choose>
        <call-macro n="verbal_flex">
          <with-param pos="4"/>
        </call-macro>
        <out>
          <chunk name="vbconj" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="4" side="tl" part="persnbr"/></tag>
              <tag><clip pos="4" side="sl" part="nor"/></tag>
              <tag><clip pos="4" side="sl" part="nori"/></tag>
              <tag><clip pos="4" side="sl" part="nork"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="4" side="tl" part="persnbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


<!-- baldintza-->
    

    <rule comment="REGLA: PFUT + ba-VERBO SINT(baldintza) (egingo balu) - si hiciera ">
      <pattern>
        <pattern-item n="pfut"/>
        <pattern-item n="ba"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="si" case="caseFirstWord">
            <tags>
              <tag><clip pos="2" side="tl" part="tags"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
          </chunk>
          <b pos="1"/>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="temps"/>
                <lit-tag v="bald"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="pis"/>
            </let>
          </when>
         <!-- <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="pri"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="fti"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="pii"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="cni"/>
            </let>
          </when> -->
        </choose>
        <out>
          <chunk name="vbconj" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="3" side="tl" part="persnbr"/></tag>
              <tag><clip pos="3" side="sl" part="nor"/></tag>
              <tag><clip pos="3" side="sl" part="nori"/></tag>
              <tag><clip pos="3" side="sl" part="nork"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="3" side="tl" part="persnbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


 <rule comment="REGLA: PFUT + ez + ba-VERBO SINT(baldintza) (egingo ez balu) - if it did not do">
      <pattern>
        <pattern-item n="pfut"/>
        <pattern-item n="ez"/>
        <pattern-item n="ba"/>
        <pattern-item n="vbsint_aux"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="si" case="caseFirstWord">
            <tags>
              <tag><clip pos="3" side="tl" part="tags"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="whole"/>
            </lu>
          </chunk>
          <b pos="1"/>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="4" side="sl" part="temps"/>
                <lit-tag v="bald"/>
              </equal>
            </test>
            <let>
              <clip pos="4" side="tl" part="temps"/>
              <lit-tag v="pis"/>
            </let>
          </when>
         <!-- <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="pri"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="fti"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="pii"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="cni"/>
            </let>
          </when> -->
        </choose>
        <let>
          <clip pos="2" side="tl" part="lem"/>
          <lit v="not"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="do_flex">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <and>
                  <equal>
                    <clip pos="2" side="tl" part="lem"/>
                    <lit v="be"/>
                  </equal>
                  <equal>
                    <clip pos="2" side="tl" part="a_verb"/>
                    <lit-tag v="vbser"/>
                  </equal>
                </and>
                <equal>
                  <var n="aux_verb"/>
                  <lit v=""/>
                </equal>
                <not>
                  <equal>
                    <clip pos="2" side="tl" part="temps"/>
                    <lit-tag v="pp"/>
                  </equal>
                </not>
              </and>
            </test>
            <out>
              <chunk name="be_not" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="4" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="4" side="sl" part="nor"/></tag>
                  <tag><clip pos="4" side="sl" part="nori"/></tag>
                  <tag><clip pos="4" side="sl" part="nork"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="4" side="tl" part="temps"/>
                  <clip pos="4" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="vbconj_not" case="caseSecondWord">
                <tags>
                  <tag><lit-tag v="SVneg"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="4" side="tl" part="persnbr"/></tag>
                  <tag><clip pos="4" side="sl" part="nor"/></tag>
                  <tag><clip pos="4" side="sl" part="nori"/></tag>
                  <tag><clip pos="4" side="sl" part="nork"/></tag>
                </tags>
                <var n="aux_verb"/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <clip pos="4" side="tl" part="temps"/>
                  <clip pos="4" side="tl" part="persnbr"/>
                  <var n="prn_enc"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="objdat_pron">
         <with-param pos="1"/>
       </call-macro>
     </action>
    </rule>


 <rule comment="REGLA: PFUT + ez + ba-VERBO SINT(baldintza) (ez balu egingo) - si no hiciera - La gramática dice que esta forma de negación no es la correcta, pero me la he encontrado en textos (p. ej. en el Berria)">
      <pattern>
        <pattern-item n="ez"/>
        <pattern-item n="ba"/>
        <pattern-item n="vbsint_aux"/>
        <pattern-item n="pfut"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="si" case="caseFirstWord">
            <tags>
              <tag><clip pos="2" side="tl" part="tags"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
          </chunk>
          <b pos="1"/>
          <chunk name="ez">
            <tags>
              <tag><lit-tag v="SADV"/></tag>
              <tag><clip pos="1" side="tl" part="a_adv"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
          <b pos="2"/>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="temps"/>
                <lit-tag v="bald"/>
              </equal>
            </test>
            <let>
              <clip pos="4" side="tl" part="temps"/>
              <lit-tag v="pis"/>
            </let>
          </when>
         <!-- <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="pri"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="fti"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="pii"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="temps"/>
              <lit-tag v="cni"/>
            </let>
          </when> -->
        </choose>
        <out>
          <chunk name="vbconj" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="4" side="tl" part="a_verb"/></tag>
              <tag><clip pos="3" side="tl" part="persnbr"/></tag>
              <tag><clip pos="3" side="sl" part="nor"/></tag>
              <tag><clip pos="3" side="sl" part="nori"/></tag>
              <tag><clip pos="3" side="sl" part="nork"/></tag>
            </tags>
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="a_verb"/>
              <clip pos="4" side="tl" part="temps"/>
              <clip pos="3" side="tl" part="persnbr"/>
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    

<!-- modo potencial -->

 <rule comment="REGLA: INF (forma lexemática) + VERBO SINT potencial (etor daiteke - he can come)">
      <pattern>
        <pattern-item n="inf"/>
        <pattern-item n="aux_potencial"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let>
          <clip pos="2" side="tl" part="lem"/>
          <lit v="can"/>
        </let>
        <let>
          <clip pos="2" side="tl" part="a_verb"/>
          <lit-tag v="vaux"/>
        </let>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="potpr"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="temps"/>
              <lit-tag v="pri"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="potps"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="temps"/>
              <lit-tag v="past"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="poth"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="temps"/>
              <lit-tag v="cni"/>
            </let>
          </when>
        </choose>
        <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="vbconj_inf" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><clip pos="2" side="tl" part="persnbr"/></tag>
              <tag><clip pos="2" side="sl" part="nor"/></tag>
              <tag><clip pos="2" side="sl" part="nori"/></tag>
              <tag><clip pos="2" side="sl" part="nork"/></tag>
            </tags>
            <var n="aux_verb"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="persnbr"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="persnbr"/>
              <var n="prn_enc"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="objdat_pron">
          <with-param pos="1"/>
        </call-macro>
      </action>
    </rule>

 

<!-- modo subjuntivo -->


 <rule comment="REGLA: INF (forma lexemática) + VERBO SINT subjuntivo (ikus dezagun - that we see)">
      <pattern>
        <pattern-item n="inf"/>
        <pattern-item n="aux_subjuntivo"/>
        <pattern-item n="quesubj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="temps"/>
                <lit-tag v="hs"/>
              </equal>
            </test>
            <let>
                <clip pos="2" side="tl" part="temps"/>
                <lit-tag v="pis"/>
            </let>
          </when>
        </choose>
        <out>
          <chunk name="que" case="caseFirstWord">
            <tags>
              <tag><clip pos="3" side="tl" part="tags"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="whole"/>
            </lu>
          </chunk>
          <b pos="1"/>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="subjunt" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><clip pos="2" side="tl" part="persnbr"/></tag>
              <tag><clip pos="2" side="sl" part="nor"/></tag>
              <tag><clip pos="2" side="sl" part="nori"/></tag>
              <tag><clip pos="2" side="sl" part="nork"/></tag>
            </tags>
            <var n="aux_verb"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="persnbr"/>
              <var n="prn_enc"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="objdat_pron">
          <with-param pos="1"/>
        </call-macro>
      </action>
    </rule>




 <rule comment="REGLA: INF (forma lexemática) + VERBO SINT subjuntivo (baledi - if he was)">
      <pattern>
        <pattern-item n="inf"/>
        <pattern-item n="ba"/>
        <pattern-item n="aux_subjuntivo"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="temps"/>
                <lit-tag v="hs"/>
              </equal>
            </test>
            <let>
                <clip pos="3" side="tl" part="temps"/>
                <lit-tag v="pis"/>
            </let>
          </when>
        </choose>
        <out>
          <chunk name="si" case="caseFirstWord">
            <tags>
              <tag><clip pos="2" side="tl" part="tags"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
          </chunk>
          <b pos="1"/>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
        <call-macro n="verbal_flex">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="subjunt" case="caseSecondWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="3" side="tl" part="temps"/></tag>
              <tag><clip pos="3" side="tl" part="persnbr"/></tag>
              <tag><clip pos="3" side="sl" part="nor"/></tag>
              <tag><clip pos="3" side="sl" part="nori"/></tag>
              <tag><clip pos="3" side="sl" part="nork"/></tag>
            </tags>
            <var n="aux_verb"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="3" side="tl" part="temps"/>
              <clip pos="3" side="tl" part="persnbr"/>
              <var n="prn_enc"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="objdat_pron">
          <with-param pos="1"/>
        </call-macro>
      </action>
    </rule> 


<rule comment="REGLA: INF (forma lexemática) + VERBO SINT imperativo (etor zaitezte - come)">
      <pattern>
        <pattern-item n="inf"/>
        <pattern-item n="aux_imperativo"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="tl" part="persnbr"/>
                <lit-tag v="p1.sg"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="temps"/>
              <lit-tag v="prs"/>
            </let>
          </when>
        </choose>
        <call-macro n="verbal_flex">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="sep_pron">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="vbconj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><clip pos="2" side="tl" part="temps"/></tag>
              <tag><clip pos="2" side="tl" part="persnbr"/></tag>
              <tag><clip pos="2" side="sl" part="nor"/></tag>
              <tag><clip pos="2" side="sl" part="nori"/></tag>
              <tag><clip pos="2" side="sl" part="nork"/></tag>
            </tags>
            <var n="aux_verb"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="persnbr"/>
              <var n="prn_enc"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="f_bcond">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="objdat_pron">
          <with-param pos="2"/>
        </call-macro>
      </action>
    </rule>


    <!--***************************** RELATIU  **********************************-->

 <rule comment="REGLA: REL (regla per al relatiu sol: els canvis d'ordre es fan en el t2x. ">
      <pattern>
        <pattern-item n="reladj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="querel" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="rel"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

 

    <!-- ********* *********************** -->

    <rule comment="REGLA: adv">
      <pattern>
        <pattern-item n="adv"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal caseless="yes">
                  <clip pos="1" side="sl" part="lem"/>
                  <lit v="ere"/>
                </equal>
                <equal>
                  <var n="ezta"/>
                  <lit v="yes"/>
                </equal>
              </and>
            </test>
            <let>
              <var n="ezta"/>
              <lit v="no"/>
            </let>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal caseless="yes">
                      <clip pos="1" side="sl" part="lem"/>
                      <lit v="ez"/>
                    </equal>
                    <equal caseless="yes">
                      <clip pos="1" side="sl" part="lem"/>
                      <lit v="baino ez"/>
                    </equal>
                  </or>
                </test>
                <let>
                  <var n="adverbio"/>
                  <lit v="ez"/>
                </let>
              </when>
              <when>
                <test>
                  <equal caseless="yes">
                    <clip pos="1" side="sl" part="lem"/>
                    <lit v="inoiz"/>
                  </equal>
                </test>
                <let>
                  <var n="adverbio"/>
                  <lit v="inoiz"/>
                </let>
              </when>
              <when>
                <test>
                  <equal>
                    <clip pos="1" side="sl" part="tipoadv"/>
                    <lit-tag v="gen"/>
                  </equal>
                </test>
                <let>
                  <var n="adverbio"/>
                  <lit v="advgen"/>
                </let>
              </when>
              <otherwise>
                <let>
                  <var n="adverbio"/>
                  <lit v="adv"/>
                </let>
              </otherwise>
            </choose>
            <choose>
              <when>
                <test>
                  <or>
                    <equal caseless="yes">
                      <clip pos="1" side="sl" part="lem"/>
                      <lit v="gutxiago"/>
                    </equal>
                    <equal caseless="yes">
                      <clip pos="1" side="sl" part="lem"/>
                      <lit v="gehiago"/>
                    </equal>
                  </or>
                </test>
                <let>
                  <var n="grado"/>
                  <lit-tag v="comp"/>
                </let>
              </when>
              <otherwise>
                <let>
                  <var n="grado"/>
                  <lit v=""/>
                </let>
              </otherwise>
            </choose>
            
            <out>
              <chunk namefrom="adverbio" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SADV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_adv"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                  <tag><var n="grado"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="a_adv"/>
                  <clip pos="1" side="tl" part="ND" link-to="3"/>
                  <clip pos="1" side="tl" part="sp"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>


    <rule comment="REGLA: SPOST (posposición separable, p. ex. 'arabera'">
      <pattern>
        <pattern-item n="spost"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="spost" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="PREP"/></tag>
              <tag><clip pos="1" side="tl" part="a_adv"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: DET + POST (lehengo astekoan = lehengo asteko(SPGEN) + an (PR)). Se reordena en t2x">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="tipo_det">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="lem"/>
                  <lit v="a"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="tags"/>
                  <lit-tag v="det.art.pl"/>
                </equal>
              </and>
            </test>
            <let>
              <clip pos="1" side="tl" part="lem"/>
              <lit v="that"/>
            </let>
            <let>
              <clip pos="1" side="tl" part="tags"/>
              <lit-tag v="det.dem.pl"/>
            </let>
            <let>
              <var n="tipusdet"/>
              <lit-tag v="dem"/>
            </let>
          </when>
        </choose>
        <call-macro n="SPgenitivo">
          <with-param pos="2"/>
        </call-macro>
        <out> 
          <chunk name="pr_det" case="caseFirstWord">
            <tags>
              <tag><var n="chunk"/></tag>
              <tag><var n="tipusdet"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><var n="grado"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="a_prep"/>
            </lu>
            <var n="blanco"/>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/> 
              <lit-tag v="2"/> 
              <clip pos="1" side="tl" part="ND" link-to="3"/>
              <clip pos="1" side="tl" part="sp"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: POST (Para reordenar en t2x">
      <pattern>
        <pattern-item n="post"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>

        <out> 
          <chunk name="pr" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="PREP"/></tag>
              <tag><clip pos="1" side="tl" part="a_adv"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="a_prep"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: CNJCOO">
      <pattern>
        <pattern-item n="conj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/>
                <lit v="ezta"/>
              </equal>
            </test>
            <let>
              <var n="ezta"/>
              <lit v="yes"/>
            </let>
          </when>
        </choose>
        <out> 
          <chunk name="cnjcoo" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="CNJ"/></tag>
              <tag><clip pos="1" side="tl" part="tags"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: SPOST + KO (Autonomiari _buruzko_ erreferendumaren)">
      <pattern>
        <pattern-item n="spost"/>
        <pattern-item n="ko"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="spost" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="PREPGEN"/></tag>
              <tag><clip pos="1" side="tl" part="a_adv"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: reset variables">
      <pattern>
        <pattern-item n="cm"/>
      </pattern>
      <action>
        <let>
          <var n="ezta"/>
          <lit-tag v="no"/>
        </let>
        <out>
          <chunk name="cm">
            <tags>
              <tag><lit-tag v="cm"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>







    <rule comment="REGLA: reset variables">
      <pattern>
        <pattern-item n="sent"/>
      </pattern>
      <action>
        <let>
          <var n="nombre"/>
          <lit-tag v="sg"/>
        </let>
        <let>
          <var n="ezta"/>
          <lit-tag v="no"/>
        </let>
        <let>
          <var n="nbr_chunk"/>
          <lit v=""/>
        </let>
        <choose>
          <when>
            <test>
              <not>
                <or>
                  <equal>
                    <clip pos="1" side="sl" part="lem"/>
                    <lit v=";"/>
                  </equal>
                  <equal>
                    <clip pos="1" side="sl" part="lem"/>
                    <lit v=":"/>
                  </equal>
                </or>
              </not>
            </test>
            <let>
              <var n="EOS"/>
              <lit v="true"/>
            </let>
          </when>
        </choose>
        <out>
          <chunk name="punt">
            <tags>
              <tag><lit-tag v="sent"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    
    

  </section-rules>
</transfer>
