<?php

/*

	Input1: Bidix entries (same as for gender generation)
	Input 1 entrie example: <e><p><l>'letovišče'<s n="n"/></l><r>'recurso'<s n="n"/></r></p></e>
	
	Input2: List of SL genders generated by the parser in the previous step - example: sentimentalnost<f>
	Input3: List of ES genders generated by the parser in the previous step - example: pigmento<m>

	
	Output: Bidix entries,


*/


	$content1 = file_get_contents("Bidix entries.txt", "r");
	$content2 = file_get_contents("SL_genders.txt", "r");
	$content3 = file_get_contents("ES_genders.txt", "r");

	$lines = explode("\n", $content1);
	$lines2 = explode("\n", $content2);
	$lines3 = explode("\n", $content3);

	$output = "";
	$main_tag = "n";
	
	foreach ($lines as $line => $key) {
		
		$lemmas = explode("'", $key);
		
		$slo_lemma = $lemmas[1];
		$es_lemma = $lemmas[3];
		
		//Now we need both tags (since they are the same, we'll parse just one)
		$tags = explode("\"", $key);
		$tag_type = $tags[1];
		
		if($tag_type == $main_tag) {
			
			foreach ($lines2 as $line2 => $key2) {
				
				$spoli_razdelitev = explode("<", $key2);
				
				$spoli_slo_lemma = $spoli_razdelitev[0]; //SLO LEMA v SPOLI
				$spoli_slo_lemma_tag = substr($spoli_razdelitev[1], 0, strlen($spoli_razdelitev[1])-1); //MA, MI, F, NT, ...
				
				if($slo_lemma == $spoli_slo_lemma) {
					
					$tmp_slo_spol = $spoli_slo_lemma_tag; //Shranimo MA, MI, F, NT, ... v $tmp_slo_spol
					
				}
				
			}
			
			foreach ($lines3 as $line3 => $key3) {
				
				$spoli_razdelitev2 = explode("<", $key3);
				
				$spoli_es_lemma = $spoli_razdelitev2[0]; //ES LEMA v SPOLI
				$spoli_es_lemma_tag = substr($spoli_razdelitev2[1], 0, strlen($spoli_razdelitev2[1])-1); //MA, MI, F, NT, ...
				
				if($es_lemma == $spoli_es_lemma) {
					
					$tmp_es_spol = $spoli_es_lemma_tag; //Shranimo MA, MI, F, NT, ... v $tmp_slo_spol
					
				}
				
			}
			
			//Now we have
			//$sl0_lemma and $es_lemma + $tmp_sl_spol and $tmp_es_spol
			//echo $slo_lemma . " = " . $tmp_slo_spol . " in " . $es_lemma . " = ". $tmp_es_spol . "\n";
			
			//if($tmp_slo_spol != $tmp_es_spol) { //Generate NEW bidix entry
				
				$exp1 = explode("</l>", $key);
				$levi_del = $exp1[0] . "<s n=\"$tmp_slo_spol\"/></l>";
				
				$exp2 = explode("</r>", $exp1[1]);
				$desni_del = $exp2[0] . "<s n=\"$tmp_es_spol\"/></r></p></e>";
				
				$output .= $levi_del . $desni_del . "\n";
				
			/*}
			else { //Else we leave the old BIDIX entry
				
				$output .= $key . "\n";
				
			}*/
			
		}
		else {
			
			$output .= $key . "\n";
			
		}
	}
		
		echo "OUTPUT: \n\n" . $output;
	


?>